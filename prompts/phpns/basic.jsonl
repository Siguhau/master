{"id": 1, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\about.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n\n$globalvars['page_name'] = 'about';\ninclude(\"inc/header.php\");\n\n\t//check some variables on the phpns server, timeout 5 secs...\n\t$version_check = version_check($globalvars['version']);\n\t$phpns_rss = phpns_rss();\n\t\nif($_GET['version_check']) \n{\n\techo '<link rel=\"stylesheet\" href=\"./themes/default/styles/main.css\" type=\"text/css\" media=\"screen\" />';\n\techo $version_check;\n\tdie;\n}\n\n$content = '\n<h3>Server information</h3>\n<div id=\"columnright\">\n\t<h4>Version check</h4>\n\t<iframe src=\"./about.php?version_check=1\" scrolling=\"no\" frameborder=\"0\"></iframe>\n</div>\n\t<h4>Latest news</h4>\n\t'.$phpns_rss.'\n\n<h3>Help and Support</h3>\n<p>If you are need standard help with any part of your phpns installation, please consult the <a href=\"help.php\">internal documentation</a> first. If that doesn\\'t answer your question, you can do the following (in order of fastest reply):\n\t<ol>\n\t\t<li>Search the <a href=\"http://phpns.com/documentation\">project documentation</a>.</li>\n\t\t<li>You can join our <a href=\"irc://irc.freenode.net:6667/phpns\">IRC channel</a> at <strong>irc.freenode.net</strong> (<strong>#phpns</strong>) (Port: 6667)\n\t\t\t<blockquote>The IRC is the best means of getting help, and getting in touch with the administrators.</blockquote>\n\t\t</li>\n\t\t<li>Try <a href=\"http://phpns.com/contact.php\">contacting us</a> directly.</li>\n\t</ol>\n\n<h3>Development team</h3>\n<p>First, and formost, we would like to thank the community! Not only for using our web application, but for your continued support and donations. Next, our sponsors have contributed so much to the development of phpns, we can\\'t thank them enough!</p>\n\t\t<blockquote>\n\t\t<strong>Primary development</strong>\n\t\t<ul>\n\t\t\t<li><a href=\"http://alecwh.com\">Alec Henriksen</a>, lead and primary developer (project owner, copyright holder)</li>\n\t\t\t\n\t\t</ul>\n\t\t\n\t\t<strong>Contributory development</strong>\n\t\t<ul>\n\t\t\t<li><a href=\"http://justarandomblog.com\">Kyle Osborn</a>, consultation and misc. scripting</li>\n\t\t\t\n\t\t</ul>\n\t\t\n\t\t\n\t\t<strong>Sponsors</strong>\n\t\t<ul>\n\t\t\t<li>no sponsors yet. <a href=\"http://phpns.com/contact\">Find out how to become one</a>, and get listed here!</li>\n\t\t</ul>\n\t\t</blockquote>\n\n<h3>License (gpl)</h3>\n<p>   Copyright (C) 2007  Alec Henriksen</p>\n<p>\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n</p>\n<p>\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n</p>\n<p>\nPlease see the GPL at <a href=\"http://www.gnu.org/copyleft/gpl.html\">gnu.org</a> for a complete understanding of what this license means and how to abide by it.\n</p>\n\n<h3>Support phpns</h3>\n<p>\nAlthough we will never charge for the phpns package, we do ask that you (optionally) help us by...\n</p>\n\t<ol>\n\t\t<li><strong>Rating phpns at hotscripts.com</strong>\n\t\t\t<blockquote>\n\t\t\t<form action=\"http://www.hotscripts.com/rate/66546.html\" method=\"post\">                  \n\t\t\t\t<select name=\"rating\" size=\"1\">\n\t\t\t\t\t<optgroup label=\"Select a rating\">\n\t\t\t\t\t<option selected=\"selected\" value=\"5\">Excellent!</option>\n\t\t\t\t\t<option value=\"4\">Very Good</option>\n\t\t\t\t\t<option value=\"3\">Good</option>\n\t\t\t\t\t<option value=\"2\">Fair</option>\n\t\t\t\t\t<option value=\"1\">Poor</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t</select><br />\n\t\t\t\t<input name=\"submit\" value=\"Rate It!\" type=\"submit\">\n\t\t\t</form>\n\t\t\t</blockquote>\n\t\t</li>\n\t\t<li><strong>Give the software to your friends.</strong></li>\n\t\t<li><strong><a href=\"http://launchpad.net/phpns\">report a bug in the software</a></strong></li>\n\t</ol>\n\n<h3>Miscellaneous</h3>\n<p>\nThis program was created using open-source and free software, on the linux operating system. This web application takes as much advantage of the XHTML/CSS specifications as possible (provided by <a href=\"http://w3.org\">w3C</a>) and is designed to generate compliant and semantic content. The following programs were used in the creation of this project:\n</p>\n\t<div id=\"columnright\">\n\t\t<ul>\n\t\t<li><a href=\"http://tango.freedesktop.org/Tango_Icon_Gallery\">Tango Desktop Icons</a></li>\n\t\t<li><a href=\"http://tinymce.moxiecode.com/\">TinyMCE wysiwyg editor</a></li>\n\t\t</ul>\n\t</div>\n\t<ul>\n\t\t<li><a href=\"http://www.gnome.org/projects/gedit/\">gEdit (Gnome text-editor)</a></li>\n\t\t<li><a href=\"http://inkscape.org/\">Inkscape Vector Illistrator</a></li>\n\t\t<li><a href=\"http://www.phpmyadmin.net/home_page/index.php\">phpMyAdmin database manager</a></li>\n\t</ul>\n';\n\ninclude(\"inc/themecontrol.php\");  //include theme script\n?>\n"}]}
{"id": 2, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\article.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\ninclude(\"inc/header.php\");\n$do = $_GET['do'];\n\t//if we're previewing an article... set do to preview\n\tif (isset($_POST['preview'])) { $do = 'preview'; }\n\tif (!$do) {\n\n\t\t//quick permission check (redir to error)\n\t\tif ($globalvars['rank'][10] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\tdie();\t\n\t\t}\n\t\t\n\t$globalvars['page_name'] = 'new article'; //set page name\n\t\n\t//The do var is empty; display new article form\n\t$content = article_form();  //display form (function in function.php)\n\t\n\t} elseif ($do == \"preview\") {  //preview article\n\t\n\t\t//quick permission check (redir to error)\n\t\tif ($globalvars['rank'][10] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\tdie();\n\t\t}\n\t\t\t$globalvars['page_name'] = 'preview article';\n\t\t\t$globalvars['page_image'] = 'new article';\n\t\t//define new item array from POST data\n\t\t\t$data['article_title'] = $_POST['article_title'];\n\t\t\t$data['article_subtitle'] = $_POST['article_subtitle'];\n\t\t\t$data['article_cat'] = $_POST['article_cat'];\n\t\t\t$data['article_text'] = $_POST['article_text'];\n\t\t\t$data['article_exptext'] = $_POST['article_exptext'];\n\t\t\t$data['acchecked'] = $_POST['acchecked'];\n\t\t\t$data['achecked'] = $_POST['achecked'];\n\t\t\t$data['start_date'] = $_POST['start_date'];\n\t\t\t$data['end_date'] = $_POST['end_date'];\n\t\t\t$data['archived'] = \"0\";\n\t\t\t$data['approved'] = \"0\";\n\t\t\n\t\t$content = '\n\t\t\t<hr />\n\t\t\t<h1 class=\"preview_title\">'.$data['article_title'].'</h1>\n\t\t\t<div class=\"preview_main\">\n\t\t\t\t'.$data['article_text'].'\n\t\t\t</div>\n\t\t\t<div class=\"preview_full\">\n\t\t\t\t'.$data['article_exptext'].'\n\t\t\t</div>\n\t\t\t<hr />\n\t\t\t'.article_form().'\n\t\t';\n\t\n\t} elseif ($do == \"p\") { //if new form submitted\n\t\t\n\t\t//quick permission check (redir to error)\n\t\tif ($globalvars['rank'][10] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\tdie();\t\n\t\t}\n\t\t\n\t\t//now, if this user needs approval to post, we'll set the approve to 0 (which is 'no', or not approved) ELSE, 1\n\t\tif ($globalvars['rank'][10] == 2) {\n\t\t\t$data['approved'] = 0;\n\t\t} else {\n\t\t\t$data['approved'] = 1;\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tif(isset($_POST)) {\n\t\t\t$proceed = \"yes\"; //for verification later\n\t\t\t\n\t\t\t//define new item array from POST data\n\t\t\t$data['article_title'] = $_POST['article_title'];\n\t\t\t$data['article_subtitle'] = $_POST['article_subtitle'];\n\t\t\t$data['article_cat'] = $_POST['article_cat'];\n\t\t\t$data['article_text'] = $_POST['article_text'];\n\t\t\t$data['article_exptext'] = $_POST['article_exptext'];\n\t\t\t$data['acchecked'] = $_POST['acchecked'];\n\t\t\t$data['achecked'] = $_POST['achecked'];;\n\t\t\t$data['start_date'] = $_POST['start_date'];\n\t\t\t$data['end_date'] = $_POST['end_date'];\n\t\t\t\n\t\t\t// we already have this set, nulled out here for reference $data['approved'] = \"0\";\n\t\t\t\n\t\t\t$error_message = '<ol class=\"warning\">';\n\t\t\t\n\t\t\tif (empty($data['article_title'])) {\n\t\t\t\t$proceed = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>You must enter a title.</li>\n\t\t\t\t';\n\t\t\t}\n\t\t\tif (empty($data['article_text'])) {\n\t\t\t\t$proceed = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>You must enter a main article.</li>\n\t\t\t\t';\n\t\t\t\t\n\t\t\t}\n\t\t\tif (empty($data['article_cat'])) {\n\t\t\t\t$proceed = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>A category is necessary. You should NOT recieve this message, something is wrong. Make sure you have a category defined...</li>\n\t\t\t\t';\n\t\t\t}\n\t\t\t\t$error_message = $error_message.'</ol>'; //end error message ordered list\n\t\t\t//convert start and end date times | function will do everything, it also returns errors.\n\t\t\tif ($data['start_date']) {\n\t\t\t\t$unixtime['start'] = validate_date($data,'start');\n\t\t\t}\n\t\t\tif ($data['end_date']) {\n\t\t\t\t$unixtime['end'] = validate_date($data,'end');\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tif ($data['achecked'] == \"\") {  //if no value (not selected)\n\t\t\t\t$data['achecked'] = 1;\n\t\t\t}\n\t\t\t\n\t\t\tif ($data['acchecked'] == \"\") {  //if no value (not selected)\n\t\t\t\t$data['acchecked'] = 1;\n\t\t\t}\n\t\t\t\n\t\t\t//new article process (clean data, then submit to database)\n\t\t\tforeach($data as $key => $value) {\n\t\t\t\t//clean data (SQL injection security)\n\t\t\t\t$data[$key] = clean_data($value);\n\t\t\t}\n\t\t\t\n\t\t\tif ($proceed == \"yes\") {\n\t\t\t\tif ($_FILES['image']['name']) {\n\t\t\t\t\tif (!$data['image'] = upload_image($_FILES['image'])) {\n\t\t\t\t\t\t$proceed = \"no\";\n\t\t\t\t\t\t$error_message .= '<li>The image upload returned an error, which means the file was not an image, or we had trouble moving the file to (images/uploads). Check the permissions for the directory.</li>';\n\t\t\t\t\t\t$error_message = $error_message.'</ol>'; //end error message ordered list\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($proceed == \"yes\") { //if we're STILL ok, even with file upload... we finish up.\n\t\t\t\t\tnew_item($data,$_SESSION['username']); //submit the data(function in inc/function.php) with username\n\t\t\t\t\t$globalvars['page_name'] = 'article success'; //set page name\n\t\t\t\t\t$globalvars['page_image'] = 'success';\n\t\t\t\t\n\t\t\t\t\t//set content for page success!\n\t\t\t\t\t$content = \"\";\n\t\t\t\t} else {\n\t\t\t\t\t$globalvars['page_name'] = 'new article'; //set page name\n\t\t\t\t\t$globalvars['page_image'] = 'error'; //error image\n\t\t\t\t\n\t\t\t\t\t//we have to convert the date back from the UNIX timestamp, IF it's in the correct format. (We already did this above)\n\t\t\t\t\tif ($data['acchecked'] == 0) { //if the article DISALLOWS comments, check the box\n\t\t\t\t\t\t$data['acchecked_check'] = ' checked=\"checked\"';\n\t\t\t\t\t}\n\t\t\t\t\tif ($data['achecked'] == 0) {  //if the article is NOT active, check the box\n\t\t\t\t\t\t$data['achecked_check'] = ' checked=\"checked\"';\n\t\t\t\t\t}\n\t\t\t\t\t$content = article_form();  //display form (function in function.php)\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else { //problem. display form with vars. \n\t\t\t\t$globalvars['page_name'] = 'new article'; //set page name\n\t\t\t\t$globalvars['page_image'] = 'error'; //error image\n\t\t\t\t\n\t\t\t\t//we have to convert the date back from the UNIX timestamp, IF it's in the correct format. (We already did this above)\n\t\t\t\tif ($data['acchecked'] == 0) { //if the article DISALLOWS comments, check the box\n\t\t\t\t\t$data['acchecked_check'] = ' checked=\"checked\"';\n\t\t\t\t}\n\t\t\t\tif ($data['achecked'] == 0) {  //if the article is NOT active, check the box\n\t\t\t\t\t$data['achecked_check'] = ' checked=\"checked\"';\n\t\t\t\t}\n\t\t\t\t$content = article_form();  //display form (function in function.php)\n\t\t\t}\n\t\t}\n\t} elseif ($do == \"edit\") { //do elseif (edit)\n\t\n\t\t//quick permission check (redir to error)\n\t\tif ($globalvars['rank'][14] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\tdie();\t\n\t\t}\n\t\n\t\t$globalvars['page_name'] = 'edit article';  //set page name\n\t\t$globalvars['page_image'] = 'article management'; //set image\n\t\t$news_id = clean_data($_GET['id']);\n\t\t\t//sql and execution, grab update data from IP.\n\t\t\t$get_res = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"articles WHERE id='$news_id' LIMIT 1\");\n\t\t$data = mysql_fetch_assoc($get_res) or die(\"again.\");\n\t\tif ($data['start_date']) {\n\t\t\t$data['start_date'] = date('m/d/Y',$data['start_date']);\n\t\t}\n\t\tif ($data['end_date']) {\n\t\t\t$data['end_date'] = date('m/d/Y',$data['end_date']);\n\t\t}\n\t\t\t//define checked boxes...\n\t\t\techo $data['acchecked'];\n\t\t\tif ($data['allow_comments'] == 0) { //if the article DISALLOWS comments, check the box\n\t\t\t\t$data['acchecked_check'] = ' checked=\"checked\"';\n\t\t\t}\n\t\t\techo $data['achecked'];\n\t\t\tif ($data['active'] == 0) {  //if the article is NOT active, check the box\n\t\t\t\t$data['achecked_check'] = ' checked=\"checked\"';\n\t\t\t}\n\t\t//display edit form\n\t\t$content = article_form();\n\t\t\n\t} elseif ($do == \"editp\") { //do elseif (edit process)\n\t\n\t\t//quick permission check (redir to error)\n\t\tif ($globalvars['rank'][14] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\tdie();\t\n\t\t}\n\t\t\n\t\t$globalvars['page_name'] = 'edit article';\n\t\t\tif(isset($_POST)) {\n\t\t\t$proceed = \"yes\"; //for verification later\n\t\t\t\n\t\t\t//define new item array from POST data\n\t\t\t$data['article_title'] = $_POST['article_title'];\n\t\t\t$data['article_subtitle'] = $_POST['article_subtitle'];\n\t\t\t$data['article_cat'] = $_POST['article_cat'];\n\t\t\t$data['article_text'] = $_POST['article_text'];\n\t\t\t$data['article_exptext'] = $_POST['article_exptext'];\n\t\t\t$data['acchecked'] = $_POST['acchecked'];\n\t\t\t$data['achecked'] = $_POST['achecked'];\n\t\t\t$data['start_date'] = $_POST['start_date'];\n\t\t\t$data['end_date'] = $_POST['end_date'];\n\t\t\t$data['approved'] = \"0\";\n\t\t\t\n\t\t\t$error_message = '<ol class=\"warning\">';\n\t\t\tif (empty($data['article_title'])) {\n\t\t\t\t$proceed = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>You must enter a title.</li>\n\t\t\t\t';\n\t\t\t}\n\t\t\tif (empty($data['article_text'])) {\n\t\t\t\t$proceed = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>You must enter a main article.</li>\n\t\t\t\t';\n\t\t\t\t\n\t\t\t}\n\t\t\tif (empty($data['article_cat'])) {\n\t\t\t\t$proceed = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>A category is necessary. You should NOT recieve this message, something is wrong. Make sure you have a category defined...</li>\n\t\t\t\t';\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t//convert start and end date times | function will do everything, it also returns errors.\n\t\t\tif ($data['start_date']) {\n\t\t\t\t$unixtime['start'] = validate_date($data,'start');\n\t\t\t}\n\t\t\tif ($data['end_date']) {\n\t\t\t\t$unixtime['end'] = validate_date($data,'end');\n\t\t\t}\n\t\t\t\n\t\t\t$error_message = $error_message.'</ol>';\n\t\t\t\n\t\t\tif ($data['achecked'] == \"\") {  //if no value (not selected)\n\t\t\t\t$data['achecked'] = 1;\n\t\t\t}\n\t\t\tif ($data['acchecked'] == \"\") {  //if no value (not selected)\n\t\t\t\t$data['acchecked'] = 1;\n\t\t\t}\n\t\t\t\n\t\t\t//new article process (clean data, then submit to database)\n\t\t\tforeach($data as $key => $value) {\n\t\t\t\t//clean data (SQL injection security)\n\t\t\t\t$data[$key] = clean_data($value);\n\t\t\t}\n\t\t\tif ($proceed == \"yes\") {\n\t\t\t\tif ($_FILES['image']['name']) {\n\t\t\t\t\tif (!$data['image'] = upload_image($_FILES['image'])) {\n\t\t\t\t\t\t$proceed = \"no\";\n\t\t\t\t\t\t$error_message .= '<li>The image upload returned an error, which means the file was not an image, or we had trouble moving the file to (images/uploads). Check the permissions for the directory.</li>';\n\t\t\t\t\t\t$error_message = $error_message.'</ol>'; //end error message ordered list\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif ($proceed == \"yes\") {\n\t\t\t\t\t$data['id'] = $_POST['id'];\n\t\t\t\t\tedit_item($data,$_SESSION['username']); //submit the data(function in inc/function.php) with username\n\t\t\t\t\t$globalvars['page_name'] = 'edit success'; //set page name\n\t\t\t\t\t$globalvars['page_image'] = 'success';\n\t\t\t\t\t$content = '';\n\t\t\t\t} else { //edit error display form and errors\n\t\t\t\t\t$globalvars['page_name'] = 'edit article'; //set page name\n\t\t\t\t\t$globalvars['page_image'] = 'error';\n\t\t\t\t\n\t\t\t\t\t//if the form dates are correct, recreate the human readable for edit page...\n\t\t\t\t\n\t\t\t\tif ($data['acchecked'] == 0) { //if the article DISALLOWS comments, check the box\n\t\t\t\t\t$data['acchecked_check'] = ' checked=\"checked\"';\n\t\t\t\t}\n\t\t\t\tif ($data['achecked'] == 0) {  //if the article is NOT active, check the box\n\t\t\t\t\t$data['achecked_check'] = ' checked=\"checked\"';\n\t\t\t\t}\n\t\t\t\t\t$content = article_form();  //display form (function in function.php)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$globalvars['page_name'] = 'new article'; //set page name\n\t\t\t\t$globalvars['page_image'] = 'error'; //error image\n\t\t\t\t\n\t\t\t\t//we have to convert the date back from the UNIX timestamp, IF it's in the correct format. (We already did this above)\n\t\t\t\tif ($data['acchecked'] == 0) { //if the article DISALLOWS comments, check the box\n\t\t\t\t\t$data['acchecked_check'] = ' checked=\"checked\"';\n\t\t\t\t}\n\t\t\t\tif ($data['achecked'] == 0) {  //if the article is NOT active, check the box\n\t\t\t\t\t$data['achecked_check'] = ' checked=\"checked\"';\n\t\t\t\t}\n\t\t\t\t$content = article_form();  //display form (function in function.php)\n\t\t\t}\n\t\t}\n\t} elseif ($do == \"activate\") {\n\t\t//activating the article, function and then redirect.\n\t\t\t$id = $_GET['id'];\n\t\tapprove($id);\n\t\theader(\"Location: article.php?do=edit&id=$id\");\n\t\n\t} elseif ($do == \"comments\") {\n\t\tif ($_GET['action'] == 'delete') {\n\t\t\t$items = $_POST; //get vars\n\t\t\t\tif (!$items) { //if no items, avoid mysql error by just redirecting\n\t\t\t\t\theader(\"Location: ?do=comments&id=\".$_GET['id'].\"\");\n\t\t\t\t}\n\t\t\t\t\t//we're going to create list of ids to be deleted from database.\n\t\t\t\t\tforeach($items as $key=>$value) {\n\t\t\t\t\t\t$items_f = $items_f.\"'$key',\";\n\t\t\t\t\t}\n\t\t\t\t\t//remove last comma in list for SQL\n\t\t\t\t\t$items_f = substr_replace($items_f,\"\",-1);\n\t\t\t\t\t//delete the items in 'articles'\n\t\t\t\t\tdelete('comments',$items_f);\n\t\t\t\t\t\n\t\t\t\t\t//log this\n\t\t\t\t\tlog_this('delete_comments','User <i>'.$_SESSION['username'].'</i> has <strong>deleted</strong> the comments: \"'.$items_f.'\"');\n\t\t}\n\t\t//if the id isn't numeric, kill the script. Injection protection.\n\t\tif (!is_numeric($_GET['id'])) { die(\"non numeric article id\"); }\n\t\t\t$id = $_GET['id'];\n\t\t$globalvars['page_name'] = 'Comment list ('.$id.')';\n\t\t$globalvars['page_image'] = '0';\n\t\t\n\t\t//now, we generate comments for this specific article\n\t\t\t//get the template currently active in the installation\n\t\t\t$template = fetch_template();\n\t\t$fetch_com_res = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"comments WHERE article_id='\".$id.\"' AND approved='1'\");\n\t\t\t//for each row (or comment) generated, we translate the item and assign it to $content\n\t\t\twhile ($row = mysql_fetch_assoc($fetch_com_res)) {\n\t\t\t\t$comment_list .= '<div class=\"checkbox\"><input type=\"checkbox\" name=\"'.$row['id'].'\" value=\"'.$row['id'].'\" /></div>'.translate_comment($row, $template['html_comment'], 'html_comment');\n\t\t\t}\n\t\t\t//assign $comment_list to $content\n\t\t\t$content .= '\n\t\t\t\t<div><button class=\"activate\" OnClick=\"window.location = \\'?do=edit&id='.$id.'\\';\"><strong>Back to edit article</strong></button></div>\n\t\t\t\t<form action=\"?do=comments&id='.$id.'&action=delete\" method=\"post\">\n\t\t\t\t\t<div style=\"text-align: right;\"><input id=\"selectall\" type=\"checkbox\" onClick=\"Checkall(this.form);\" /></div>\n\t\t\t\t\t'.$comment_list.'\n\t\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Delete selected comments\" />\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t';\n\t\n\t} //end of main do\n\n\ninclude(\"inc/themecontrol.php\");  //include theme script\n?>\n"}]}
{"id": 3, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\etc.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\ninclude(\"inc/header.php\");\n$do = $_GET['do'];\n\t\n\tif ($do == \"backup\") { //send backup file to user, header info\n\t\t\t$file = $databaseinfo['dbname'].'.sql'; //the current dump\n\t\theader('Content-Type: application/text');\n\t\theader('Content-Length: '.$_GET['size'].'');\n\t\theader('Content-disposition: attachment; filename='.$databaseinfo['dbname'].'.sql');\n\t\treadfile($file);\n\t\tlog_this('backup','User <i>'.$_SESSION['username'].'</i> has <strong>backed up</strong> the system database.');\n\t} elseif ($do == \"rss\") {\n\t\t$mode = 'rss';\n\t\t$sef_override = TRUE;\n\t\tinclude('shownews.php');\n\t\t$do = 'rss'; //shownews.php resets the $do variable, just resetting it for the rest of the etc.php to avoid error.\n\t}\n\t\nif ($do == NULL) {\n\techo $do;\n\techo \"This file is only for special tasks that can't be done on other pages. Go away now. =D\";\n}\n\t\n?>\n"}]}
{"id": 4, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\help.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n?>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n\t<title>phpns : help</title>\n\t<style type=\"text/css\" media=\"all\">\n\t\th3 {\n\t\t\tbackground: #333;\n\t\t\tcolor: white;\n\t\t\tpadding: 20px;\n\t\t\tmargin: 20px -8px;\n\t\t}\n\t\th4 {\n\t\t\tbackground: #ccc;\n\t\t\tpadding: 10px;\n\t\t\tcolor: #333;\n\t\t\tmargin: 10px -8px 10px 20px;\n\t\t\t}\n\t\tpre {\n\t\t\tbackground: #eee;\n\t\t\tmargin-left: 5%;\n\t\t\tborder: 1px solid #999;\n\t\t\tborder-left: 5px solid #999;\n\t\t\twidth: 70%;\n\t\t\tpadding: 2px;\n\t\t}\n\t</style>\n</head>\n<body>\n\t<h1>phpns help</h1>\n\t<h2>general documentation and manual</h2>\n\t<p>The phpns documentation aims to help you accomplish certain tasks\n\twith the phpns software. Click a task below for additional information.</p>\n\t\n\t<h4>topics</h4>\n\t<ul>\n\t\t<li><a href=\"#index\">index</a></li>\n\t\t<li><a href=\"#new article\">new article</a></li>\n\t\t<li><a href=\"#article management\">article management</a></li>\n\t\t<li><a href=\"#user management\">user management</a></li>\n\t\t<li><a href=\"#preferences\">preferences</a></li>\n\t\t<li><a href=\"#about\">about</a></li>\n\t</ul>\n\t<h3 id=\"success\">success help</h3>\n\t<p>You have successfully completed the action you were trying to accomplish. If it doesn't appear to be successful, please let us know at <a href=\"http://launchpad.net/phpns\">our bug tracking system (Launchpad)</a>.\n\t\n\t<h3 id=\"error\">error help</h3>\n\t<p>The action we attempted failed. Usually, the administration interface will give you a reason for the error. If it doesn't make sense, or you think it's a bug, please <a href=\"http://launchpad.net/phpns\">let us know</a>.\n\t\n\t<h3 id=\"including your news\">including your news</h3>\n\t\t<h4>Phpns includes a wizard to automate this, available at the preferences panel > integration wizard.</h4>\n\t<p>phpns and it's features are worthless if you can't display your work to the world. You \n\tcan \"include\" your news on any php document throughout the server, in all different forms. \n\tPhpns includes an integration wizard in the preferences section, however, if you wish to do \n\tit by hand, we'll help you here.</p>\n\t<p>The easiest and quickest way to display your news on your website is to follow these steps:</p>\n\t<ol>\n\t\t<li>Open up the PHP document you wish to have the news 'display' in.</li>\n\t\t<li>Paste the following code:\n\t\t\t<pre>\n<?php\n\techo highlight_string(\"<?php\n\tinclude('path/to/shownews.php');\n?>\",1);\n?>\n</pre>\n\t\t\tYou will need to modify the code above to reflect the actual path of the shownews.php file.\n\t\t</li>\n\t\t<li>Save and exit the document</li>\n\t\t<li>Upload it to your server (if necessary)</li>\n\t</ol>\n\t<p>This method will give you the default settings, specified in the <a href=\"preferences.php?do=wizard\">preferences of the administration panel</a>. If this is fine for you, then you're done. However, if you want additional customization, continue reading.</p>\n\t\n\t<h4>Additional variables</h4>\n\t<p>Phpns will allow you to specify additional variables, for more advanced generation.</p>\n\t\t<ul>\n\t\t\t<li>$limit - The number of items to be listed. Ex: 100</li>\n\t\t\t<li>$template - The ID number of the template to use. Ex: 5</li>\n\t\t\t<li>$category - The ID number of the category you wish to filter. Ex: 1,2,3,4,5</li>\n\t\t\t<li>$mode - RSS feed. Using this variable MUST be used on a blank file. So, if you have rss.php, it must ONLY include the phpns code. No other HTML/CSS. Ex: \"rss\"\n\t\t\t<li>$offset - The offset starting point. If you specify 1, it will skip 1, and then display 2-$limit. Ex: 4</li>\n\t\t\t<li>$order - The order in which the articles are listed. Ex. \"desc\" or \"asc\" for descending and ascending respectively\n\t\t\t<li>$disable_pagination - Will not display pagination links. Ex: TRUE</li>\n\t\t\t<li>$items_per_page - # of articles per page (in pagination). Will be ignored if pagination is disabled. Ex: 5</li>\n\t\t\t<li>$sef_override - Override SEF detection, advanced users only. Force SEF URLs. Ex: TRUE</li>\n\t\t\t<li>$comment_override - This will disable comments on every article, regardless of other settings.</li>\n\t\t\t<li>$static - Using this variable will always display the article list, NEVER a single article. Use this if you have moroe than one phpns includes on a single page.</li>\n\t\t\t<li>$disable_extended_article - Any article will  be displayed WITHOUT the extended article portion.</li>\n\t\t</ul>\n\t\tWe can apply these variables (you can use any of them, none of them, all of them, or some of them):\n\t\t<pre>\n<?php\n\techo highlight_string('<?php\n\t$limit = 5;\n\t$category = 1,4,5,6,7;\n\t$template = 4;\n\t$offset = 2;\n\t$mode = \\'RSS\\';\n\tinclude(\\'path/to/shownews.php\\');\n?>',1);\n?>\n</pre>\n\t\n\t<h3 id=\"index\">index help</h3>\n\t<p>The phpns index is the main page which you are directed to after logging in. \n\tAt the top of the page, you'll find multiple links to post a new item, manage \n\tcurrent items, manage the phpns users, modify your preferences, and read the \n\tphpns about page.</p>\n\t<p>Displayed below the page description, you'll find an information section, which \n\tcontains two different sections: statistics, and recent articles. Both are pretty \n\tstraight forward. You will notice the help hyperlink at the bottom right area of \n\tthe page, which can be clicked to view certain help topics (the guide you are viewing \n\tnow!).</p>\n\t\n\t<h3 id=\"new article\">new article help</h3>\n\t<p>posting a new item is fairly straightforward with phpns. Click the 'new article' \n\tlink in the admin navigation. Once you are at the page, you should see a short \n\tdescription, along with an HTML form. A list of the fields are below:</p>\n\t<ul>\n\t\t<li>article title | <span style=\"color: red\">required</span></li>\n\t\t<li>article sub-title | <span style=\"color: green\">optional</span></li>\n\t\t<li>article category | <span style=\"color: red\">required</span></li>\n\t\t<li>main article | <span style=\"color: red\">required</span></li>\n\t\t<li>full story | <span style=\"color: green\">optional</span></li>\n\t\t<li>article image | <span style=\"color: green\">optional</span></li>\n\t\t<li>start date | <span style=\"color: green\">optional</span></li>\n\t\t<li>end date | <span style=\"color: green\">optional</span></li>\n\t\t<li>disable comments | <span style=\"color: green\">optional</span></li>\n\t\t<li>save as draft | <span style=\"color: green\">optional</span></li>\n\t</ul>\n\t\n\t<h5>article title</h5>\n\t<p>the title can contain any character, and has a limit of 100 characters. Example: My first post!</p>\n\t\n\t<h5>article sub-title</h5>\n\t<p>the sub-title can contain any character, and has a limit of 100 characters. Example: and why I love this cms...</p>\n\t\n\t<h5>article category</h5>\n\t<p>the article category is very important, and currently you can only have one (1) category per article. We plan to change this in a future release...</p>\n\t\n\t<h5>main article</h5>\n\t<p>the main article is the most important element in article items. Limit of 20,000 characters.</p>\n\t\n\t<h5>full story</h5>\n\t<p>the rest of the article. this is optional! Limit of 20,000 characters.</p>\n\t\n\t<h5>article image</h5>\n\t<p>100px by 100px image representing the article content. optional. Accepts jpg, png, gif, and bmp.</p>\n\t\n\t<h5>start date</h5>\n\t<p>A more obscure feature of phpns. You can specify when a date will become visable on your website. The \n\tformat must be in the following order: \"MM/DD/YYYY\". The date is converted to a Unix timestamp, and stored \n\tin the database. Leave this field blank if you wish to start the article immediately.</p>\n\t\n\t<h5>end date</h5>\n\t<p>A more obscure feature of phpns. You can specify when a date will stop being visable on your website. The \n\tformat must be in the following order: \"MM/DD/YYYY\". The date is converted to a Unix timestamp, and stored \n\tin the database. Leave this field blank if you wish to never end the article.</p>\n\t\n\t<h5>disable comments</h5>\n\t<p>Check this box if you wish to disallow comments for this specific article. THIS WILL ONLY affect this \n\tarticle, it will not affect any other item.</p>\n\t\n\t<h5>save as draft</h5>\n\t<p>Check this box if you don't want the article to appear publicly. This is a useful feature if you are \n\tworking on a long post, or if you want other people to modify the article before it goes live.</p>\n\t\n\t\n\t<h3 id=\"article management\">article management help</h3>\n\t\t<p>article management allows you to view the articles you have posted in different ways, orders, and with conditions. By default, articles are listed in a descending date order. That means, the latest article that has been created will be shown at the TOP of the news management table. Although this might suite you, sometimes you may require ordering in a different way, scroll down to sorting options.</p>\n\t\t\n\t\t<h4>Search</h4>\n\t\t\t<p>Searching is really easy with phpns. At the top of article management, you will see a hyperlink named 'search' (with an expand/collapse option). Expand the search section, and you're presented with 2 fields: your query, and category. Whatever text you enter in the query box (the box with the text 'click here to start your search'), is the text we'll search for in every active article to date. The system will scan the title, subtitle, main article, and full story for that query entered. You also have the option to narrow your search by category. By default, it will search in all categories.</p>\n\t\t\n\t\t\n\t\t<h4>Sorting options</h4>\n\t\t\t<p>The article list can be sorted in various ways, so you can walk through your database articles easily. You have the following sorting options, which you can activate by clicking at the top of each column of the table.</p>\n\t\t<h5>Sort by date</h5>\n\t\t<p>This will allow you to sort the articles based on the time they were posted. Descending is the default sorting order, however, you may also set this to ascending.</p>\n\t\t\n\t\t<h5>Sort by title name (alphabetically)</h5>\n\t\t<p>This will allow you to sort the articles based on the articles' title. Ascending will order it from 0-9,A-Z. Descending will reverse the order.</p>\n\t\t\n\t\t<h5>Sort by author</h5>\n\t\t<p>This will allow you to sort the articles based on the author of the article. Ascending will sort the articles based on the name of the author, in alphabetical order. Therefore, ascending would present: Alan, Billy, Caty, George, Veronica, Zack. Descending would reverse the order.</p>\n\t\t\n\t\t<h5>Sort by Active or Activity</h5>\n\t\t<p>This will allow you to sort the articles based on their status as active or unactive. This is very useful for weeding out articles that have been dormant for a long time.</p>\n\t\t\n\t\t<h4>Other uses</h4>\n\t\t<h5>View articles by a certain author</h5>\n\t\t<p>You can view all the articles posted by a specific user. While viewing articles, you can simply click on the username in the column \"Author\", and it will load up a selection of articles by that selected author.</p>\n\t\t\n\t\t<h5>View articles by category</h5>\n\t\t<p>You can do the same thing with the author, except clicking on the category next to any article. It will bring up a list of articles posted in that category.</p>\n\t\t\n\t\t\n\t<h3 id=\"user management\">user management help</h3>\n\t\t<p>User management is a tool which lets you control and see various users on your installation, like creating new users, editing users, deleting users, and viewing different aspects of users.</p>\n\t\t<p>By default, the user management page will show a list of options, and a list of users with their information. The table which lists users has the following information:\n\t\t<ul>\n\t\t\t<li>username - what the user's username is</li>\n\t\t\t<li>full name - the full name of the user</li>\n\t\t\t<li>date - the date the user was created</li>\n\t\t\t<li>rank - the current rank of the user. You can click on the rank to edit the rank.</li>\n\t\t\t<li>#/articles - displays the current number of articles created by the user. You can click this do display the users.</li>\n\t\t</ul>\n\t\t<h5>new user</h5>\n\t\t<p>Each user must have a <strong>unique username</strong>. A full list of required and optional fields are listed below:</p>\n\t\t<ul>\n\t\t\t<li>username [required]</li>\n\t\t\t<li>full name [required]</li>\n\t\t\t<li>password [required]</li>\n\t\t\t<li>confirm password [required]</li>\n\t\t\t<li>email</li>\n\t\t\t<li>msn</li>\n\t\t\t<li>aim</li>\n\t\t\t<li>yahoo</li>\n\t\t\t<li>skype</li>\n\t\t\t<li>rank</li>\n\t\t</ul>\n\t\t\n\t<h3 id=\"preferences\">preferences help</h3>\n\t<p>The preferences area will give you the ability to modify many different aspects of your phpns system. The different tasks you can accomplish are listed below:</p>\n\t\n\t<h4>general display options</h4>\n\t<p>Here, you can set the 'default' values for how your news is displayed to your visitors/viewers. You can set the following:\n\t\t<ul>\n\t\t\t<li>Display offset - This is how many articlces are omitted before we start displaying. In other words, this is the number of items that will be 'skipped' by default.</li>\n\t\t\t<li>Date format - This is the default date format which will be used to translate the article timestamp to a human-readable format. It uses the <a href=\"http://php.net/date\">php date();</a> function, you can use that page for reference.</li>\n\t\t\t<li>Display limit - This is how many articles are displayed to the end user.</li>\n\t\t\t<li>Reverse items - You can reverse the order in which the articles appear to the end user. Descending will place the newest articles at the top. Ascending will put the oldest at the top.</li>\n\t\t</ul>\n\t\n\t<h4>category management</h4>\n\t<p>Category management will let you create categories and sub-categories in which to file your articles in. You can think of categories like 'folders' in a file system. When you create a new article, you will choose a category in which to place the article into, and later, you can 'filter' the articles (by category) to the end-user.</p>\n\t\n\t<h4>template management</h4>\n\t<p>Templates let you control how your articles are displayed to the end-user. Your template will have 5 fields; a title/name, description, article template, comment template, and comment form. You can set a default template (set at 'Default' during installation) which will appear to the user. You can have multiple templates, and you can use multiple templates at the same time by using extra variables while including your news.</p>\n\t\n\t<p>There are multiple variables that you can use in the templates, specified by using {}s. There is a list of them below:</p>\n\t<h5>Main article variables</h5>\n\t<ul>\n\t\t<li>{title} = article title</li>\n\t\t<li>{subtitle} = subtitle</li>\n\t\t<li>{date} = timestamp/date</li>\n\t\t<li>{image_src} = article image src. (ex: &lt;img src=\"{image_src}\" alt=\"{title}\" /&gt;\n\t\t<li>{main_article} = main article</li>\n\t\t<li>{full_story} = full story</li>\n\t\t<li>{comment_count} = The number of articles this article has</li>\n\t\t<li>{author} = author</li>\n\t\t<li>{article_href} = the link to the article, but the actual href value</li>\n\t\t<li>{reddit} = reddit social networking link</li>\n\t\t<li>{digg} = digg social networking link</li>\n\t</ul>\n\t<h5>Comment variables</h5>\n\t<ul>\n\t\t<li>{author} = comment author</li>\n\t\t<li>{website} = website</li>\n\t\t<li>{comment} = comment</li>\n\t\t<li>{date} = comment date</li>\n\t\t<li>{ip} = comment ip address</li>\n\t</ul>\n\t<h5>Comment form variables</h5>\n\t<p>Please include ALL of the data in the form, or else things won't work.</p>\n\t<ul>\n\t\t<li>{action} = value that goes inside the form</li>\n\t\t<li>{hidden_data} = required value somewhere inside the form</li>\n\t\t<li>{captcha_question} = In plain text, the question</li>\n\t\t<li>{captcha_answer} = The answer encoded and passed through form</li>\n\t</ul>\n\t<h5>Pagination variables</h5>\n\t<ul>\n\t\t<li>{previous_page} = previous page number (ex: &lt;a href=\"{previous_page}\"&gt;)</li>\n\t\t<li>{middle_pages} = middle pages, includes links already</li>\n\t\t<li>{next_page} = next page number</li>\n\t</ul>\n\t\n\t<h4>rss management</h4>\n\t<p>The rss management lets you set different aspects on the RSS feed phpns generates. You can set the title, description, online status, item limit and order.</p>\n\t\n\t<h4>search engine friendly urls</h4>\n\t<p>SEF URLs are goverened by an apache module known as 'mod_rewrite'. Phpns takes advantage of this module, however, it's still very limited. If you want to activate SEF urls, you will need to copy and paste the .htaccess code (found in preferences > search engine friendly urls) into your website directory. If it's not working, we don't recommend messing with the files or the .htaccess file, as it might break the system.</p>\n\t<p>If you're having troubles, or you need help, please visit the IRC (irc.freednode.net / #phpns).</p>\n\t\n\t<h4>comment options</h4>\n\t<p>You can set several default options here: If (by default) users can post comments, the order of the comments, and the comment character limit.</p>\n\t\n\t<h4>ban options</h4>\n\t<p>You can ban (IP ban) users who you don't want viewing your articles or posting comments by banning their IP address. In this section, you can provide their IP address, and a reason for the ban. When that user/IP visits your website, they will be presented a message with a reason for their ban.</p>\n\t\n\t<h4>integration wizard</h4>\n\t<p>The integration wizard will let you (easily) generate 'code' for you to copy/paste into your website. It should be good to go, you shouldn't have to modify anything.</p>\n\t\n\t<h4>system log</h4>\n\t<p>The system log will log (almost) every action taken by any user. All the information collected will be stored in this page, so you can view it, and see what users have been doing on your system.</p>\n\t\n\t<h4>image uploads and settings</h4>\n\t<p>This feature is not functional yet, wait until alpha 2.</p>\n\t\n\t<h4>database backup</h4>\n\t<p>This feature will let you backup the data in your database to a file. Just click the backup button, and wait until the file is processed by the server. Once it's done, the server will send you the .sql file that can be downloaded. Once you're done, and navigate to another page on phpns, you will see a notice at the top of the administration panel asking you to delete the file asap. PLEASE DO SO, it's a hazard to leave it untouched. <strong>Phpns will *try* to delete the file every time you visit the index.php page. If it works, you won't see the message anymore.</strong> Upload the file later, to replace the old database and replace it with the downloaded file.</p>\n\t\n\t<h4>online/offline options</h4>\n\t<p>Phpns can turn the whole news system on or off for the end-user. If this is set to offline, the user will not be able to see any article/category/comment in the system.</p>\n\t\n\t<h4>theme options</h4>\n\t<p>Themes let you customize how the phpns is presented to adminstrators. You can have as many themes as you want available, but only one theme (or skin, if you would prefer) can remain active. We will provide additional help on the phpns website.</p>\n\t\n\t<h4>wysiwyg editor</h4>\n\t<p>Phpns uses a WYSIWYG editor to replace all textareas on the system to a customizeable, active and complete editor. Phpns uses the <a href=\"http://tinymce.moxiecode.com/\">TinyMCE wysiwyg editor</a> released under the <a href=\"inc/wysiwyg/license.txt\">Lesser GPL</a> as published by the <a href=\"http://fsf.org\">Free Software Foudation</a>.\n\t\n\t<h4>timestamp options</h4>\n\t<p>The system timestamp format will be used on every timestamp recorderd by phpns on the administration panel. You can see the <a href=\"http://php.net/date\">php date function</a>.</p>\n\t<p>Note: This does not affect the shownews.php file.</p>\n\t\n\t<h4>disable logging in</h4>\n\t<p>This feature is not implimented yet.</p>\n\t\n\t<h4>delete login records</h4>\n\t<p>Deletes all login records in user management.</p>\n\t\n\t<h4>rank management</h4>\n\t<p>You can manage/create/delete ranks created.</p>\n\t\n\t<h4>global message</h4>\n\t<p>The global message is used to notify fellow administrators of any important messages... or announcements that login to the administration panel. You can leave the global message blank to nullify the message.</p>\n\t\n\t<h3 id=\"about\">about help</h3>\n\t<p>The about page lists many pieces of information that you will find helpful in regards to the phpns project. Please look through the page, and if you feel like it's missing vital information, please tell us!</p>\n\t<p>The latest articles and version check require you to be connected to the internet, so it can access the phpns website. It's provided purely for your convienence.</p>\n</body>\n</html>\n"}]}
{"id": 5, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\index.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n$globalvars['page_name'] = 'index';\ninclude(\"inc/header.php\");\n\n\tif ($_GET['do'] == NULL) { //if no action, we display index as usual\n\t\t$num['article'] = content_num(\"articles\",1,0);\n\t\t$num['users'] = content_num(\"users\",1,0);\n\t\t$num['categories'] = content_num(\"categories\",1,0);\n\t\t$num['pendarticle'] = content_num(\"articles\",1,1);\n\t\t$num['logins'] = content_num(\"userlogin\",1,0);\n\t\t$num['unapproved'] = content_num(\"articles\",1,2);\n\t\n\t\t$load_recent = load_items('articles',0,4,'','','');  //load recent items (SQL)\n\t\n\t\twhile($recent_row = mysql_fetch_array($load_recent)) {\n\t\t\t$recent_row_gen = $recent_row_gen.\n\t\t\t'<li><a href=\"article.php?id='.$recent_row['id'].'&do=edit\">'.$recent_row['article_title'].'</a></li>';\n\t\t}\n\t\t\n\t\t$content = \"\t\t\t\n\t\t\t<h3>Information</h3>\n\t\t\t<div id=\\\"columnright\\\">\n\t\t\t\t<h4>Recent articles</h4>\n\t\t\t\t<ul>\n\t\t\t\t\t\".$recent_row_gen.\"\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<h4>Statistics</h4>\n\t\t\t<ul id=\\\"stats\\\">\n\t\t\t\t<li>There are currently <a href=\\\"manage.php\\\">\" . $num['article'] . \" articles posted</a>  with <a href=\\\"preferences.php?do=categories\\\">\" . $num['categories'] . \" categories</a></li>\n\t\t\t\t<li>There are currently <a href=\\\"user.php\\\">\" . $num['users'] . \" active users</a></li>\n\t\t\t\t<li>There are currently <a href=\\\"manage.php?v=unactive\\\">\" . $num['pendarticle'] . \" drafts</a> and <a href=\\\"manage.php?v=unapproved\\\">\" . $num['unapproved'] . \" unapproved articles</a></li>\n\t\t\t\t<li>There are currently <a href=\\\"user.php?do=loginrec\\\">\" . $num['logins'] . \" login records</a></li>\n\t\t\t</ul>\n\t\t\";\n\t} elseif ($_GET['do'] == \"permissiondenied\") { //display permission denied error\n\t\t$globalvars['page_name'] = 'permission denied';\n\t\t$globalvars['page_image'] = 'lock';\n\t\t\n\t\t$content = '<h3>Why am I getting this?</h3>\n\t\t<p>When your rank was created, the author denied any members associated with this rank to view this feature/page. If you think you should have access, contact your admin. If this has just barely been changed for you, you will need to logout and log back in.</p> ';\n\t}\n\t\ninclude(\"inc/themecontrol.php\");  //include theme script\n?>\n"}]}
{"id": 6, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\login.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n$globalvars['pagetype'] = \"login\";  //set page type\ninclude(\"inc/header.php\"); //include header file\n\n$do = $_GET['do']; //get action\n\t\n\tif ($_GET['m'] == \"out\") {\n\t\t$message = '<div class=\"warning\">You are successfully logged out!</div>';\n\t} elseif ($_GET['m'] == \"nologin\") {\n\t\t$message = '<div class=\"warning\">Your username and password are correct, however, your rank is disallowing logging in at this time. Contact your administrator if you think this is a mistake.</div>';\n\t}\n\nif (!$do) {\n\t$content = '\n\t\t<div id=\"login\">\n\t\t\t<form id=\"login_form\" action=\"?do=p\" method=\"post\">\n\t\t\t\t'.$message.'\n\t\t\t\t<h2>User login</h2>\n\t\t\t\t<label for=\"username\">Username</label> <input type=\"text\" name=\"username\" id=\"username\" onLoad=\"focus()\" /><br />\n\t\t\t\t<label for=\"password\">Password</label> <input type=\"password\" name=\"password\" id=\"password\" /><br />\n\t\t\t\t<label for=\"remember\">Remember me</label> <input type=\"checkbox\" name=\"remember\" id=\"remember\">\n\t\t\t\t<div id=\"login_submit\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Login\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t\t<script type=\"text/javascript\"> \n\t\t\t\tdocument.getElementById(\\'username\\').focus(); \n\t\t\t</script> \n\t\t</div>';\n} elseif ($do == \"p\") {\n\t$loginvar = array(\"username\"=>$_POST['username'],\"password\"=>sha1($_POST['password']),\"remember\"=>$_POST['remember']);\n\t\n\t\t$loginvar = clean_data($loginvar); //clean the data\n\t\n\t//check if database has entry + password\n\t$lsql = \"SELECT * FROM \".$databaseinfo['prefix'].\"users WHERE user_name='\".$loginvar['username'].\"' AND  password='\".$loginvar['password'].\"'\";\n\t$lres = mysql_query($lsql) or die(mysql_error()); \n\t$lnumcheck = mysql_num_rows($lres);\n\t\tif ($lnumcheck == 0) { //if no result was found...\n\t\t\t$content = '<div id=\"login_error\" class=\"warning\">\n\t\t\t\t<h3>Login failed</h3>\n\t\t\t\t<p>We could not find a user entry with that username and password. If you have forgotten your password, use the recovery tool. Cookies must be enabled to login to the system!</p>\n\t\t</div>\n\t\t\n\t\t\t\t<div id=\"login\">\n\t\t\t<form id=\"login_form\" action=\"?do=p\" method=\"post\">\n\t\t\t\t<h2>User login</h2>\n\t\t\t\t<label for=\"username\">Username</label> <input type=\"text\" name=\"username\" id=\"username\" value=\"' . $loginvar['username'] . '\" /><br />\n\t\t\t\t<label for=\"password\">Password</label> <input type=\"password\" name=\"password\" id=\"password\" class=\"outline\" /><br />\n\n\t\t\t\t<label for=\"remember\">Remember me</label> <input type=\"checkbox\" name=\"remember\" id=\"remember\">\n\t\t\t\t<div id=\"login_submit\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Login\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t\t<script type=\"text/javascript\"> \n\t\t\t\tdocument.getElementById(\\'password\\').focus(); \n\t\t\t</script> \n\t\t</div>';\n\t\t} else {\n\t\t\t//insert login record.\n\t\t\t$loginvar['timestamp'] = time();\n\t\t\t\n\t\t\t\t//get some vars from db\n\t\t\t\t$fdata = general_query('SELECT * FROM '.$databaseinfo['prefix'].'users WHERE user_name=\"'.$loginvar['username'].'\"', TRUE);\n\t\t\t\t\t//get rank string\n\t\t\t\t\t$rdata = general_query('SELECT * FROM '.$databaseinfo['prefix'].'ranks WHERE id='.$fdata['rank_id'].'', TRUE);\n\t\t\t\t\t//insert login record\n\t\t\t\t\t$res = general_query(\"INSERT INTO \".$databaseinfo['prefix'].\"userlogin \n\t\t\t\t\t(username,rank_id,timestamp,ip) \n\t\t\t\t\tVALUES (\n\t\t\t\t\t'\".$loginvar['username'].\"',\n\t\t\t\t\t'\".$rdata['id'].\"',\n\t\t\t\t\t'\".$loginvar['timestamp'].\"',\n\t\t\t\t\t'\".$globalvars['ip'].\"')\");\n\t\t\t\t\t\n\t\t\t//define session variables, set cookies\n\t\t\t$_SESSION['username'] = $fdata['user_name'];\n\t\t\t$_SESSION['userID'] = $fdata['id'];\n\t\t\t$_SESSION['permissions'] = $rdata['permissions'];\n\t\t\t$_SESSION['auth'] = \"yes\";\n\t\t\t$_SESSION['path'] = $globalvars['path_to'];\n\t\t\t\t\n\t\t\t\t//if the user wants to set a cookie, we have to do more stuff. (bleh.)\n\t\t\t\tif ($loginvar['remember']) {\n\t\t\t\t\t\t//generate randomized string for cookie identification\n\t\t\t\t\t\t//we'll generate it now.\n\t\t\t\t\t\t$cookie_string = md5(uniqid(rand(), true));\n\t\t\t\t\t$cookielog_res = general_query('INSERT INTO '.$databaseinfo['prefix'].'cookielog \n\t\t\t\t\t(user_id,rank_id,cookie_id,timestamp,ip)\n\t\t\t\t\tVALUES (\n\t\t\t\t\t\"'.$fdata['id'].'\",\n\t\t\t\t\t\"'.$fdata['rank_id'].'\",\n\t\t\t\t\t\"'.$cookie_string.'\",\n\t\t\t\t\t\"'.$loginvar['timestamp'].'\",\n\t\t\t\t\t\"'.$globalvars['ip'].'\"\n\t\t\t\t\t)');\n\t\t\t\t\t\n\t\t\t\t\tsetcookie('cookie_auth', $cookie_string, time()+604800); //set cookie to expire in a week\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//quick permission check (redir to error)\n\t\t\t\tif ($rdata['permissions'][8] == 0) {\n\t\t\t\t\tsession_destroy();\n\t\t\t\t\theader(\"Location: login.php?m=nologin\");\n\t\t\t\t\tdie();\t\n\t\t\t\t}\n\t\t\t\n\t\t\t//log the login\n\t\t\tlog_this('login','User <i>'.$_SESSION['username'].'</i> has <strong>logged in</strong>');\n\t\t\t\n\t\t\t//go to index\n\t\t\theader(\"Location: index.php\"); //redirect to index\n\t\t}\n\t\n} elseif ($do == \"logout\") { //if we're logging out...\n\tlog_this('logout','User <i>'.$_SESSION['username'].'</i> has <strong>logged out</strong>.');\n\tsession_destroy(); //session is pwned.\n\theader(\"Location: login.php?m=out\");\n}\ninclude(\"inc/themecontrol.php\");\n?>\n"}]}
{"id": 7, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\manage.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\ninclude(\"inc/header.php\");\n$do = $_GET['do'];\n\n//determine pagintation variables and sorting\n\t$page = $_GET['page'];\n\tif (!$page) {\n\t\t$page = 1;\n\t}\n\t$items_per_page = 20;\n\t$page_start = ($page*$items_per_page) - $items_per_page;\n\t$next_page = $page + 1;\n\t$prev_page = $page - 1;\n\t\t//get sorting info and view\n\t\t$sort = $_GET['sort'];\n\t\t$v = $_GET['v']; \n//END OF PAGINATION/SORTING\n\n//we start the actual page generation. If there is no specific action being done ($do == \"\"), generate default view\nif (!$do) {\n\t$globalvars['page_name'] = 'article management';\t\n\n\t//generate query, and execute function\n\t$item_list = load_items('articles',$page_start,$items_per_page,$sort,$v);\n\t\n\tif (mysql_num_rows($item_list) == NULL) { //if no results\n\t\t$table_rows = '<td class=\"noresults\" colspan=\"6\"><strong>No returned results...</strong></td>';\n\t}\n\t\n\twhile ($item_row = mysql_fetch_array($item_list)) { //for each item in db\n\t\t//convert timestamp to readable/human date\n\t\t$item_row['timestamp'] = date($globalvars['time_format'],$item_row['timestamp']);\n\t\t$item_row['article_cat_name'] = gen_cat_name($item_row['article_cat']); //switch cat_id to readable name\n\t\t$row_bg = ($row_bg == '#F5F5F5') ? '#ffffff' : '#F5F5F5'; //current row bg\n\t\t\n\t\t\t//switch active column to yes, draft, or unapproved.\n\t\t\tif ($item_row['active'] == 1) { $item_row['active'] = '<span class=\"positive\">Yes</span>'; } elseif ($item_row['active'] == 0) { $item_row['active'] = '<span class=\"negative\">Draft</span>'; }\n\t\t\tif ($item_row['approved'] == 0) { $item_row['active'] = '<span class=\"negative\">Unapproved</span>'; }\n\t\t\t\n\t\t//generate the actual html rows\n\t\t$table_rows = $table_rows.'<tr bgcolor=\"'.$row_bg.'\"><td><a href=\"article.php?id='.$item_row['id'].'&do=edit\"><strong>'.$item_row['article_title'].'</strong></a></td>\n\t\t\t<td><a href=\"manage.php?v='.$item_row['article_cat'].'\">'.$item_row['article_cat_name'].'</a></td>\n\t\t\t<td>'.$item_row['timestamp'].'</td>\n\t\t\t<td><a href=\"manage.php?v='.$item_row['article_author'].'\">'.$item_row['article_author'].'</a></td>\n\t\t\t<td align=\"center\">'.$item_row['active'].'</td>\n\t\t\t<td class=\"checkbox\"><input type=\"checkbox\" value=\"'.$item_row['id'].'\" name=\"'.$item_row['id'].'\"></td></tr>';\n\t} //end of each item in db generation\n\t\n\t$content = manage_form(); //generate form\n\n} elseif ($do == \"deleteitems\") { //if we're deleting items\n\n\t\t//quick permission check (redir to error)\n\t\tif ($globalvars['rank'][16] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\tdie();\t\n\t\t}\n\t$items = $_POST; //get vars\n\tif (!$items) { //if no items, avoid mysql error by just redirecting\n\t\theader(\"Location: manage.php\");\n\t}\n\t\t//we're going to create list of ids to be deleted from database.\n\t\tforeach($items as $key=>$value) {\n\t\t\t$items_f = $items_f.\"'$key',\";\n\t\t}\n\t\t//remove last comma in list for SQL\n\t\t$items_f = substr_replace($items_f,\"\",-1);\n\t//delete the items in 'articles'\n\tdelete('articles',$items_f);\n\t\n\t//log this action\n\tlog_this('delete_items','User <i>'.$_SESSION['username'].'</i> has <strong>deleted</strong> the following articles: \"'.$items_f.'\"');\n\t\n\t//redirect back to manage.php\n\theader(\"Location: manage.php\");\n\t\n} elseif ($do == \"search\") { //search\n\t$globalvars['page_name'] = 'search'; //set page name\n\t\n\t\t//get query and category from POST or from GET\n\t\t$search['query'] = $_POST['query'];\n\t\tif ($search['query'] == \"\") { $search['query'] = $_GET['q']; }\n\t\t$search['category'] = $_POST['category'];\n\t\tif (!$search['category']) { $search['category'] = $_GET['c']; }\n\t\n\tif ($search['query'] == \"click here to start the search...\" || $search['query'] == \"\") {\n\t\theader(\"Location: manage.php\");\n\t}\n\t\n\t$searchres = search($search); //form and execute search query/cat\n\t\t//if no results\n\t\tif (mysql_num_rows($searchres) == 0) { $table_rows = '<td class=\"noresults\" colspan=\"6\"><strong>No returned results...</strong></td>'; }\n\t\n\t//for each item, generate html table row\n\twhile ($item_row = mysql_fetch_assoc($searchres)) {\n\t\t//convert timestamp to readable/human date\n\t\t$item_row['timestamp'] = date($globalvars['time_format'],$item_row['timestamp']);\n\t\t$item_row['article_cat_name'] = gen_cat_name($item_row['article_cat']); //switch cat_id to readable name\n\t\t$row_bg = ($row_bg == '#ffffff') ? '#F5F5F5' : '#ffffff'; //current row bg\n\t\t\n\t\t\t//switch active column to yes, draft, or unapproved.\n\t\t\tif ($item_row['active'] == 1) { $item_row['active'] = '<span class=\"positive\">Yes</span>'; } elseif ($item_row['active'] == 0) { $item_row['active'] = '<span class=\"negative\">Draft</span>'; }\n\t\t\tif ($item_row['approved'] == 0) { $item_row['active'] = '<span class=\"negative\">Unapproved</span>'; }\n\t\t\t\n\t\t//generate the actual html rows\n\t\t$table_rows = $table_rows.'<tr bgcolor=\"'.$row_bg.'\"><td><a href=\"article.php?id='.$item_row['id'].'&do=edit\"><strong>'.$item_row['article_title'].'</strong></a></td><td><a href=\"manage.php?v='.$item_row['article_cat'].'\">'.$item_row['article_cat_name'].'</a></td><td>'.$item_row['timestamp'].'</td><td><a href=\"manage.php?v='.$item_row['article_author'].'\">'.$item_row['article_author'].'</a></td><td align=\"center\">'.$item_row['active'].'</td><td class=\"checkbox\"><input type=\"checkbox\" value=\"'.$item_row['id'].'\" name=\"'.$item_row['id'].'\"></td></tr>';\n\t} //end of table row creation\n\t\n\t$content = manage_form();\n} //end if main do (search elseif)\n\ninclude(\"inc/themecontrol.php\");  //include theme script\n?>\n"}]}
{"id": 8, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\preferences.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\ninclude(\"inc/header.php\");\n$do = $_GET['do'];\n\n\t//quick permission check (redir to error)\n\tif ($globalvars['rank'][6] == 0) {\n\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\tdie();\t\n\t}\n\n\tif (!$do) { //just display the selection menu\n\t\t$globalvars['page_name'] = \"preferences\";\n\t\t$content = '\n\t\t\t<h3>News display options</h3>\n\t\t\t<div id=\"columnright\">\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href=\"?do=sef\">search engine friendly urls</a></li>\n\t\t\t\t\t<li><a href=\"?do=comments\">comment options</a></li>\n\t\t\t\t\t<li><a href=\"?do=ban\">ban options</a></li>\n\t\t\t\t\t<li><a href=\"?do=wizard\">integration wizard</a></li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href=\"?do=display\">general display options</a></li>\n\t\t\t\t\t<li><a href=\"?do=categories\">category management</a></li>\n\t\t\t\t\t<li><a href=\"?do=templates\">template management</a></li>\n\t\t\t\t\t<li><a href=\"?do=rss\">rss management</a></li>\n\t\t\t\t</ul>\n\t\t\t<h3>Editing/System options</h3>\n\t\t\t<div id=\"columnright\">\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href=\"?do=themes\">theme options</a></li>\n\t\t\t\t\t<li><a href=\"?do=wysiwyg\">WYSIWYG editor</a></li>\n\t\t\t\t\t<li><a href=\"?do=timestamp\">timestamp options</a></li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href=\"?do=syslog\">system log</a></li>\n\t\t\t\t\t<li><a href=\"?do=backup\">database backup</a></li>\n\t\t\t\t\t<li><a href=\"?do=line\">online/offline options</a></li>\n\t\t\t\t</ul>\n\t\t\t<h3>User options</h3>\n\t\t\t<div id=\"columnright\">\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href=\"user.php?do=ranks\">rank management</a></li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href=\"user.php?do=loginrec&amp;action=delall\" onClick=\"return confirm(\\'Are you sure you want to delete all login records?\\');\">delete login records</a></li>\n\t\t\t\t</ul>\n\t\t\t\n\t\t\t<h3>Misc options</h3>\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href=\"?do=globalmessage\">global message</a></li>\n\t\t\t\t</ul>';\n\t} elseif ($do == \"categories\") { //if category\n\t\t$action = $_GET['action'];\n\t\t//if create new category\n\t\tif ($action == \"new\") { //if new category\n\t\t\t$data = $_POST;\n\t\t\t\tif (empty($data['name'])) {\n\t\t\t\t\t$proceed = \"no\";\n\t\t\t\t\t$error_messages = '<ol class=\"warning\"><li>A name is required for the category!</li></ol>';\n\t\t\t\t}\n\t\t\t//execute SQL function if no errors\n\t\t\tif ($proceed != \"no\") {\n\t\t\tnew_category($data,$_SESSION['username']);\n\t\t\tunset($data);\n\t\t\t}\n\t\t\t\n\t\t} elseif($action == \"deleteitems\") {\n\t\t\t$items = $_POST; //get vars\n\t\t\t$move_cat = $_POST['move_cat'];\n\t\t\tunset($items['move_cat']);\n\t\t\tforeach($items as $key=>$value) { //create list of ids to be deleted\n\t\t\t\t$items_f = $items_f.\"'$value',\";\n\t\t\t}\n\t\t\t$items_f = substr_replace($items_f,\"\",-1); //remove last comma in list for SQL\n\t\t\t$res = general_query(\"DELETE FROM \".$databaseinfo['prefix'].\"categories WHERE id IN (\".clean_data($items_f).\")\"); //delete all records where the id is in the list\n\t\t\t\n\t\t\t//log the deletion\n\t\t\tlog_this('delete_categories','User <i>'.$_SESSION['username'].'</i> has <strong>deleted</strong> the following categories (ID(s)): '.$items_f.'');\n\t\t\t\n\t\t\t//form sql for deletion of sub cats\n\t\t\t$res_subdel = general_query(\"DELETE FROM \".$databaseinfo['prefix'].\"categories WHERE cat_parent IN (\".clean_data($items_f).\"\"); //delete all records where the id is in the list\n\t\t\t\t//move items to selected cateogry\n\t\t\t\t$res_m = general_query('UPDATE '.$databaseinfo['prefix'].'articles SET article_cat=\"'.clean_data($move_cat).'\" WHERE article_cat IN ('.clean_data($items_f).')');\n\t\t\theader(\"Location: preferences.php?do=categories\");\n\t\t}\n\t\t$globalvars['page_name'] = \"categories\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t$data['cat_list'] = gen_categories('option','top');\n\t\t$table_rows = gen_categories('row','');\n\t\t$move_selected = gen_categories('option','');\n\t\t\n\t\t$content = '\n\t\t<h3>Create new category</h3>\n\t\t<div class=\"form\">\n\t\t\t'.$error_messages.'\n\t\t\t<form action=\"preferences.php?do=categories&amp;action=new\" method=\"post\">\n\t\t\t\t<label for=\"name\">Category name</label><input type=\"text\" id=\"name\" name=\"name\" /> <input type=\"submit\" value=\"Create category\" /><br />\n\t\t\t\t<label for=\"description\">Description</label><input type=\"text\" id=\"description\" name=\"description\" value=\"'.$data['description'].'\" /><br />\n\t\t\t\t<label for=\"parent\">Parent</label>\n\t\t\t\t<select name=\"parent\">\n\t\t\t\t\t<option value=\"\">None</option>\n\t\t\t\t\t<optgroup label=\"Categories\">\n\t\t\t\t\t\t'.$data['cat_list'].'\n\t\t\t\t\t</optgroup>\n\t\t\t\t</select>\n\t\t\t</form>\n\t\t</div>\n\t\t<h3>Category list</h3>\n\t\t<form action=\"preferences.php?do=categories&amp;action=deleteitems\" method=\"post\">\n\t\t\t<table style=\"text-align: left; width: 100%;\" border=\"1\"\n\t\t\t\t cellpadding=\"3\" cellspacing=\"2\">\n\t\t\t\t  <tbody>\n\t\t\t\t    <tr class=\"toprow\">\n\t\t\t\t      <td style=\"width: 150px; text-align: left;\"><strong>Name</strong></td>\n\t\t\t\t      <td style=\"width: 150px;\"><strong>Parent (?)</strong></td>\n\t\t\t\t      <td><strong>Description</strong></td>\n\t\t\t\t      <td style=\"width: 135px\"><strong>Date</strong></td>\n\t\t\t\t      <td style=\"width: 10px; text-align: center;\"><strong><input type=\"checkbox\" onClick=\"Checkall(this.form);\" /></strong></td>\n\t\t\t\t    </tr>\n\t\t\t\t    '.$table_rows.'\n\t\t\t\t  </tbody>\n\t\t\t</table>\n\t\t\t<div style=\"text-align: right;\">\n\t\t\t\tMove items from categories (that will be deleted) to: <select id=\"move_cat\" name=\"move_cat\" style=\" margin: 0;\">\n\t\t\t\t\t'.$move_selected.'\n\t\t\t\t</select>\n\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Delete Selected\" />\n\t\t\t</div>\n\t\t</form>\n\t\t';\n\t\n\t} elseif ($do == \"display\") { //if displaly options\n\t\t//define page name and image\n\t\t$globalvars['page_name'] = \"display options\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t\n\t\t\tif ($_GET['action'] == \"update\") {\n\t\t\t\tchange_config('def_limit',$_POST['def_limit']);\n\t\t\t\tchange_config('def_offset',$_POST['def_offset']);\n\t\t\t\tchange_config('timestamp_format',$_POST['timestamp_format']);\n\t\t\t\tchange_config('def_order',$_POST['def_order']);\n\t\t\t\tchange_config('def_items_per_page',$_POST['def_items_per_page']);\n\t\t\t\t$error_message = '<div class=\"warning\">Your preferences have been saved.</div>';\n\t\t\t\t\n\t\t\t\t//log the change\n\t\t\t\tlog_this('display_config','User <i>'.$_SESSION['username'].'</i> has <strong>edited</strong> the default display options');\n\t\t\t}\n\t\t\n\t\t//generate gconfig values\n\t\t$timestamp_format = load_config('timestamp_format');\n\t\t$def_offset = load_config('def_offset');\n\t\t$def_items_per_page = load_config('def_items_per_page');\n\t\t$def_limit = load_config('def_limit');\n\t\t$def_order = load_config('def_order');\n\t\t\n\t\t\tif ($def_order['v1'] == \"desc\") {\n\t\t\t\t$def_order_display = \"Descending\";\n\t\t\t} elseif ($def_order['v1'] == \"asc\") {\n\t\t\t\t$def_order_display = \"Ascending\";\n\t\t\t}\n\t\t\n\t\t$content = '\n\t\t\t'.$error_message.'\n\t\t<h3>Display options</h3>\n\t\t<div class=\"form\">\n\t\t\t<form action=\"preferences.php?do=display&amp;action=update\" method=\"post\">\n\t\t\t\t<div id=\"columnright\">\n\t\t\t\t<br />\n\t\t\t\t<label for=\"def_limit\">Display limit</label>\n\t\t\t\t\t<select name=\"def_limit\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$def_limit['v1'].'\">'.$def_limit['v1'].'</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t<optgroup label=\"Choose a limit:\">\n\t\t\t\t\t\t<option>1</option>\n\t\t\t\t\t\t<option>2</option>\n\t\t\t\t\t\t<option>3</option>\n\t\t\t\t\t\t<option>5</option>\n\t\t\t\t\t\t<option>10</option>\n\t\t\t\t\t\t<option>15</option>\n\t\t\t\t\t\t<option>20</option>\n\t\t\t\t\t\t<option>30</option>\n\t\t\t\t\t\t<option>50</option>\n\t\t\t\t\t\t<option>100</option>\n\t\t\t\t\t\t<option>200</option>\n\t\t\t\t\t\t<option>500</option>\n\t\t\t\t\t\t<option>1000</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<br />\n\t\t\t\t<label for=\"def_order\">Reverse items</label>\n\t\t\t\t\t<select name=\"def_order\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$def_order['v1'].'\">'.$def_order_display.'</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t\t\t<option value=\"asc\">Ascending</option>\n\t\t\t\t\t\t<option value=\"desc\">Descending</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t<label for=\"def_offset\">Display offset</label>\n\t\t\t\t\t<input type=\"text\" name=\"def_offset\" value=\"'.$def_offset['v1'].'\" style=\"width: 50px\" />\n\t\t\t\t\t<br />\n\t\t\t\t<label for=\"def_items_per_page\">Items per page</label>\n\t\t\t\t\t<input type=\"text\" name=\"def_items_per_page\" value=\"'.$def_items_per_page['v1'].'\" style=\"width: 50px\" />\n\t\t\t\t\t<br />\n\t\t\t\t<label for=\"timestamp_format\">Date format</label>\n\t\t\t\t\t<input type=\"text\" name=\"timestamp_format\" value=\"'.$timestamp_format['v3'].'\" /> <br />(<a href=\"http://us2.php.net/date\">date function help</a>)\n\t\t\t\t\t<br />\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Save\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t\t';\n\t\n\t} elseif ($do == \"comments\") { //if comment options\n\t\t//define page name and image\n\t\t$globalvars['page_name'] = 'comment options';\n\t\t$globalvars['page_image'] = 'preferences';\n\t\t\n\t\t\tif ($_GET['action'] == \"update\") {\n\t\t\t\tchange_config('def_comlimit',$_POST['def_comlimit']);\n\t\t\t\tchange_config('def_comorder',$_POST['def_comorder']);\n\t\t\t\tchange_config('def_comenabled',$_POST['def_comenabled']);\n\t\t\t\t\n\t\t\t\t$error_message = '<div class=\"warning\">Your preferences have been saved.</div>';\n\t\t\t\t\n\t\t\t\t//log the change\n\t\t\t\tlog_this('comment_config','User <i>'.$_SESSION['username'].'</i> has <strong>edited</strong> the default comment options');\n\t\t\t}\n\t\t\n\t\t//generate gconfig values\n\t\t$def_comlimit = load_config('def_comlimit');\n\t\t$def_comorder = load_config('def_comorder');\n\t\t$def_comenabled = load_config('def_comenabled');\n\t\t\n\t\tif ($def_comorder['v1'] == \"desc\") {\n\t\t\t\t$def_comorder_display = \"Descending\";\n\t\t\t} elseif ($def_comorder['v1'] == \"asc\") {\n\t\t\t\t$def_comorder_display = \"Ascending\";\n\t\t\t}\n\t\t\t\n\t\tif ($def_comenabled['v1'] == 0) {\n\t\t\t\t$def_comenabled_display = \"No\";\n\t\t\t} elseif ($def_comenabled['v1'] == 1) {\n\t\t\t\t$def_comenabled_display = \"Yes\";\n\t\t\t}\n\t\t\n\t\t$content = '\n\t\t\t'.$error_message.'\n\t\t<h3>Display options</h3>\n\t\t<div class=\"form\">\n\t\t\t<form action=\"preferences.php?do=comments&amp;action=update\" method=\"post\">\n\t\t\t\t<div id=\"columnright\">\n\t\t\t\t<br />\n\t\t\t\t<label for=\"def_comlimit\">Character Limit</label>\n\t\t\t\t\t<select name=\"def_comlimit\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$def_comlimit['v3'].'\">'.$def_comlimit['v3'].'</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t<optgroup label=\"Choose a limit:\">\n\t\t\t\t\t\t<option>50</option>\n\t\t\t\t\t\t<option>100</option>\n\t\t\t\t\t\t<option>200</option>\n\t\t\t\t\t\t<option>300</option>\n\t\t\t\t\t\t<option>500</option>\n\t\t\t\t\t\t<option>750</option>\n\t\t\t\t\t\t<option>1000</option>\n\t\t\t\t\t\t<option>1050</option>\n\t\t\t\t\t\t<option>1100</option>\n\t\t\t\t\t\t<option>1200</option>\n\t\t\t\t\t\t<option>1500</option>\n\t\t\t\t\t\t<option>2000</option>\n\t\t\t\t\t\t<option>5000</option>\n\t\t\t\t\t\t<option>10000</option>\n\t\t\t\t\t\t<option>100000</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<br />\n\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t<label for=\"def_comenabled\">Comments active</label>\n\t\t\t\t\t<select name=\"def_comenabled\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$def_comenabled['v1'].'\">'.$def_comenabled_display.'</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t<optgroup label=\"Active:\">\n\t\t\t\t\t\t\t<option value=\"1\">Yes</option>\n\t\t\t\t\t\t\t<option value=\"0\">No</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<br />\n\t\t\t\t<label for=\"def_comorder\">Reverse comments</label>\n\t\t\t\t\t<select name=\"def_comorder\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$def_comorder['v1'].'\">'.$def_comorder_display.'</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t\t\t<option value=\"asc\">Ascending</option>\n\t\t\t\t\t\t<option value=\"desc\">Descending</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<br />\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Save\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t\t';\n\t} elseif ($do == \"rss\") { //if rss\n\t\t$globalvars['page_name'] = 'rss options';\n\t\t$globalvars['page_image'] = 'preferences'; //set preferences image\n\t\t\tif ($_GET['action'] == \"update\") {\n\t\t\t\tchange_config('def_rsslimit',$_POST['def_rsslimit']);\n\t\t\t\tchange_config('def_rssorder',$_POST['def_rssorder']);\n\t\t\t\tchange_config('def_rsstitle',$_POST['def_rsstitle']);\n\t\t\t\tchange_config('def_rssdesc',$_POST['def_rssdesc']);\n\t\t\t\tchange_config('def_rssenabled',$_POST['def_rssenabled']);\n\t\t\t\t\n\t\t\t\t$error_message = '<div class=\"warning\">Your preferences have been saved.</div>';\n\t\t\t\t\n\t\t\t\t//log the change\n\t\t\t\tlog_this('rss_config','User <i>'.$_SESSION['username'].'</i> has <strong>edited</strong> the default rss options');\n\t\t\t}\n\t\t\n\t\t//generate gconfig values\n\t\t$def_rsslimit = load_config('def_rsslimit');\n\t\t$def_rssorder = load_config('def_rssorder');\n\t\t$def_rssenabled = load_config('def_rssenabled');\n\t\t$def_rsstitle = load_config('def_rsstitle');\n\t\t$def_rssdesc = load_config('def_rssdesc');\n\t\t\n\t\tif ($def_rssorder['v1'] == \"desc\") {\n\t\t\t\t$def_rssorder_display = \"Descending\";\n\t\t\t} elseif ($def_rssorder['v1'] == \"asc\") {\n\t\t\t\t$def_rssorder_display = \"Ascending\";\n\t\t\t}\n\t\t\t\n\t\tif ($def_rssenabled['v1'] == 0) {\n\t\t\t\t$def_rssenabled_display = \"No\";\n\t\t\t} elseif ($def_rssenabled['v1'] == 1) {\n\t\t\t\t$def_rssenabled_display = \"Yes\";\n\t\t\t}\n\t\t\n\t\t$content = '\n\t\t\t'.$error_message.'\n\t\t<h3>Display options</h3>\n\t\t<div class=\"form\">\n\t\t\t<form action=\"preferences.php?do=rss&amp;action=update\" method=\"post\">\n\t\t\t\t<div id=\"columnright\">\n\t\t\t\t<br />\n\t\t\t\t<label for=\"def_rsslimit\">Item limit</label>\n\t\t\t\t\t<select name=\"def_rsslimit\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$def_rsslimit['v3'].'\">'.$def_rsslimit['v3'].'</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t<optgroup label=\"Choose a limit:\">\n\t\t\t\t\t\t<option>1</option>\n\t\t\t\t\t\t<option>2</option>\n\t\t\t\t\t\t<option>3</option>\n\t\t\t\t\t\t<option>5</option>\n\t\t\t\t\t\t<option>7</option>\n\t\t\t\t\t\t<option>10</option>\n\t\t\t\t\t\t<option>15</option>\n\t\t\t\t\t\t<option>20</option>\n\t\t\t\t\t\t<option>25</option>\n\t\t\t\t\t\t<option>30</option>\n\t\t\t\t\t\t<option>50</option>\n\t\t\t\t\t\t<option>75</option>\n\t\t\t\t\t\t<option>100</option>\n\t\t\t\t\t\t<option>150</option>\n\t\t\t\t\t\t<option>200</option>\n\t\t\t\t\t\t<option>500</option>\n\t\t\t\t\t\t<option>1000</option>\n\t\t\t\t\t\t<option>10000</option>\n\t\t\t\t\t\t<option>100000</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<br />\n\t\t\t\t\t\n\t\t\t\t\t<label for=\"def_rssorder\">Reverse RSS</label>\n\t\t\t\t\t<select name=\"def_rssorder\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$def_rssorder['v1'].'\">'.$def_rssorder_display.'</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t\t\t<option value=\"asc\">Ascending</option>\n\t\t\t\t\t\t<option value=\"desc\">Descending</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<br />\n\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t<label for=\"def_rssenabled\">RSS online</label>\n\t\t\t\t\t<select name=\"def_rssenabled\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$def_rssenabled['v1'].'\">'.$def_rssenabled_display.'</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t<optgroup label=\"Active:\">\n\t\t\t\t\t\t\t<option value=\"1\">Yes</option>\n\t\t\t\t\t\t\t<option value=\"0\">No</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<br />\n\t\t\t\t<label for=\"def_rsstitle\">RSS title</label>\n\t\t\t\t\t<input type=\"text\" name=\"def_rsstitle\" value=\"'.$def_rsstitle['v3'].'\" style=\"width: 135px\" />\n\t\t\t\t\t<br />\n\t\t\t\t<label for=\"def_rssdesc\">RSS description</label>\n\t\t\t\t\t<input type=\"text\" name=\"def_rssdesc\" value=\"'.$def_rssdesc['v3'].'\" style=\"width: 50px\" />\n\t\t\t\t\t<br />\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Save\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t\t';\n\t} elseif ($do == \"templates\") {\n\t\t//define page name & default image\n\t\t$globalvars['page_name'] = 'templates';\n\t\t$globalvars['page_image'] = 'preferences'; //set preferences image\n\t\t$action = $_GET['action'];\n\t\t\n\t\t\tif ($action == \"switch\") {  //switch default template\n\t\t\t\t$sw_id = $_POST['select'];\n\t\t\t\t\n\t\t\t\tif (switch_template($sw_id)) {\n\t\t\t\t\t$message = '<div class=\"warning\">The template you selected is now the default template.</div>';\n\t\t\t\t} else {\n\t\t\t\t\t$message = '<div class=\"warning\">There was an error switching the template.</div>';\n\t\t\t\t}\n\t\t\t\tunset($action);\n\t\t\t}\n\t\t\n\t\tif (!$action) {\n\t\t\t//we're going to fetch all the available templates.\n\t\t\t$tres = general_query('SELECT * FROM '.$databaseinfo['prefix'].'templates'); //execute tsql\n\t\t\t$row_bg = '#ffffff'; //set original row color\n\t\t\t\twhile ($trow = mysql_fetch_assoc($tres)) { //get arrays\n\t\t\t\t\t$row_bg = ($row_bg == '#ffffff') ? '#F5F5F5' : '#ffffff'; //switch row colors\n\t\t\t\t\t$trow['timestamp'] = date($globalvars['time_format'],$trow['timestamp']);\n\t\t\t\t\t\tif ($trow['template_selected'] == TRUE) { //set the radio button to checked if it's currently selected\n\t\t\t\t\t\t\t$trow['template_selected'] = 'checked=\"checked\"';\n\t\t\t\t\t\t}\n\t\t\t\t\t$template_rows .= '\n\t\t\t\t\t<tr bgcolor=\"'.$row_bg.'\">\n\t\t\t\t\t\t<td><strong><a href=\"preferences.php?do=templates&amp;action=edit&amp;tid='.$trow['id'].'\">'.$trow['template_name'].'</a></strong></td>\n\t\t\t\t\t\t<td>'.$trow['template_desc'].'</td>\n\t\t\t\t\t\t<td>'.$trow['template_author'].'</td>\n\t\t\t\t\t\t<td>'.$trow['timestamp'].'</td>\n\t\t\t\t\t\t<td><input type=\"radio\" name=\"select\" value=\"'.$trow['id'].'\" '.$trow['template_selected'].' /></td>\n\t\t\t\t\t</tr>';\n\t\t\t\t}\n\t\t\t\n\t\t\t$content = '\n\t\t\t'.$message.'\n\t\t\t<h3>Options</h3>\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"preferences.php?do=templates&amp;action=new\">create new template</a></li>\n\t\t\t</ul>\n\t\t\t<h3>Template list</h3>\n\t\t\t<form action=\"preferences.php?do=templates&amp;action=switch\" method=\"post\">\n\t\t\t\t<table style=\"text-align: left; width: 100%;\" border=\"1\"\n\t\t\t\t\t cellpadding=\"3\" cellspacing=\"2\">\n\t\t\t\t\t  <tbody>\n\t\t\t\t\t    <tr class=\"toprow\">\n\t\t\t\t\t      <td style=\"text-align: left;\"><strong>Name</strong></td>\n\t\t\t\t\t      <td><strong>Description</strong></td>\n\t\t\t\t\t      <td style=\"\"><strong>Author</strong></td>\n\t\t\t\t\t      <td><strong>Date</strong></td>\n\t\t\t\t\t      <td style=\"width: 10px\"><strong>Active</strong></td>\n\t\t\t\t\t    </tr>\n\t\t\t\t\t    '.$template_rows.'\n\t\t\t\t</table>\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Switch template\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t\t';\n\t\t} elseif ($action == \"new\") {\n\t\t\n\t\t\t$content = template_form();\n\t\t\t\n\t\t} elseif ($action == \"newp\") { //create new template process\n\t\t\t$data = $_POST;\n\t\t\t$continue = TRUE; //set continue var\n\t\t\t\tif ($data['template_name'] == \"\") {\n\t\t\t\t\t$continue = FALSE;\n\t\t\t\t\t$error_message = '<div class=\"warning\">You must enter a title for this template before continuing.</div>';\n\t\t\t\t}\n\t\t\t\n\t\t\tif ($continue == TRUE) {\n\t\t\t\t$globalvars['page_name'] = \"template success\";\n\t\t\t\t$globalvars['page_image'] = \"success\";\n\t\t\t\t//give $data post vars\n\t\t\t\t$res = new_template($data,$_SESSION['username']);\n\t\t\t} else {\n\t\t\t\t$globalvars['page_name'] == 'templates';\n\t\t\t\t$globalvars['page_image'] == 'error';\n\t\t\t\t\n\t\t\t\t$content = template_form();\n\t\t\t}\n\t\t} elseif ($action == \"edit\") { //if editing a template\n\t\t\t$tid = $_GET['tid'];\n\t\t\t$tres = general_query('SELECT * FROM '.$databaseinfo['prefix'].'templates WHERE id='.$tid.'',1); //execute tsql\n\t\t\t$content = template_form($tres);\n\t\t} elseif ($action == \"editp\") {\n\t\t\t$data = $_POST;\n\t\t\t$continue = TRUE; //set continue var\n\t\t\t\tif ($data['template_name'] == NULL) {\n\t\t\t\t\t$continue = FALSE;\n\t\t\t\t\t$error_message = '<div class=\"warning\">You must enter a title for this template before continuing.</div>';\n\t\t\t\t}\n\t\t\t\n\t\t\tif ($continue == TRUE) {\n\t\t\t\t$globalvars['page_name'] = \"edit success\";\n\t\t\t\t$globalvars['page_image'] = \"success\";\n\t\t\t\t//give $data post vars\n\t\t\t\t$res = edit_template($data,$_SESSION['username']);\n\t\t\t} else {\n\t\t\t\t$globalvars['page_name'] == 'templates';\n\t\t\t\t$globalvars['page_image'] == 'error';\n\t\t\t\t\n\t\t\t\t$content = template_form($data);\n\t\t\t}\n\t\t}\n\t} elseif ($do == \"sef\") { //search engine friendly urls page\n\t\t$globalvars['page_name'] = 'search engine friendly urls';\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t$content = '\n\t\t<p>The suggested .htaccess file:\n\t\t\t\t<textarea class=\"code\"># .htaccess file for SEF URLs\n# SEF URL .htaccess file. PLACE THIS FILE WHEREVER YOUR NEWS IS BEING INCLUDED.\n\n\t<IfModule mod_rewrite.c> \n\t\tRewriteEngine on\n\t\tRewriteCond %{SCRIPT_FILENAME} !-d\n\t\tRewriteCond %{SCRIPT_FILENAME} !-f\n\t\tRewriteRule ^(.*)$ index.php?a=$1 [QSA]\n\t</IfModule></textarea>\n\t\t\t<p>Place this \\'.htaccess\\' file wherever your news is being displayed on your website. This is usually the root of your website, \\'/\\'. You may also change the \\'index.php\\' reference to whatever file phpns displays news in.</p>\n\t\t</ol>\n\t\t';\n\t} elseif ($do == \"ban\") { //if ban page\n\t\t$globalvars['page_name'] = \"ban options\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t\n\t\tif ($_GET['action'] == 'newp') { //if the action is new process\n\t\t\t$data = $_POST; //assign post to $data\n\t\t\tclean_data($data['reason']); //clean\n\t\t\t\n\t\t\t//if ip is empty or in an incorrect form, display error\n\t\t\tif (!$data['ip'] || !preg_match('/^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$/', $data['ip'])) {\n\t\t\t\t$error_message = '<div class=\"warning\">Please make sure the IP address is in correct form, or is not blank.</div>';\n\t\t\t} else {\n\t\t\t\tban($data,$_SESSION['username']); //ban.\n\t\t\t}\n\t\t} elseif ($_GET['action'] == \"delete\") { //if we're deleting banned ip addresses\n\t\t\t$items = $_POST; //get vars\n\t\t\tforeach($items as $key=>$value) { //create list of ids to be deleted\n\t\t\t\t$items_f = $items_f.\"'$value',\";\n\t\t\t}\n\t\t\t$items_f = substr_replace($items_f,\"\",-1); //remove last comma in list for SQL\n\t\t\t$res = general_query('DELETE FROM '.$databaseinfo['prefix'].'banlist WHERE id IN ('.$items_f.')'); //delete query\n\t\t\t\n\t\t\t//log the change\n\t\t\tlog_this('lift_ban','User <i>'.$_SESSION['username'].'</i> has <strong>lifted bans</strong> for the following ids: '.$items_f.'');\n\n\t\t}\n\n\t\t\t//fetch banned ips\n\t\t\t$bres = general_query('SELECT * FROM '.$databaseinfo['prefix'].'banlist'); //fetch query\n\t\t\twhile ($brow = mysql_fetch_assoc($bres)) { //get arrays\n\t\t\t\t\t$row_bg = ($row_bg == '#ffffff') ? '#F5F5F5' : '#ffffff'; //switch row colors\n\t\t\t\t\t$brow['timestamp'] = date($globalvars['time_format'],$brow['timestamp']);\n\t\t\t\t\t$ip_rows .= '\n\t\t\t\t\t<tr bgcolor=\"'.$row_bg.'\">\n\t\t\t\t\t\t<td><strong><a href=\"http://'.$brow['ip'].'\">'.$brow['ip'].'</a></strong></td>\n\t\t\t\t\t\t<td>'.$brow['reason'].'</td>\n\t\t\t\t\t\t<td>'.$brow['banned_by'].'</td>\n\t\t\t\t\t\t<td>'.$brow['timestamp'].'</td>\n\t\t\t\t\t\t<td><input type=\"checkbox\" value=\"'.$brow['id'].'\" name=\"'.$brow['id'].'\" /></td>\n\t\t\t\t\t</tr>';\n\t\t\t\t}\n\t\t$content = '\n\t\t'.$error_message.'\n\t\t<h3>Ban an IP</h3>\n\t\t\t<form action=\"?do=ban&amp;action=newp\" method=\"post\" class=\"form\">\n\t\t\t\t<label for=\"ip\">IP address:</label> <input class=\"extended\" type=\"text\" name=\"ip\" />\t<input type=\"submit\" id=\"submit\" value=\"Ban this IP\" /><br />\n\t\t\t\t<label for=\"reason\">Reason for ban*:</label> <input type=\"text\" class=\"extended\" name=\"reason\" />\n\t\t\t</form>\n\t\t<h3>Ban list</h3>\n\t\t\t<form action=\"preferences.php?do=ban&amp;action=delete\" method=\"post\">\n\t\t\t\t<table style=\"text-align: left; width: 100%;\" border=\"1\"\n\t\t\t\t\t cellpadding=\"3\" cellspacing=\"2\">\n\t\t\t\t\t  <tbody>\n\t\t\t\t\t    <tr class=\"toprow\">\n\t\t\t\t\t      <td style=\"text-align: left;\"><strong>IP</strong></td>\n\t\t\t\t\t      <td><strong>Reason for ban</strong></td>\n\t\t\t\t\t      <td style=\"\"><strong>Banned by</strong></td>\n\t\t\t\t\t      <td><strong>Date</strong></td>\n\t\t\t\t\t      <td style=\"width: 10px; text-align: center;\"><strong><input type=\"checkbox\" onClick=\"Checkall(this.form);\" /></strong></td>\n\t\t\t\t\t    </tr>\n\t\t\t\t\t    '.$ip_rows.'\n\t\t\t\t</table>\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Lift selected bans\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t\t';\n\t\t\n\t} elseif ($do == \"wizard\") {\n\t\t$globalvars['page_name'] = \"integration wizard\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t\n\t\t\tif ($_GET['action'] == \"p\") {\n\t\t\t\t//definitions based on what was submitted\n\t\t\t\t$generate['rss'] = ($_POST['rss']) ? ('$mode = \\'rss\\';') : ('');\n\t\t\t\t$generate['category'] = ($_POST['category']) ? (\"\\n\\t\".'$category = \\''.$_POST['category'].'\\';') : ('');\n\t\t\t\t$generate['limit'] = ($_POST['display_limit']) ? (\"\\n\\t\".'$limit = \\''.$_POST['display_limit'].'\\';') : ('');\n\t\t\t\t$generate['template'] = ($_POST['template']) ? (\"\\n\\t\".'$template = \\''.$_POST['template'].'\\';') : ('');\n\t\t\t\t$generate['order'] = ($_POST['order']) ? (\"\\n\\t\".'$order = \\''.$_POST['order'].'\\';') : ('');\n\t\t\t\t$generate['offset'] = ($_POST['offset']) ? (\"\\n\\t\".'$offset = \\''.$_POST['offset'].'\\';') : ('');\n\t\t\t\t$generate['disable_pagination'] = ($_POST['disable_pagination']) ? (\"\\n\\t\".'$disable_pagination = \\''.$_POST['disable_pagination'].'\\';') : ('');\n\t\t\t\t$generate['items_per_page'] = ($_POST['items_per_page']) ? (\"\\n\\t\".'$items_per_page = \\''.$_POST['items_per_page'].'\\';') : ('');\n\t\t\t\t$generate['override_sef'] = ($_POST['override_sef']) ? (\"\\n\\t\".'$override_sef = \\''.$_POST['override_sef'].'\\';') : ('');\n\t\t\t\t$generate['override_comments'] = ($_POST['override_comments']) ? (\"\\n\\t\".'$override_comments = \\''.$_POST['override_comments'].'\\';') : ('');\n\t\t\t\t$generate['static'] = ($_POST['static']) ? (\"\\n\\t\".'$static = \\''.$_POST['static'].'\\';') : ('');\n\t\t\t\t$generate['disable_extended_article'] = ($_POST['disable_extended_article']) ? (\"\\n\\t\".'$disable_extended_article = \\''.$_POST['disable_extended_article'].'\\';') : ('');\n\t\t\t\t\n\t\t\t\t$path_to = $_SERVER['SCRIPT_FILENAME'];\n\t\t\t\t$path_to = str_replace(\"preferences.php\",\"shownews.php\",$path_to);\n\n\t\t\t\t$content = '\n\t\t\t\t<h3>Generated code</h3>\n\t\t\t\t<p><strong>Your include code was successfully generated. Simply paste the following code wherever you want your news displayed:</strong></p>\n\t\t\t\t<textarea class=\"code\" style=\"height: 120px\">\n<?php\n/*\n\tThis file is used to generate articles managed by the phpns system. \n\tPlace this code wherever you want your articles displayed on your \n\twebsite. The page that this code is placed in should have a .php\n\textension.\n*/\n'.$generate['rss'].''.$generate['category'].''.$generate['limit'].''.$generate['template'].''.$generate['order'].''.$generate['offset'].''.$generate['disable_pagination'].''.$generate['items_per_page'].''.$generate['override_sef'].''.$generate['override_comments'].''.$generate['static'].''.$generate['disable_extended_article'].'\n\t\n\t//after variable declaration(s), include shownews.php\n\tinclude(\"'.$path_to.'\");\n?>\n</textarea>';\n\t\t\t}\n\t\t\n\t\t$data['cat_list'] = gen_categories('option','');\n\t\t$data['template_list'] = gen_templates();\n\t\t\n\t\t//integration wizard form\n\t\t$content .= '\n\t\t<h3>Display configuration</h3>\n\t\t<div class=\"form\">\n\t\t\t<form action=\"?do=wizard&amp;action=p\" method=\"post\">\n\t\t\t\t\n\t\t\t\t<label for=\"category\">Category</label>\n\t\t\t\t\t<select name=\"category\" id=\"category\">\n\t\t\t\t\t\t<option value=\"0\">All categories</option>\n\t\t\t\t\t\t<optgroup label=\"Categories\">\n\t\t\t\t\t\t\t'.$data['cat_list'].'\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<br />\n\t\t\t\t\t\n\t\t\t\t\t<label for=\"template\">Template</label>\n\t\t\t\t\t<select name=\"template\" id=\"template\">\n\t\t\t\t\t\t<option value=\"\">Default</option>\n\t\t\t\t\t\t<optgroup label=\"Templates\">\n\t\t\t\t\t\t\t'.$data['template_list'].'\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<br />\n\t\t\t\t\t<label for=\"display_limit\">Display limit</label>\n\t\t\t\t\t<input type=\"text\" name=\"display_limit\" id=\"display_limit\" value=\"\" /> (Numeric, 1 - 9999, or blank for default) <br />\n\t\t\t\t\t<label for=\"order\">Order</label>\n\t\t\t\t\t<select name=\"order\" id=\"order\">\n\t\t\t\t\t\t<option value=\"\">Default</option>\n\t\t\t\t\t\t<option value=\"desc\">Descending</option>\n\t\t\t\t\t\t<option value=\"asc\">Ascending</option>\n\t\t\t\t\t</select><br />\n\t\t\t\t\t\n\t\t\t\t\t<label for=\"offset\">Offset</label>\n\t\t\t\t\t<input type=\"text\" name=\"offset\" id=\"offset\" value=\"\" /> (Numeric, 1 - 9999, or blank for default) <br />\n\t\t\t\t\t\n\t\t\t\t\t<h4>Pagination settings (<a href=\"javascript:expand(\\'pagination_options\\');\">expand/collapse</a>)</h4>\t\n\t\t\t\t\t<div id=\"pagination_options\" class=\"advanced\" style=\"display: none;\">\n\t\t\t\t\t\t<label for=\"disable_pagination\">Disable pagination</label> <input type=\"checkbox\" value=\"1\" name=\"disable_pagination\" id=\"disable_pagination\" /><br /><br />\n\t\t\t\t\t\t\n\t\t\t\t\t\t<label for=\"items_per_page\">Items Per Page</label>\n\t\t\t\t\t\t<input type=\"text\" name=\"items_per_page\" id=\"items_per_page\" value=\"\" /> (Numeric, 1 - 9999, or blank for default)<br />\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<h4>Overrides (<a href=\"javascript:expand(\\'overrides\\');\">expand/collapse</a>)</h4>\t\n\t\t\t\t\t<div id=\"overrides\" class=\"advanced\" style=\"display: none;\">\n\t\t\t\t\t\t<label for=\"override_sef\" class=\"nofloat\"><input type=\"checkbox\" value=\"1\" name=\"override_sef\" id=\"override_sef\" /> Override SEF (Search Engine Friendly URLs)</label><br /><br />\n\t\t\t\t\t\t<label for=\"override_comments\" class=\"nofloat\"><input type=\"checkbox\" value=\"1\" name=\"override_comments\" id=\"override_comments\" /> Override Comments</label><br /><br />\n\t\t\t\t\t\t\n\t\t\t\t\t\t<label for=\"static\" class=\"nofloat\"><input type=\"checkbox\" value=\"1\" name=\"static\" id=\"static\" /> Static display</label><br /><br />\n\t\t\t\t\t\t\n\t\t\t\t\t\t<label for=\"disable_extended_article\" class=\"nofloat\"><input type=\"checkbox\" value=\"1\" name=\"disable_extended_article\" id=\"disable_extended_article\" /> Disable extended article</label><br /><br />\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t<div class=\"alignr\">\n\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Generate code\" />\n\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t\t';\n\t\n\t} elseif ($do == \"syslog\") {\n\t\t$globalvars['page_name'] = \"system log\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t//determine pagintation variables and sorting\n\t\t\t$page = $_GET['page'];\n\t\t\tif (!$page) {\n\t\t\t\t$page = 1;\n\t\t\t}\n\t\t\t$items_per_page = 20;\n\t\t\t$page_start = ($page*$items_per_page) - $items_per_page;\n\t\t\t$next_page = $page + 1;\n\t\t\t$prev_page = $page - 1;\n\t\t\t\t//get sorting info and view\n\t\t\t\t$sort = $_GET['sort'];\n\t\t\t\t$v = $_GET['v']; \n\t\t//END OF PAGINATION/SORTING\n\t\t\n\t\t$content = log_form();\n\t\n\t} elseif ($do == \"backup\") {\n\t\t$globalvars['page_name'] = \"database backup\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t\n\t\tif ($_GET['action'] == \"backup\") {\n\t\t\t\n\t\t\t//mysqldump -u alecwh --password=alecwh phpns2 > database.sql\n\t\t\texec('mysqldump -u '.$databaseinfo['user'].' --password='.$databaseinfo['password'].' '.$databaseinfo['dbname'].' > '.$databaseinfo['dbname'].'.sql');\n\t\t\t\n\t\t\t//log the change\n\t\t\t\tlog_this('backup_db','User <i>'.$_SESSION['username'].'</i> has <strong>backed up</strong> the system database');\n\t\t\t\t\n\t\t\t\t//define filepaths and determine future gz file\n\t\t\t\t$file = $databaseinfo['dbname'].'.sql'; //the current dump\n\t\t\t\t// $file = file_get_contents($file);\n  \t\t\t\t/*\n  \t\t\t\t\tCOMPRESSION FOR FILE, COMMENTED OUT UNTIL WE CAN SOLIDIFY THE PROCESS.\n\t  \t\t\t\t//encode and write to file process\n\t  \t\t\t\t$data = implode(\"\", file($file));\n\t\t\t\t\t$gzdata = gzuncompress($data, 9); //encrypt to .gz, most compression possible (9)\n\t\t\t\t\t$fp = fopen($gz_file_to_produce, \"w\"); //open to write\n\t\t\t\t\tfwrite($fp, $gzdata); //write\n\t\t\t\t\tfclose($fp); //close\n\t\t\t\t\t\n\t\t\t\t\t> <meta http-equiv=\"content-type\",\"application/download\">\n> <meta http-equiv=\"content-type\",\"application/force-download\">\n> <meta http-equiv=\"content-type\",\"application/octet-stream\">\n> <meta http-equiv=\"content-disposition\",\"attachment; filename=list.txt\">[/color]\n\t\t\t\t*/\n\t\t\t\t$size = filesize($databaseinfo['dbname'].'.sql'); //get size\n\t\t\t\t\t//redirect to etc for actual header info\n\t\t\t\t\theader(\"Location: etc.php?do=backup&amp;size=\".$size.\"\");\n\t\t\t\t\t\n\t\t} elseif ($_GET['action'] == \"restore\") { //if we're restoring the data\n\t\t\t//action for uploaded file, for db restore\n\t\t\t$target_path = basename($_FILES['file']['name']); \n\t\t\tif (move_uploaded_file($_FILES['file']['tmp_name'], $target_path)) {\n\t\t\t\t//the file has been uploaded, now we deal wtih manipulation.\n\t\t\t\t//de-gz the file\n\t\t\t\t//THIS WAS THE PROBLEM with .gz compression, the decompression was not widely supported. Maybe support in the future, but for now, we're not dealing with it.\n\t\t\t\t//execute and dump data\n\t\t\t\texec('mysql -u '.$databaseinfo['user'].' --password='.$databaseinfo['password'].' '.$databaseinfo['dbname'].' < '.$target_path.'');\n\t\t\t} else {\n\t\t\t\t//log the change\n\t\t\t\tlog_this('backup_restore','User <i>'.$_SESSION['username'].'</i> has <strong>restored</strong> a previous phpns database.');\n\t\t\t\t$error_message .= '<div class=\"warning\">There was an error uploading the file.</div>';\n\t\t\t}\n\t\t}\n\t\t\n\t\t$content .= '\n\t\t<h3>Create backup</h3>\n\t\t<p>Once you click the button below, phpns will create a backup of the whole phpns database, and then compress to .sql.gz where available.</p>\n\t\t<div id=\"button_container\">\n\t\t\t<button class=\"backup\" OnClick=\"window.location = \\'?do=backup&amp;action=backup\\';\"><strong>Click here to backup the phpns database</strong></button>\n\t\t</div>\n\t\t\n\t\t<h3>Restore backup</h3>\n\t\t<p>Please browse to the backup file earlier created.</p>\n\t\t<form enctype=\"multipart/form-data\" action=\"?do=backup&amp;action=restore\" method=\"post\" onsubmit=\"return confirm(\\'Are you sure you want to restore this backup?\\n\\nThis will erase your database schema, and delete any articles/categories/users/settings that are not included in the backup.\\');\" >\n\t\t\t<label for=\"file\">Select .sql file</label> <input name=\"file\" type=\"file\" /><br />\n\t\t\t<div class=\"alignr\">\n\t\t\t\t<input type=\"submit\" value=\"Restore backup\" id=\"submit\" />\n\t\t\t</div>\n\t\t</form>\n\t\t\n\t\t';\n\t\n\t\n\t} elseif ($do == \"images\") {\n\t\t$globalvars['page_name'] = \"image uploads and settings\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\n\t\n\t} elseif ($do == \"themes\") { //if themes\n\t\t//define page name & default image\n\t\t$globalvars['page_name'] = 'themes';\n\t\t$globalvars['page_image'] = 'preferences'; //set preferences image\n\t\t$action = $_GET['action'];\n\t\t$path = $_POST['path'];\n\t\t\tif ($action == \"switch\" && $path != \"\") {  //if theme switch is underway....\n\t\t\t\t\n\t\t\t\t$theme_path = 'themes/'.$path.'/';  //construct filepath\n\t\t\t\t$themeinfo = simplexml_load_file('themes/'.$path.'/theme.xml');\n\t\t\t\t$timestamp = time();\n\t\t\t\t\n\t\t\t\t//first, we're going to delete previous theme selection(s). There should only ever be one.\n\t\t\t\t$sql_del = general_query('DELETE FROM '.$databaseinfo['prefix'].'themes');\n\t\t\t\t\n\t\t\t\t$res = general_query(\"INSERT INTO \".$databaseinfo['prefix'].\"themes \n\t\t\t\t(theme_name,theme_author,theme_dir,base_dir,timestamp,theme_selected) VALUES (\n\t\t\t\t '\".$themeinfo->name.\"',\n\t\t\t\t '\".$themeinfo->author.\"',\n\t\t\t\t '\".$theme_path.\"',\n\t\t\t\t '\".$path.\"',\n\t\t\t\t '\".$timestamp.\"',\n\t\t\t\t 1)\n\t\t\t\t \"); //form query and execute\n\t\t\t\t//log the change\n\t\t\t\tlog_this('change_theme','User <i>'.$_SESSION['username'].'</i> has <strong>changed</strong> the default system theme.');\n\t\t\t\t$content = '<div class=\"warning\">The theme has been saved.</div>';\n\t\t\t}\n\t\t\n\t\t$scanlisting = scandir(\"themes/\");\n\t\t$dirlisting = array();\n\t\tforeach($scanlisting as $key => $value) {\n\t\t\tif (is_dir(\"themes/$value\") == true && $value != '.' && $value != '..') {\n\t\t\t\t$dirlisting[] = $value;\n\t\t\t}\n\t\t}\n\t\t$themelist = '\n\t\t<form action=\"preferences.php?do=themes&action=switch\" method=\"post\">\n\t\t\t<table style=\"text-align: left; width: 100%;\" border=\"1\"\n\t\t\t\t cellpadding=\"3\" cellspacing=\"2\">\n\t\t\t\t  <tbody>\n\t\t\t\t    <tr class=\"toprow\">\n\t\t\t\t      <td style=\"width: 150px\"><strong>Preview</strong></td>\n\t\t\t\t      <td style=\"width: 150px; text-align: left;\"><strong>Name</strong></td>\n\t\t\t\t      <td style=\"width: 150px;\"><strong>Author</strong></td>\n\t\t\t\t      <td><strong>Description</strong></td>\n\t\t\t\t      <td style=\"width: 10px\"><strong>Active</strong></td>\n\t\t\t\t    </tr>';\t\n\t\tforeach($dirlisting as $key => $value) {\n\t\t\tif (is_file(\"themes/$value/theme.xml\")) {\n\t\t\t\t$themeinfo = simplexml_load_file('themes/'.$value.'/theme.xml');\n\t\t\t\t\n\t\t\t\t//sql to fetch current theme, so we can have the theme selected\n\t\t\t\t$stheme = general_query('SELECT * FROM '.$databaseinfo['prefix'].'themes WHERE theme_selected=1', TRUE);\n\t\t\t\t\n\t\t\t\t//radio button. selected or not?\n\t\t\t\t\n\t\t\t\tif (\"$themeinfo->name\" == $stheme['theme_name']) {\n\t\t\t\t\t$radio = '<td><input type=\"radio\" id=\"path\" name=\"path\" value=\"'.$value.'\" checked=\"checked\" /></td>';\n\t\t\t\t} else {\n\t\t\t\t\t$radio = '<td><input type=\"radio\" id=\"path\" name=\"path\" value=\"'.$value.'\" /></td>';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$row_bg = ($row_bg == '#ffffff') ? '#F5F5F5' : '#ffffff';\n\t\t\t\t\n\t\t\t\t$themelist = $themelist.'    \n\t\t\t\t<tr bgcolor=\"'.$row_bg.'\">\n\t\t\t\t  <td><img src=\"themes/'.$value.'/preview.png\" alt=\"preview\" /></td>\n\t\t\t\t  <td><strong>'.\"$themeinfo->name\".'</strong></td>\n\t\t\t\t  <td><a href=\"'.\"$themeinfo->website\".'\"> '.\"$themeinfo->author\".' </a></td>\n\t\t\t\t  <td>'.\"$themeinfo->description\".'</td>\n\t\t\t\t  '.$radio.'\n\t\t\t\t</tr>\n\t\t\t\t';\n\t\t\t}\n\t\t}\n\t\t$themelist = $themelist.'\n\t\t   </tbody>\n\t\t</table>\n\t\t<div class=\"alignr\">\n\t\t\t<input type=\"submit\" id=\"submit\" value=\"Switch and Save\" />\n\t\t</div>\n\t</form>';\n\t\t\n\t\t//compile content for themes\n\t\t$content .= \n\t\t'<h3>Detected themes (in the /themes directory)</h3>\n\t\t'.$themelist.'\n\t\t';\n\t} elseif ($do == \"wysiwyg\") {\n\t\t$globalvars['page_name'] = \"wysiwyg options\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t\tif ($_GET['action'] == 'update') {\n\t\t\t\tchange_config('wysiwyg',$_POST['wysiwyg']);\n\t\t\t\t$message = \"<div class=\\\"warning\\\">The wysiwyg editor has been changed to '\".$_POST['wysiwyg'].\"'</div>\";\n\t\t\t\t//log the change\n\t\t\t\tlog_this('wysiwyg_options','User <i>'.$_SESSION['username'].'</i> has <strong>disabled/enabled</strong> the wysiwyg editor');\n\t\t\t}\n\t\t\t\n\t\t$wysiwyg = load_config('wysiwyg');\n\t\t\n\t\t$content = '\n\t\t<h3>wysiwyg</h3>\n\t\t'.$message.'\n\t\t<p>phpns currently uses the \"<a href=\"http://tinymce.moxiecode.com\">TinyMCE</a>\" wysiwyg textarea application, licensed under the <a href=\"inc/wysiwyg/license.txt\">LGPL</a> as published by the <a href=\"http://fsf.org\">FSF (Free Software Foundation)</a>.\n\t\t<div class=\"form\">\n\t\t\t<form action=\"preferences.php?do=wysiwyg&action=update\" method=\"post\">\n\t\t\t\t<label for=\"wysiwyg\">Enabled</label>\n\t\t\t\t\t<select name=\"wysiwyg\" id=\"wysiwyg\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t\t<option value=\"'.$wysiwyg['v1'].'\">'.$wysiwyg['v1'].'</option>\n\t\t\t\t\t\t<optgroup label=\"Select...\">\n\t\t\t\t\t\t\t<option value=\"yes\">yes</option>\n\t\t\t\t\t\t\t<option value=\"no\">no</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select><br />\n\t\t\t\t\t<p>*The WYSIWYG editor can be disabled/enabled by clicking \"Toggle WYSIWYG\" next to textareas ONLY if the editor is active.</p>\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Save\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t\t';\n\t\t\n\t} elseif ($do == \"timestamp\") {\n\t\t$globalvars['page_name'] = \"system timestamp format\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t\tif ($_GET['action'] == 'update') {\n\t\t\t\tchange_config('sys_time_format',$_POST['sys_time_format']);\n\t\t\t\t$message = \"<div class=\\\"warning\\\">The system timestamp format has been changed to '\".$_POST['sys_time_format'].\"'</div>\";\n\t\t\t\t//log the change\n\t\t\t\tlog_this('system_timestamp','User <i>'.$_SESSION['username'].'</i> has <strong>edited</strong> the default system timestamp format');\n\t\t\t}\n\t\t\t\n\t\t$sys_time_format = load_config('sys_time_format');\n\t\t\n\t\t$content = '\n\t\t<h3>system timestamp format</h3>\n\t\t'.$message.'\n\t\t<p>phpns uses the date(); function for formatting the system time. You can find a manual on the function at the <a href=\"http://php.net/date\">php website</a>.</p>\n\t\t<div class=\"form\">\n\t\t\t<form action=\"preferences.php?do=timestamp&action=update\" method=\"post\">\n\t\t\t\t<label for=\"format\">Format</label>\n\t\t\t\t\t<input type=\"text\" name=\"sys_time_format\" id=\"format\" value=\"'.$sys_time_format['v1'].'\" /><br />\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Save\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t\t';\n\t\n\t} elseif ($do == \"line\") {\n\t\t$globalvars['page_name'] = \"online/offline options\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t\tif ($_GET['action'] == 'update') {\n\t\t\t\tchange_config('line',$_POST['line']);\n\t\t\t\t$message = \"<div class=\\\"warning\\\">The online/offline status has been changed to '\".$_POST['line'].\"'</div>\";\n\t\t\t\t\n\t\t\t\t//log the change\n\t\t\t\tlog_this('site_line','User <i>'.$_SESSION['username'].'</i> has <strong>changed</strong> the online/offline status');\n\t\t\t}\n\t\t\t\n\t\t$line = load_config('line');\n\t\t\n\t\t$content = '\n\t\t<h3>Line options</h3>\n\t\t'.$message.'\n\t\t<div class=\"form\">\n\t\t\t<form action=\"preferences.php?do=line&action=update\" method=\"post\">\n\t\t\t\t<label for=\"line\">Online:</label>\n\t\t\t\t\t<select name=\"line\" id=\"line\">\n\t\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t\t<option value=\"'.$line['v1'].'\">'.$line['v1'].'</option>\n\t\t\t\t\t\t<optgroup label=\"Select...\">\n\t\t\t\t\t\t\t<option value=\"yes\">yes</option>\n\t\t\t\t\t\t\t<option value=\"no\">no</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select><br />\n\t\t\t\t\t<div>\n\t\t\t\t\t\tIf the above option is set to \\'no\\' (or \\'offline\\'), users will <strong>not</strong> be able to view any articles on your website.\n\t\t\t\t\t</div>\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Save\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t\t';\n\t\n\t} elseif ($do == \"globalmessage\") {\n\t\t$globalvars['page_name'] = \"global message\";\n\t\t$globalvars['page_image'] = \"preferences\";\n\t\t\n\t\t\tif ($_GET['action'] == \"update\") {\n\t\t\t\tchange_config('global_message',$_POST['message']);\n\t\t\t\t$error_message = '<div class=\"warning\">Your message have been saved.</div>';\n\t\t\t\t//log the change\n\t\t\t\tlog_this('global_message','User <i>'.$_SESSION['username'].'</i> has <strong>edited</strong> the default global message');\n\t\t\t}\n\t\t$global_message = load_config('global_message');\n\t\t\n\t\t$content = $error_message.'\n\t\t<h3>global message</h3>\n\t\t<div class=\"form\">\n\t\t\t<form action=\"preferences.php?do=globalmessage&action=update\" method=\"post\">\n\t\t\t\t<label for=\"message\" class=\"for_textarea_alt\">Message <a href=\"javascript:togglewysiwyg(\\'message\\');\">wysiwyg on/off</a> <a href=\"javascript:expandwysiwyg(\\'message\\');\">expand editor</a></label><textarea name=\"message\" id=\"message\">'.$global_message['v3'].'</textarea>\n\t\t\t\t<br />*If you do not want any message, leave the above field blank.\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Save\" />\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t</form>\n\t\t</div>\n\t\t';\n\t}\n\ninclude(\"inc/themecontrol.php\");  //include theme script\n?>\n"}]}
{"id": 9, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\shownews.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n//error_reporting( E_ALL | E_STRICT ); //DEBUGGING, uncommment to activate\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n/* This file will need little to NO modification. All customization can be done \nbefore including the file, using pre-set variables. If you need to make modifications \nto this file, it's important to comment your code. This is obviously the most important\nfile in the system, so understanding it is important. All functions are defined here are \nseperate from the main system (for security reasons.)\n\n-- Alec Henriksen (http://phpns.com | http://alecwh.com)\n*/\n\n/* Optional variables that can be called before user include:\n   * $limit = 1-9999\n   * $template = template_id\n   * $category (multiple) = ID Number(s) (seperated by commas (cat1, cat2, cat3))\n   * $mode (RSS) = RSS, XML, ATOM\n   * $offset = 1-9999\n   * $sef_override = TRUE/FALSE;\n   * $comment_override = TRUE/FALSE;\n   * $static = TRUE/FALSE;\n*/\n\n//define some variables, immediately protect against injection\n\n\t$do = htmlentities($_POST['do']);\n\tif (!$do && !strstr($_GET['a'], 'page:')) { $id = htmlentities($_GET['a']); }\n\t$mode = htmlentities($mode);\n\t$offset = htmlentities($offset);\n\t\n\t//generate current time, used globally\n\t$time = time();\n\t$ip = $_SERVER['REMOTE_ADDR'];\n\t\n//before continuing, protect from injection\nif ($sef_override == FALSE) {\n\tif (!is_numeric($id) && $id && $id != 'do=rss') {\n\t\t$inject_error = '\n\t\t\t<h1>stop!</h1>\n\t\t\t<hr />\n\t\t\tID paramater used: <strong>'.$id.'</strong>\n\t\t\t<p>Phpns has detected a possible security breach, or a mal-formed URL. The ID paramater cannot contain a letter in non-SEF mode.</p>\n\t\t';\n\t\tdie($inject_error);\n\t}\n} else {\n\t$mod_rewrite = TRUE;\n\tif ($id && substr($id,strlen($id)-1,1) == '/') {\n\t\t$id = substr_replace($id ,\"\",-1);\n\t}\n}\n\t\n//include database information\n\t@require(\"inc/config.php\");\n//connect.\n$mysql['connection'] = mysql_connect($databaseinfo['host'], $databaseinfo['user'], $databaseinfo['password'])\nor die ($error['connection']);\n//select mysql database\n$mysql['db'] = mysql_select_db($databaseinfo['dbname'],$mysql['connection'])\nor die ($error['database']);\n\t\n//define show_news functions, and check if functions are already defined.\n\tif (!function_exists('clean_data')) {\n\t\tfunction clean_data($data) {\n\t\t\tif (is_array($data)) {\n\t\t\t\tforeach ($data as $key => $value) {\n\t\t\t\t\tif(ini_get('magic_quotes_gpc')) { $data[$key] = stripslashes($value); }\n\t\t\t\t\t$data[$key] = htmlspecialchars($value);\n\t\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(ini_get('magic_quotes_gpc')) { $data = stripslashes($data); }\n\t\t\t\t$data = htmlspecialchars($data, ENT_QUOTES);\n\t\t\t}\n\t\t\treturn $data;\n\t\t}\n\t}\n\tif (!function_exists('decode_data')) {\n\t\tfunction decode_data($data) {\n\t\t\tif (is_array($data)) {\n\t\t\t\tforeach ($data as $key => $value) {\n\t\t\t\t\t$data[$key] = htmlspecialchars_decode($value);\n\t\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$data = htmlspecialchars_decode($data);\n\t\t\t}\n\t\t\treturn $data;\n\t\t}\n\t}\n\tif (!function_exists('db_fetch')) {\n\t\tfunction db_fetch($query,$type,$clean=NULL) {\n\t\t\t//echo '<textarea width=\"100%\">'.$query.'</textarea>'; //debugging, this will output every query.\n\t\t\t\tif ($clean == TRUE) {\n\t\t\t\t\t$query = clean_data($query); //clean\n\t\t\t\t}\n\t\t\t\t\n\t\t\t$res = mysql_query($query) or die(mysql_error().'<br /><br />Line '.__LINE__.'<br /><br /> query: '.$query.'');\n\t\t\t//return value or not?\n\t\t\t\tif ($type == 1) { //if we want a value\n\t\t\t\t\t$value = mysql_fetch_array($res) or die('fetch array failed, line: '.__LINE__.', query: '.$query.'<p>'.mysql_error().'');\n\t\t\t\t\treturn $value;\n\t\t\t\t} else {\n\t\t\t\t\treturn $res;\n\t\t\t\t}\n\t\t}\n\t}\n\tif (!function_exists('db_insert')) {\n\t\tfunction db_insert($query) {\n\t\t\t//sql construction\n\t\t\t$insert_res = mysql_query($query) or die(mysql_error());\n\t\t\t$affected = mysql_affected_rows();\n\t\t\treturn $affected;\n\t\t}\n\t}\n\tif (!function_exists('fetch_template')) {\n\t\tfunction fetch_template() { //figure out default template, or use a user defined one.\n\t\t\tglobal $databaseinfo; //for table prefix\n\t\t\tglobal $template;\n\t\t\t\n\t\t\tif (!$template) {  //if template is not defined by pre-var include... get default\n\t\t\t\t$res = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"templates WHERE template_selected='1' LIMIT 1\", 1);\n\t\t\t\treturn $res; //return default template (changeable in preferences)\n\t\t\t} else {\n\t\t\t\t$res = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"templates WHERE id=\".$template.\" LIMIT 1\", 1);\n\t\t\t\treturn $res;\n\t\t\t}\n\t\t}\n\t}\n\tif (!function_exists('translate_item')) {\n\t\tfunction translate_item($item,$template,$type) {\n\t\t\tglobal $id;\n\t\t\t/* \n\t\t\tHTML_ARTICLE:\n\t\t\t\t{title} = article title\n\t\t\t\t{subtitle} = subtitle\n\t\t\t\t{date} = timestamp/date\n\t\t\t\t{main_article} = main article\n\t\t\t\t{full_story} = full story\n\t\t\t\t{image} = article image\n\t\t\t\t{author} = author\n\t\t\t\t{article_href} = the link to the article, but the actual href value\n\t\t\t\t{reddit} = reddit social networking link\n\t\t\t\t{digg} = digg social networking link\n\t\t\tHTML_COMMENT\n\t\t\t\t{author} = comment author\n\t\t\t\t{website} = website\n\t\t\t\t{comment} = comment\n\t\t\t\t{date} = comment date\n\t\t\t\t{ip} = comment ip address\n\t\t\tHTML_FORM:\n\t\t\t\t{action} = value that goes inside the <form>\n\t\t\t\t{hidden_data} = required value somewhere inside the <form>\n\t\t\t\t{captcha_question} = In plain text, the question\n\t\t\t\t{captcha_answer} = The answer encoded and passed through <form>\n\t\t\t\t\n\t\t\t*/\n\t\t\tglobal $timestamp_format;\n\t\t\tglobal $mod_rewrite; //globalize mod_rewrite for URL mods\n\t\t\tglobal $databaseinfo; //for table prefix\n\t\t\tglobal $disable_extended_article; //globalize disable_extended_article (to determine whether we should allow full stories in str_replace)\n\t\t\t$template = decode_data($template);\n\t\t\tif ($type == \"html_article\") { //if we are working with the html_article\n\t\t\t\t\t//change back from htmlspecialchars to htmlspecialchars_decode, and define some other vars\n\t\t\t\t\t$item = decode_data($item);\n\t\t\t\t\t$item['timestamp'] = date($timestamp_format['v3'], $item['timestamp']);\n\t\t\t\t\t\n\t\t\t\t\tif ($mod_rewrite == TRUE) {\n\t\t\t\t\t\t$item['article_title_mod'] = str_replace(' ', '-', $item['article_title']);\n\t\t\t\t\t\t$url = 'http://'.$_SERVER['SERVER_NAME'].dirname($_SERVER['PHP_SELF']).$item['article_title_mod'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$url = 'http://'.$_SERVER['SERVER_NAME'].$_SERVER['PHP_SELF'].'?a='.$item['id'];\n\t\t\t\t\t}\n\t\t\t\t$template = str_replace('{title}', $item['article_title'], $template);\n\t\t\t\t$template = str_replace('{id}', $item['id'], $template);\n\t\t\t\t$template = str_replace('{subtitle}', $item['article_subtitle'], $template);\n\t\t\t\t$template = str_replace('{main_article}', $item['article_text'], $template);\n\t\t\t\tif ($id && $disable_extended_article != TRUE) { $template = str_replace('{full_story}', $item['article_exptext'], $template); } else { $template = str_replace('{full_story}', '', $template); }\n\t\t\t\t$template = str_replace('{image_src}', $item['article_imgid'], $template);\n\t\t\t\t$template = str_replace('{date}', $item['timestamp'], $template);\n\t\t\t\t$template = str_replace('{author}', $item['article_author'], $template);\n\t\t\t\t\n\t\t\t\t//construct href for a\n\t\t\t\t$template = str_replace('{article_href}', $url, $template);\n\t\t\t\t\n\t\t\t\t//reddit, digg, del.icio.us buttons\n\t\t\t\t$template = str_replace('{reddit}', '\n\t\t\t\t<script>reddit_url=\\''.$url.'\\'</script>\n\t\t\t\t<script>reddit_title=\\''.$item['article_title'].'\\'</script>\n\t\t\t\t<script language=\"javascript\" src=\"http://reddit.com/button.js?t=2\"></script>\n\t\t\t\t', $template);\n\t\t\t\t\n\t\t\t\t//digg_url = \\''.$url.'\\'; is the real one\n\t\t\t\t$template = str_replace('{digg}', '\n\t\t\t\t<script type=\"text/javascript\">\n\t\t\t\t\tdigg_url = \\''.$url.'\\';\n\t\t\t\t\tdigg_bgcolor = \\'transparent\\';\n\t\t\t\t</script>\n\t\t\t\t<script src=\"http://digg.com/tools/diggthis.js\" type=\"text/javascript\"></script> \n\t\t\t\t', $template);\n\t\t\t\t\n\t\t\t\t\t//comment numeric representations\n\t\t\t\t\t$comment_num = db_fetch('SELECT COUNT(*) FROM '.$databaseinfo['prefix'].'comments WHERE article_id='.$item['id'].'',1,FALSE);\n\t\t\t\t\t$template = str_replace('{comment_count}', $comment_num[0], $template);\n\t\t\t\treturn $template;\t\n\t\t\t} elseif ($type == \"html_comment\") {\n\t\t\t\t$item['timestamp'] = date($timestamp_format['v3'], $item['timestamp']);\n\t\t\t\t$item['comment_text'] = nl2br($item['comment_text']);\n\t\t\t\t$template = str_replace('{author}', $item['comment_author'], $template);\n\t\t\t\t$template = str_replace('{timestamp}', $item['timestamp'], $template);\n\t\t\t\t$template = str_replace('{comment}', $item['comment_text'], $template);\n\t\t\t\t$template = str_replace('{website}', $item['website'], $template);\n\t\t\t\t$template = str_replace('{ip}', $item['ip'], $template);\n\t\t\t\treturn $template;\n\t\t\t\t\n\t\t\t\t\n\t\t\t} elseif ($type == \"html_form\") {\n\t\t\t\t@require(\"inc/captcha.php\"); //require captcha info\n\t\t\t\t\t//if SEF urls, we write a SEF url. ;) IF NOT, regular ?$id\n\t\t\t\t\tif ($mod_rewrite == TRUE) {\n\t\t\t\t\t\t$url = 'http://'.$_SERVER['SERVER_NAME'].dirname($_SERVER['PHP_SELF']).''.$id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$url = '?a='.$id;\n\t\t\t\t\t}\n\t\t\t\t//captcha determination\n\t\t\t\t$captcha['question'] = array_rand($captcha);\n\t\t\t\t$captcha['answer'] = base64_encode($captcha[$captcha['question']] + (60-20));\n\t\t\t\t//start translation for the html comment form\n\t\t\t\t$template = str_replace('{action}', $url, $template);\n\t\t\t\t$template = str_replace('{captcha_question}', $captcha['question'], $template);\n\t\t\t\t$template = str_replace('{captcha_answer}', '<input type=\"hidden\" name=\"captcha_answer\" value=\"'.$captcha['answer'].'\" />', $template);\n\t\t\t\t$template = str_replace('{hidden_data}', '<input type=\"hidden\" name=\"id\" value=\"'.$id.'\" />', $template);\n\t\t\t\treturn $template;\n\t\t\t\t\n\t\t\t} elseif ($type == \"html_pagination\") { //pagination template\n\t\t\t\n\t\t\t\t\tif ($item['previous']) {$template = str_replace('{previous_page}', '?a=page:'.$item['previous'], $template); } else { $template = str_replace('{previous_page}', '', $template); }\n\t\t\t\t\tif ($item['next']) {$template = str_replace('{next_page}', '?a=page:'.$item['next'], $template); } else { $template = str_replace('{next_page}', '', $template); }\n\t\t\t\t\t$template = str_replace('{middle_pages}', $item['middle'], $template);\n\t\t\t\t\treturn $template;\n\t\t\t\t\t\n\t\t\t} elseif ($type == \"rss\") { //we translate each item with RSS syntax. <item>s and such.\n\t\t\t\t$url = 'http://'.$_SERVER['SERVER_NAME'].dirname($_SERVER['PHP_SELF']);\n\t\t\t\t\tif (strstr($_SERVER['PHP_SELF'], 'etc.php')) {\n\t\t\t\t\t\t$url = $url.'/article.php?do=edit&amp;id='.$item['id'].'';\n\t\t\t\t\t\t$rss_link = $url;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif ($mod_rewrite) {\n\t\t\t\t\t\t\t$item['article_title'] =  str_replace(' ', '-', $item['article_title']);\n\t\t\t\t\t\t\t$rss_link = $url.''.$item['article_title'].'';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$rss_link = $url.'?a='.$item['id'].'';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t$template = '\n<item>\n\t<title>'.$item['article_title'].'</title>\n\t<author>'.$item['article_article'].'</author>\n\t<category>'.$item['article_cat'].'</category>\n\t<pubDate>'.$item['timestamp'].'</pubDate>\n\t<link>'.$rss_link.'</link>\n\t<description>'.$item['article_text'].'</description>\n</item>';\n\t\t\t\treturn $template; //return template\n\t\t\t}\n\t\t}\n\t}\n\t\t//check to see if the system is online. If yes, we continue, if no, well... no. ;)\n\t\t$siteonline = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='line'\",1,FALSE);\n\t\t\tif ($siteonline['v1'] == 'no') { \n\t\t\t\tdie('<div class=\"disabled_message\">The administrator has disabled the news system.</div>'); \n\t\t\t}\t\n\t\t$banned = db_fetch(\"SELECT ip, reason FROM \".$databaseinfo['prefix'].\"banlist\",0);\n\t\t\twhile ($ip = mysql_fetch_assoc($banned)) {\n\t\t\t\tif ($ip['ip'] == $_SERVER['REMOTE_ADDR']) {\n\t\t\t\t\tdie(\"<strong>You have been banned from viewing this article system.</strong>\n\t\t\t\t\t<p>Reason: \".$ip['reason'].\"</p>\n\t\t\t\t\t\");\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t//timestamp format fetch\n\t\t$timestamp_format = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='timestamp_format'\",1,FALSE);\n\t\t\n\t\t//fetch template. :)\n\t\t$template = fetch_template();\n\n\t//before anything else, we're going to detect if there is post data, and if there is, we'll insert the db. If there is no post data, just pass over this.\n\t\t\tif ($_POST && $static != TRUE) {\n\t\t\t\t//IF THERE IS POST DATA, then we're submitting the form. We need to clean data.\n\t\t\t\t$comment = clean_data($_POST);\n\t\t\t\n\t\t\t\t//set the continue to yes.\n\t\t\t\t$comment_continue = TRUE;\n\t\t\t\t\n\t\t\t\t//validate data (regex for email)\n\t\t\t\tif (!$comment['name'] || !$comment['email'] || !$comment['comment'] || !preg_match(\"/^[A-Za-z0-9_-]+@[A-Za-z0-9_-]+\\.([A-Za-z0-9_-][A-Za-z0-9_]+)$/\", $comment['email'])) {\n\t\t\t\t\t$comment_error = 'You need to enter all required fields, and a valid email. Press back to try again.';\n\t\t\t\t\t$comment_continue = FALSE;\n\t\t\t\t}\n\t\t\t\tif ($comment['captcha'] != base64_decode($comment['captcha_answer'])-(60-20) || !$comment['captcha']) {\n\t\t\t\t\t\t$comment_continue = FALSE;\n\t\t\t\t\t\t$comment_error .= ' The captcha answer was incorrect. Press \"back\" on your browser to try again.';\n\t\t\t\t\t}\n                \t\tif ($mod_rewrite == TRUE) {\n                \t\t\t$title_id = str_replace('-', ' ', $comment['id']);\n\t\t\t\t\t$article_id = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"articles WHERE article_title='\".$title_id.\"'\",1);\n\t\t\t\t\t$article_id = $article_id['id'];\n                \t\t} else {\n\t\t\t\t\t$article_id = $comment['id'];\n\t\t\t\t}\n                \t\t\n                \t\t\n                        //if comment_id is not numeric, kill with message\n\t\t\t\tif (!is_numeric($comment['id']) && $mod_rewrite == FALSE) { die(\"non-numeric form id, invalid information.\"); }\n\t\t\t\t\tif ($comment_continue == TRUE) {\n\t\t\t\t\t\t$insert = db_insert('INSERT INTO '.$databaseinfo['prefix'].'comments (article_id,comment_text,comment_author,website,timestamp,approved,ip) VALUES (\"'.$article_id.'\",\"'.$comment['comment'].'\",\"'.$comment['name'].'\",\"'.$comment['website'].'\",\"'.$time.'\",\"1\",\"'.$ip.'\")');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$content .= '<div class=\"warning\">'.$comment_error.'</div>';\n\t\t\t\t\t}\n\t\t\t}\n\n\t\n\t\n\t\n\t/*\n\t\tACTUAL CONTENT GENERATION.\n\t\tIf there is no $do, we're not using RSS or ATOM, and there is no specific $id, we display the list.\n\t*/\n\n\tif (((!$do || $do == 'rss') && (!$id || $id == 'do=rss')) || $static == TRUE) { //if no defined action, show news as it is meant to be displayed.\n\t\n\t\t//gather some important variables from db.\n\t\tif ($category) { $category = \"WHERE article_cat IN ($category,'all') &&\"; } else { $category = \"WHERE\"; }\n\t\tif (!$offset) { $offset = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='def_offset'\",1); $offset = $offset['v1']; } $original_offset = $offset; //to be used later...\n\t\tif (!$limit) { $limit = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='def_limit'\",1); $limit = $limit['v1']; }\n\t\tif (!$order) { $order = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='def_order'\",1); $order = $order['v3']; }\n\t\tif (!$items_per_page) { $items_per_page = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='def_items_per_page'\",1); $items_per_page = $items_per_page['v1']; }\n\t\t\n\t\t\t/* Pagination management:\n\t\t\t\t\tphpns works by using QUERY_STRING like this: filename.php?page:1\n\t\t\t\tSo, if no page is defined, we're going to default to 1. */\n\t\t\t\t\n\t\t\t//get the current page from the URI.\n\t\t\t$current_page = str_replace('page:','', $_GET['a']);\n\t\t\t\n\t\t\t\t//if the string is empty, we assume page 1.\n\t\t\t\tif (!is_numeric($current_page) && !$current_page) {\n\t\t\t\t\t$current_page = 1;\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif ($current_page == 1) {\n\t\t\t\t\t\t//determine offset\n\t\t\t\t\t\t$offset = ($current_page * $items_per_page - ($items_per_page)) + $offset;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$offset = ($current_page * $items_per_page - ($items_per_page));\n\t\t\t\t\t}\n\t\t\n\t\t\n\t\t\t\t//MODE MODIFICATION\n\t\t\t\tif ($mode == \"rss\") {\n\t\t\t\t\t$rsslimit = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='def_rsslimit'\",1);\n\t\t\t\t\t\t$limit['v1'] = $rsslimit['v3'];\n\t\t\t\t\t$order = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='def_rssorder'\",1);\n\t\t\t\t\t\t$order = $order['v3'];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//form count query, then figure out the total amount of rows in the news generation (including all pages)\n\t\t\t\t$fetch_news_count = db_fetch(\"\n\t\t\t\tSELECT * FROM \".$databaseinfo['prefix'].\"articles\n\t\t\t\t\".$category.\"\n\t\t\t\tactive='1' AND approved='1'\n\t\t\t\tLIMIT \".$original_offset.\",\".$limit.\"\n\t\t\t\t\", 0);\n\t\t\t\t$total_news_count = mysql_num_rows($fetch_news_count);\n\t\t\n\t\t//forming actual news query.\t\n\t\t$fetch_news_res = db_fetch(\"\n\t\t\tSELECT * FROM \".$databaseinfo['prefix'].\"articles\n\t\t\t\".$category.\"\n\t\t\tactive='1' AND approved='1'\n\t\t\tORDER BY timestamp \".$order.\"\n\t\t\tLIMIT \".$offset.\",\".$items_per_page.\"\n\t\t\t\", 0);\n\t\t\t\n\t\t\t//pagination determinaion continuation =)\n\t\t\t\n\t\t\t\n\t\twhile ($row = mysql_fetch_assoc($fetch_news_res)) {  //start fetch loop\n\t\t\t\n\t\t\tif ($time >= $row['start_date'] || $time <= $row['end_date']  || $row['start_date'] == NULL || $row['end_date'] == NULL) {\n\t\t\t\n\t\t\t\t//put into $items if rss mode, else just $content\n\t\t\t\tif ($mode == 'rss') {\n\t\t\t\t\t$returned_data = translate_item($row, $template['html_article'], 'rss'); //translate into template\n\t\t\t\t\t$items .= $returned_data;\n\t\t\t\t} else {\n\t\t\t\t\n\t\t\t\t\t$returned_data = translate_item($row, $template['html_article'], 'html_article'); //translate into template\n\t\t\t\t\t\n\t\t\t\t\t$content .= $returned_data;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (!$mode && $disable_pagination != TRUE) {\n\t\t\t$pages = array();\n\t\t\t\n\t\t\t//find the total number of pages\n\t\t\t$pages['page_num'] = ceil($total_news_count / $items_per_page); \n\t\t\n\t\t\t//generate previous page link\n\t\t\tif ($current_page > 1) { \n\t\t \t\t$page['previous'] = $current_page - 1;\n\t\t\t}\n\t\t\n\t\t\t//generate next page link\n\t\t\tif ($current_page < $pages['page_num']) {\n\t\t\t\t$page['next'] = $current_page + 1;\n\t\t\t}\n\t\t\n\t\t\t//generate middle pages\n\t    \t\tfor($i = 1; $i <= $pages['page_num']; $i++){\n\t    \t\t\tif ($i == $current_page) {\n\t    \t\t\t\t$page['middle'] = $page['middle'] . \"\\n\".'<span class=\"pagination page_link_'.$i.'\"><a>'.$i.'</a></span> ';\n\t    \t\t\t} else {\n\t\t\t\t\t$page['middle'] =  $page['middle'] . \"\\n\".'<span class=\"pagination page_link_'.$i.'\"><a href=\"?a=page:'.$i.'\">'.$i.'</a></span> ';\n\t\t\t\t}\n\t\t\t} \n\t\t\n\t\t\t\t//add pagination links to content\n\t\t\t\t$content .= translate_item($page, $template['html_pagination'], 'html_pagination');\n\t\t}\n\t\t\n\t} elseif ($id && !$mode && $static == FALSE) { //if we're dealing with singles, and the admin wants single articles to be displayed....\n\t\tif (!$comment_override) { $allow_com = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='def_comenabled'\",1); } else { $allow_com = TRUE; }\n\t\t//if SEF URLs are enabled, we need to change a few things, and make it search for titles instead of id\n\t\t\n\t\tif ($mod_rewrite == TRUE) {\n\t\t\t$title_id = str_replace('-', ' ', $id);\n\t\t\t$where_spec = \"article_title='\".$title_id.\"'\";\n\t\t} else {\n\t\t\t$where_spec = \"id='\".$id.\"'\";\n\t\t}\n\t\t\n\t\t//forming actual news query.\t\n\t\t$fetch_news_res = db_fetch(\"\n\t\t\tSELECT * FROM \".$databaseinfo['prefix'].\"articles\n\t\t\tWHERE\n\t\t\tactive='1' AND approved='1' AND \".$where_spec.\" LIMIT 1\n\t\t\t\", 0);\t\n\t\t\t//we're checking how many results were retrieved. If none, we set an error message and display it.\n\t\tif (mysql_num_rows($fetch_news_res) == 0) {\n\t\t\n\t\t\t//set the error message, and display it.\n\t\t\t$error_message = '<div class=\"error_message\">The article/page requested ('.$id.' | '.$title_id.') does not exist.</div>';\n\t\t\techo $error_message;\n\t\t\t\n\t\t} else { //if there IS an article, we proceed. =)\n\t\t\twhile ($row = mysql_fetch_assoc($fetch_news_res)) {  //start fetch loop\n\t\t\t\tif ($time >= $row['start_date'] || $time <= $row['end_date']  || $row['start_date'] == NULL || $row['end_date'] == NULL) { //if we're set for time landings\n\t\t\t\t\t$allow_com['article_specific'] = $row['allow_comments'];\n\t\t\t\t\t$returned_data = translate_item($row, $template['html_article'], 'html_article'); //translate into template\n\t\t\t\t\t$content .= $returned_data;\n\t\t\t\t\t\t//if rss, we have to write it to $items\n\t\t\t\t}\n\t\t\t\n\t\t\t}\n\t\t\t//echo var_dump($allow_com); //debug\n\t\t\t//now, we generate comments for this specific article IF they are enabled\n\t\t\tif ($allow_com['v1'] == TRUE) {\n\t\t\t\tif ($mod_rewrite == TRUE) {\n\t\t\t\t\t$title_id = str_replace('-', ' ', $id);\n\t\t\t\t\t$article_id = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"articles WHERE article_title='\".$title_id.\"'\",1);\n\t\t\t\t\t$fetch_com_res = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"comments WHERE article_id='\".$article_id['id'].\"' AND approved='1'\", 0);\n\t\t\t\t} else {\n\t\t\t\t\t$fetch_com_res = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"comments WHERE article_id='\".$id.\"' AND approved='1'\", 0);\n\t\t\t\t}\n\t\t\t\t\t//for each row (or comment) generated, we translate the item and assign it to $content\n\t\t\t\t\twhile ($row = mysql_fetch_assoc($fetch_com_res)) {\n\t\t\t\t\t\t$comment_list .= translate_item($row, $template['html_comment'], 'html_comment');\n\t\t\t\t\t}\n\t\t\t}\n\t\t\t\t//assign $comment_list to $content\n\t\t\t\t$content .= $comment_list;\n\t\t\n\t\t\t//translate html comment form, then add it to the end of $content, if comments are enabled\n\t\t\tif (($allow_com['v1'] == TRUE && $allow_com['article_specific'] == 1 && $static != TRUE) || $comment_override == TRUE && $static != TRUE) {\n\t\t\t\t$form_template = translate_item('', $template['html_form'], 'html_form');\n\t\t\t} else {\n\t\t\t\t$form_template = '<span class=\"comments_are_disabled\">Comments are disabled.</span>';\n\t\t\t}\n\t\t\t\t//add it to $content ($form_template will be empty if comments are not enabled)\n\t\t\t\t$content .= '\n\t\t\t\t'.$form_template;\n\t\t} //end of the ELSEIF of mysql_num_rows (there were results...)\n\n\t} //end main if\n\t\n\t// echo var_dump($allow_com); //debugging, keep commented.\n\t\n\tif ($mode == 'rss') { //we generate the header information\n\t\theader(\"Content-type: text/xml\"); //set header for XML (for RSS)\n\t\t\t//some variable grabbing\n\t\t\t$rss['title'] = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='def_rsstitle'\",1);\n\t\t\t$rss['desc'] = db_fetch(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='def_rssdesc'\",1);\n\t\t$content .= '<rss version=\"2.0\">\n\t<channel>\n\t\t<title>'.$rss['title']['v3'].'</title>\n\t\t<link></link>\n\t\t<description>'.$rss['desc']['v3'].'</description>\n\t\t'.$items.'\n\t</channel>\n</rss>';\n\t}\n\n\techo $content; //and... finally post the content\n\t\n/* WE NEED TO UNDECLARE THE FOLLOWING VARIABLES just in case we have multiple scripts on one page.\n   * $limit\n   * $template\n   * $category\n   * $mode\n   * $offset\n   * $order\n   * $disable_pagination\n   * $items_per_page\n   * $sef_override\n   * $comment_override\n   * $static\n   * $disable_extended_article\n   \n   //non-user input\n   * $content\n   * $comment_list\n   * $id\n*/\n\tunset($limit);\n\tunset($template);\n\tunset($category);\n\tunset($mode);\n\tunset($offset);\n\tunset($order);\n\tunset($disable_pagination);\n\tunset($items_per_page);\n\tunset($sef_override);\n\tunset($comment_override);\n\tunset($static);\n\tunset($disable_extended_article);\n\t\n\t//non-user input unsetting\n\tunset($content);\n\tunset($comment_list);\n\tunset($id);\n\n?>\n"}]}
{"id": 10, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\showtitle.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n//error_reporting( E_ALL | E_STRICT ); //DEBUGGING, uncommment to activate\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n/*\n\tREADME\n\tThis file is used to generate a customized title for each of your articles. To get this working, place this file inside the folder where PHPNS resides (next to shownews.php, index.php, article.php... etc etc). That's all the installation, now we can use this file by going inside any PHP/HTML file on your server, and locating the following:\n\t\n\t<title>{your title here}</title>\n\t\n\tNow, simply replace this with:\n\t\n\t<title><?php include(\"/path/to/showtitle.php\"); ?> {your site title here}</title>\n\t\n\tIt's that easy. This file (showtitle.php) will automatically place an html character in place after the actual title, like &raquo; or &bull;. The default is &raquo; which looks the best. =)\n*/\n\n//define some variables, immediately protect against injection\n\t//this the seperator, ie: Your News Title SEPERATOR Site title (space between Title and SEPERATOR is included in the script, you don't need to supply this.)\n\t\n\t$default_seperator = '&raquo;';\n\t$id = $_GET['a'];\n\t\n//before continuing, protect from injection\n\tif (!is_numeric($id) && $id && $id != 'do=rss') {\n\t\t$inject_error = '\n\t\t\t<h1>security breach</h1>\n\t\t\t<hr />\n\t\t\t<strong>'.$id.'</strong>\n\t\t\t<p>Phpns has detected that you (or the link you used to get here) attempted to breach our database with a method called \"injection\". This is usually because the id variable contains a non-numeric character. If you think this message is a mistake, contact the system administrator.</p>\n\n\t\t\t<div><h5>Copyright 2007-08 Alec Henriksen | GPL License</h5></div>\n\t\t';\n\t\tdie($inject_error);\n\t}\n\t\n//include database information\n\t@require(\"inc/config.php\");\n//connect.\n$mysql['connection'] = mysql_connect($databaseinfo['host'], $databaseinfo['user'], $databaseinfo['password'])\nor die ($error['connection']);\n//select mysql database\n$mysql['db'] = mysql_select_db($databaseinfo['dbname'],$mysql['connection'])\nor die ($error['database']);\n\t\n//define show_news functions, and check if functions are already defined.\n\tif (!function_exists('clean_data')) {\n\t\tfunction clean_data($data) {\n\t\t\tif (is_array($data)) {\n\t\t\t\tforeach ($data as $key => $value) {\n\t\t\t\t\tif(ini_get('magic_quotes_gpc')) { $data[$key] = stripslashes($value); }\n\t\t\t\t\t$data[$key] = htmlspecialchars($value);\n\t\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(ini_get('magic_quotes_gpc')) { $data = stripslashes($data); }\n\t\t\t\t$data = htmlspecialchars($data, ENT_QUOTES);\n\t\t\t}\n\t\t\treturn $data;\n\t\t}\n\t}\n\tif (!function_exists('get_title')) {\n\t\tfunction get_title($id, $mr=FALSE) {\n\t\t\tif (is_array($data)) {\n\t\t\t\tforeach ($data as $key => $value) {\n\t\t\t\t\t$data[$key] = htmlspecialchars_decode($value);\n\t\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$data = htmlspecialchars_decode($data);\n\t\t\t}\n\t\t\treturn $data;\n\t\t}\n\t}\n\t\n// END FUNCTION DEFINITIONS //\n\n\tif ($mod_rewrite) {\n\t\t$column = 'article_title';\n\t\t$id = str_replace('-', ' ', $id);\n\t} else {\n\t\t$column = 'id';\n\t}\n\t\t$title_sql = \"\n\t\t\tSELECT * FROM \".$databaseinfo['prefix'].\"articles\n\t\t\tWHERE\n\t\t\tactive='1' AND approved='1' AND \".$column.\"='\".$id.\"'\n\t\t\tLIMIT 1\n\t\t\t\";\n\n\t\t$title_res = mysql_query($title_sql) or die(mysql_error());\n\t\t\n\t\twhile ($row = mysql_fetch_assoc($title_res)) {  //start fetch loop\n\t\t\tif ($time >= $row['start_date'] || $time <= $row['end_date']  || $row['start_date'] == NULL || $row['end_date'] == NULL) {\n\t\t\t\techo $row['article_title'].' '.$default_seperator;\n\t\t\t}\n\t\t}\n\t\n?>\n"}]}
{"id": 11, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\user.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\ninclude(\"inc/header.php\");\n$do = $_GET['do'];\n\n\tif (!$do) {\n\t$globalvars['page_name'] = 'user management';\n\t\n\t//form query\n\t\t$page = $_GET['page'];\n\t\t\tif (!$page) {\n\t\t\t\t$page = 1;\n\t\t\t}\n\t\t$items_per_page = 200;\n\t\t$page_start = ($page*$items_per_page) - $items_per_page;\n\t\t$next_page = $page + 1;\n\t\t$prev_page = $page - 1;\n\t\t$item_list = load_items('users',$page_start,$items_per_page,'','','');\n\t\t\n\t\tif (mysql_num_rows($item_list) == NULL) {\n\t\t\t$table_rows = '<td class=\"noresults\" colspan=\"6\"><strong>No returned results...</strong></td>';\n\t\t}\n\t\t\n\t\t$row_bg = '#ffffff';\n\n\t\twhile ($item_row = mysql_fetch_array($item_list)) {\n\t\t\t//convert timestamp to readable/human date\n\t\t\t$item_row['timestamp'] = date($globalvars['time_format'],$item_row['timestamp']);\n\t\t\t$item_row['rank_name'] = gen_rank_name($item_row['rank_id']);\n\t\t\t$usercount_sql = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"articles WHERE article_author='\".$item_row['user_name'].\"'\");\n\t\t\t$num_items =  mysql_num_rows($usercount_sql);\n\t\t\t$row_bg = ($row_bg == '#ffffff') ? '#F5F5F5' : '#ffffff';\n\t\t\t\t\n\t\t\t$table_rows = $table_rows.'<tr bgcolor=\"'.$row_bg.'\"><td><strong><a href=\"user.php?id='.$item_row['id'].'&do=edit\">'.$item_row['user_name'].'</a></strong></td><td>'.$item_row['full_name'].'</td><td>'.$item_row['timestamp'].'</td><td><a href=\"?id='.$item_row['rank_id'].'&do=editrank\">'.$item_row['rank_name'].'</a></td><td align=\"center\"><a href=\"manage.php?v='.$item_row['user_name'].'\">'.$num_items.'</a></td><td class=\"checkbox\"><input type=\"checkbox\" value=\"'.$item_row['id'].'\" name=\"'.$item_row['id'].'\"></td></tr>\n\t\t\t';\n\t\t} //end of WHILE statement\n\t\n\t\n\t$content = '\n\t\t<h3>Actions</h3>\n\t\t<div id=\"columnright\">\n\t\t\t\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"?do=newrank\">new rank</a></li>\n\t\t\t\t<li><a href=\"?do=ranks\">manage ranks</a></li>\n\t\t\t</ul>\n\t\t</div>\n\t\t\n\t\t<ul>\n\t\t\t<li><a href=\"?do=new\">new user</a></li>\n\t\t\t<li><a href=\"?do=loginrec\">login records</a></li>\n\t\t\t\n\t\t</ul>\n\t\t\n\t\t<h3>User list</h3>\n\t\t<form id=\"useropt\" method=\"post\" action=\"?do=deleteusers\" onsubmit=\"return confirm(\\'Are you sure you want to delete the selected items?\\');\">\n\t\t<table style=\"text-align: left; width: 100%;\" border=\"1\"cellpadding=\"3\" cellspacing=\"2\">\n\t\t\t<tbody>\n\t\t\t\t<tr class=\"toprow\">\n\t\t\t\t\t<td style=\"width: 200px; text-align: left;\"><strong>Username</strong></td>\n\t\t\t\t\t<td><strong>Full name</strong></td>\n\t\t\t\t\t<td><strong>Date</strong></td>\n\t\t\t\t\t<td><strong>Rank</strong></td>\n\t\t\t\t\t<td style=\"width: 80px\"><strong>#/articles</strong></td>\n\t\t\t\t\t<td style=\"width: 10px; text-align: center;\"><strong><input type=\"checkbox\" onClick=\"Checkall(this.form);\" /></strong></td>\n\t\t\t\t</tr>\n\t\t\t\t    '.$table_rows.'\n\t\t\t  </tbody>\n\t\t</table>\n\t\t\t<div style=\"text-align: right; width: 400px; float: right;\">\n\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Delete Selected\" />\n\t\t\t</div>\n\t\t</form>\n\t\t<div>\n\t\t\t<button class=\"previous\" OnClick=\"window.location = \\'?page='.$prev_page.'\\';\" />Previous ('.$prev_page.')</button>\n\t\t\t<button class=\"next\" OnClick=\"window.location = \\'?page='.$next_page.'\\';\" />Next ('.$next_page.')</button>\n\t\t</div>';\n\t\t\n\t} elseif ($do == \"new\") { //if action is new user\n\t\t\n\t\tif ($globalvars['rank'][18] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\t\n\t\t\tdie(); //if header doesn't work, kill the script.\n\t\t}\n\t\t\n\t\t$globalvars['page_name'] = \"new user\";\n\t\t$globalvars['page_image'] = \"user management\";\n\t\t$content = user_form();\n\t} elseif ($do == \"newp\") { //if process from new user\n\t\n\t\tif ($globalvars['rank'][18] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\t\n\t\t\tdie(); //if header doesn't work, kill the script.\n\t\t}\n\t\n\t\tif(isset($_POST)) {\n\t\t\t//generate vars\n\t\t\t$data['username_'] = $_POST['username_'];\n\t\t\t$data['fullname'] = $_POST['fullname'];\n\t\t\t$data['password_'] = $_POST['password_'];\n\t\t\t$data['cpassword_'] = $_POST['cpassword_'];\n\t\t\t$data['email'] = $_POST['email'];\n\t\t\t$data['msn'] = $_POST['msn'];\n\t\t\t$data['aim'] = $_POST['aim'];\n\t\t\t$data['yahoo'] = $_POST['yahoo'];\n\t\t\t$data['skype'] = $_POST['skype'];\n\t\t\t$data['rank'] = $_POST['rank'];\n\n\t\t\tforeach($data as $key => $value) {\n\t\t\t\t//clean data (SQL injection security)\n\t\t\t\t$data[$key] = clean_data($value);\n\t\t\t}\n\n\t\t\t$con = \"yes\";\n\t\t\t$error_message = '<ol class=\"warning\">\n\t\t\t';\n\t\t\tif (!$data['username_']) {  //no username\n\t\t\t\t$con = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>You must enter a username.</li>\n\t\t\t\t';\n\t\t\t}\n\t\t\tif (!$data['fullname']) { //no fullname\n\t\t\t\t$con = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>You must enter a full name.</li>\n\t\t\t\t';\n\t\t\t}\n\t\t\tif (!$data['password_']) {\n\t\t\t\t$con = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>You must enter a password.</li>\n\t\t\t\t';\n\t\t\t}\n\t\t\t//if passwords don't match\n\t\t\tif ($data['password_'] != $data['cpassword_']) {\n\t\t\t\t$con = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>Your passwords do not match.</li>\n\t\t\t\t';\n\t\t\t}\n\t\t\t\t//check if username is already used\n\t\t\t\t$checkres = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"users WHERE user_name='\".$data['username_'].\"'\");\n\t\t\t\tif (mysql_num_rows($checkres) > 0) {\n\t\t\t\t\t$con = \"no\";\n\t\t\t\t\t$error_message = $error_message.'<li>The username specified is already being used. Please choose another.</li>\n\t\t\t\t';\n\t\t\t\t}\n\t\t\t\t$error_message = $error_message.'</ol>';\n\t\t\t\n\t\t\tif ($con == \"yes\") { //if no problems\n\t\t\t\t$data['password_'] = sha1($data['password_']);\n\t\t\t\t$globalvars['page_name'] = \"user success\";\n\t\t\t\t$globalvars['page_image'] = \"user management\";\n\t\t\t\t$user_sql = new_user($data);\n\t\t\t} else { // if there WERE problems\n\t\t\t\t$globalvars['page_name'] = \"user management\";\n\t\t\t\t\t//shortcut fix for a small bug...we'll need to add to the array\n\t\t\t\t\t$data['user_name'] = $data['username_'];\n\t\t\t\t\t$data['full_name'] = $data['fullname'];\n\t\t\t\t$content = user_form($data);\n\t\t\t}\n\t\t}\n\t} elseif ($do == \"deleteusers\") {\n\t\n\t\tif ($globalvars['rank'][22] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\t\n\t\t\tdie(); //if header doesn't work, kill the script.\n\t\t}\n\t\n\t\t$items = $_POST; //get vars\n\t\tif (!$items) { //if no items, avoid mysql error by just redirecting\n\t\t\t\theader(\"Location: user.php\");\n\t\t\t}\n\t\tforeach($items as $key=>$value) { //create list of ids to be deleted\n\t\t\t$items_f = $items_f.\"'$key',\";\n\t\t}\n\t\t$items_f = substr_replace($items_f,\"\",-1); //remove last comma in list for SQL\n\t\t$sql = general_query(\"DELETE FROM \".$databaseinfo['prefix'].\"users WHERE id IN ($items_f)\"); //delete all records where the id is in the list\n\t\theader(\"Location: user.php\");\n\t\t\n\t} elseif ($do == \"edit\") {\n\t\t\t\n\t\tif ($globalvars['rank'][20] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\t\n\t\t\tdie(); //if header doesn't work, kill the script.\n\t\t}\n\t\t\t\n\t\t$globalvars['page_name'] = \"edit user\"; //declare page name\n\t\t$globalvars['page_image'] = \"user management\";\n\t\t$id = $_GET['id'];\n\t\t\n\t\tif ($id) {\n\t\t\t$id = clean_data($id);\n\t\t\t$fu_res = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"users WHERE id='$id' LIMIT 1\");\n\t\t\t//while\n\t\t\twhile ($data = mysql_fetch_assoc($fu_res)) {\n\t\t\t\t$content = user_form($data);\n\t\t\t}\n\t\t}\n\t} elseif ($do == \"editp\") {\n\t\n\tif ($globalvars['rank'][20] == 0) {\n\t\theader(\"Location: index.php?do=permissiondenied\");\t\n\t\tdie(); //if header doesn't work, kill the script.\n\t}\n\t\n\t\tif(isset($_POST)) {\n\t\t\t//generate vars\n\t\t\t$data['username_'] = $_POST['username_'];\n\t\t\t$data['fullname'] = $_POST['fullname'];\n\t\t\t$data['password_'] = $_POST['password_'];\n\t\t\t$data['cpassword_'] = $_POST['cpassword_'];\n\t\t\t$data['email'] = $_POST['email'];\n\t\t\t$data['msn'] = $_POST['msn'];\n\t\t\t$data['aim'] = $_POST['aim'];\n\t\t\t$data['yahoo'] = $_POST['yahoo'];\n\t\t\t$data['skype'] = $_POST['skype'];\n\t\t\t$data['rank'] = $_POST['rank'];\n\t\t\t$data['id'] = $_POST['id'];\n\t\t\t$data['original_username'] = $_POST['original_username'];\n\n\t\t\tforeach($data as $key => $value) {\n\t\t\t\t//clean data (SQL injection security)\n\t\t\t\t$data[$key] = clean_data($value);\n\t\t\t}\n\n\t\t\t$con = \"yes\";\n\t\t\t$error_message = '<ol class=\"warning\">\n\t\t\t';\n\t\t\tif (!$data['username_']) {  //no username\n\t\t\t\t$con = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>You must enter a username.</li>\n\t\t\t\t';\n\t\t\t}\n\t\t\tif (!$data['fullname']) { //no fullname\n\t\t\t\t$con = \"no\";\n\t\t\t\t$error_message = $error_message.'<li>You must enter a full name.</li>\n\t\t\t\t';\n\t\t\t}\n\n\t\t\tif ($data['password_']) {\n\t\t\t\t//if passwords don't match\n\t\t\t\tif ($data['password_'] != $data['cpassword_']) {\n\t\t\t\t\t$con = \"no\";\n\t\t\t\t\t$error_message = $error_message.'<li>Your passwords do not match.</li>\n\t\t\t\t\t';\n\t\t\t\t}\n\t\t\t}\n\t\t\t\t//check if username is already used\n\t\t\t\t$checkres = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"users WHERE user_name='\".$data['username_'].\"'\");\n\t\t\t\tif (mysql_num_rows($checkres) > 0) {\n\t\t\t\t\t\tif ($data['original_username'] != $data['username_']) { //if the username is already being used (excluding current one)\n\t\t\t\t\t\t\t$con = \"no\";\n\t\t\t\t\t\t\t$error_message = $error_message.'<li>The username specified is already being used. Please choose another.</li>';\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$error_message = $error_message.'</ol>';\n\t\t\t\n\t\t\tif ($con == \"yes\") { //if no problems\n\t\t\t\t$globalvars['page_name'] = \"edit success\";\n\t\t\t\t$globalvars['page_image'] = \"user management\";\n\t\t\t\t$user_sql = edit_user($data);\n\t\t\t} else { // if there WERE problems\n\t\t\t\t$globalvars['page_name'] = \"user management\";\n\t\t\t\t\t//shortcut fix for a small bug...we'll need to add to the array\n\t\t\t\t\t$data['user_name'] = $data['username_'];\n\t\t\t\t\t$data['full_name'] = $data['fullname'];\n\t\t\t\t$content = user_form($data);\n\t\t\t}\n\t\t}\n\t\t\n\t} elseif ($do == \"ranks\") { //rank management\n\t\t\t//quick permission check (redir to error) reference above this\n\t\t\tif ($globalvars['rank'][2] == 0) {\n\t\t\t\theader(\"Location: index.php?do=permissiondenied\");\t\n\t\t\t\tdie(); //if header doesn't work, kill the script.\n\t\t\t}\n\t\t$globalvars['page_name'] = \"rank management\";\n\t\t$globalvars['page_image'] = \"lock\";\n\t\t\n\t\t$item_list = load_items('ranks',0,5000,'','','');\n\t\t\n\t\t$row_bg = '#ffffff';\n\n\t\twhile ($item_row = mysql_fetch_array($item_list)) {\n\t\t\t//convert timestamp to readable/human date\n\t\t\t$item_row['timestamp'] = date($globalvars['time_format'],$item_row['timestamp']);\n\t\t\t$usercount_sql = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"articles WHERE article_author='\".$item_row['user_name'].\"'\");\n\t\t\t$num_items =  mysql_num_rows($usercount_sql);\n\t\t\t$row_bg = ($row_bg == '#ffffff') ? '#F5F5F5' : '#ffffff';\n\t\t\t\t\n\t\t\t$table_rows = $table_rows.'<tr bgcolor=\"'.$row_bg.'\"><td><a href=\"user.php?id='.$item_row['id'].'&do=editrank\">'.$item_row['rank_title'].'</a></td><td>'.$item_row['rank_desc'].'</td><td>'.$item_row['timestamp'].'</td><td>'.$item_row['permissions'].'</td><td>'.$item_row['rank_author'].'</td><td class=\"checkbox\"><input type=\"checkbox\" value=\"'.$item_row['id'].'\" name=\"'.$item_row['id'].'\"></td></tr>\n\t\t\t';\n\t\t} //end of WHILE statement\n\t\t\n\t\t$content = '\n\t\t<h3>Actions</h3>\n\t\t<ul>\n\t\t\t<li><a href=\"?do=newrank\">new rank</a></li>\t\t\t\n\t\t</ul>\n\t\t\n\t\t<h3>User list</h3>\n\t\t<form id=\"rankopt\" method=\"post\" action=\"?do=deleteranks\" onsubmit=\"return confirm(\\'Are you sure you want to delete the selected items?\\');\">\n\t\t<table style=\"text-align: left; width: 100%;\" border=\"1\"\n\t\t\t\t cellpadding=\"3\" cellspacing=\"2\">\n\t\t\t\t  <tbody>\n\t\t\t\t    <tr class=\"toprow\">\n\t\t\t\t      <td style=\"width: 200px; text-align: left;\"><strong>Rank title</strong></td>\n\t\t\t\t      <td><strong>Rank description</strong></td>\n\t\t\t\t      <td><strong>Date</strong></td>\n\t\t\t\t      <td><strong>Permission string</strong></td>\n\t\t\t\t      <td style=\"width: 80px\"><strong>Author</strong></td>\n\t\t\t\t      <td style=\"width: 10px; text-align: center;\"><strong><input type=\"checkbox\" onClick=\"Checkall(this.form);\" /></strong></td>\n\t\t\t\t    </tr>\n\t\t\t\t    '.$table_rows.'\n\t\t\t\t  </tbody>\n\t\t\t\t</table>\n\t\t\t\t<div style=\"text-align: right; width: 400px; float: right;\"><input type=\"submit\" id=\"submit\" value=\"Delete Selected\" /></div>\n\t\t</form>';\n\t} elseif ($do == \"deleteranks\") {\n\t\t\t//quick permission check (redir to error) reference above this\n\t\t\tif ($globalvars['rank'][2] == 0) {\n\t\t\t\theader(\"Location: index.php?do=permissiondenied\");\t\n\t\t\t\tdie(); //if header doesn't work, kill the script.\n\t\t\t}\n\t\t$items = $_POST; //get vars\n\t\tif (!$items) { //if no items, avoid mysql error by just redirecting\n\t\t\t\theader(\"Location: user.php?do=ranks\");\n\t\t\t}\n\t\tforeach($items as $key=>$value) { //create list of ids to be deleted\n\t\t\t$items_f = $items_f.\"'$key',\";\n\t\t}\n\t\t$items_f = substr_replace($items_f,\"\",-1); //remove last comma in list for SQL\n\t\t$sql = general_query(\"DELETE FROM \".$databaseinfo['prefix'].\"ranks WHERE id IN ($items_f)\"); //delete all records where the id is in the list\n\t\theader(\"Location: user.php?do=ranks\");\n\t\n\t} elseif ($do == \"newrank\") { //new rank\n\t\t\t//quick permission check (redir to error)\n\t\t\tif ($globalvars['rank'][0] == 0) {\n\t\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\t\tdie();\t\n\t\t\t}\n\t\t$globalvars['page_name'] = \"new rank\";\n\t\t$globalvars['page_image'] = \"lock\";\n\t\t$content = rank_form();\n\t\n\t} elseif ($do == \"nrankp\") {\n\t\t\t//quick permission check (redir to error)\n\t\t\tif ($globalvars['rank'][0] == 0) {\n\t\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\t\tdie();\t\n\t\t\t}\n\t\t$globalvars['page_name'] = \"rank success\";\n\t\t$globalvars['page_image'] = \"success\";\n\t\t//new rank creation process. Gather array\n\t\t\t$data = $_POST;\n\t\t\t\n\t\t\t//ok, so this gets a little complicated. We need to take all the data from the form, and make it into a string of 12 numbers, seperated by commas. The numbers will be 0s and 1s, 0 representing \"disallow\" and 1 \"allow\", 3 meaning a custom value.\n\t\t\t//the sequence is: 1,1,1,1,1,1,1,1,1,1,1,1\n\t\t\t//the english sequence...\n\t\t\t// createranks,manageranks,loginrecords,preferences,loggingin,createarticles,approve,editarticles,deletearticles,createusers,editusers,deleteusers  \n\t\t\t//in that order. THE ORDER IS IMPORTANT, due to the splitting later. :)\n\t\t\t//now on to the boring part of forming the query for insertion into the db. str_replace should suffice with a foreach() statement.\n\t\t\t$rank = $data; //we'll use this later.\n\t\t\t//first, unset the vars we don't need for this part.\n\t\t\tunset($data['rank_title']);\n\t\t\tunset($data['rank_desc']);\n\t\t\t$continue = TRUE;\n\t\t\tforeach ($data as $key=>$value) { //foreach string, lets create\n\t\t\t\t\t//check if there is a value. we need every value.\n\t\t\t\t\tif ($data[$key] == \"\") {\n\t\t\t\t\t\t$continue = FALSE;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t//replace 'allow' and 'disallow' with proper values. (0 and 1)\n\t\t\t\t$data[$key] = preg_replace('/^allow$/',1,$data[$key]);\n\t\t\t\t$data[$key] = str_replace('disallow',0,$data[$key]);\n\t\t\t\t\n\t\t\t\t//special\n\t\t\t\t$data[$key] = str_replace('allowapp',2,$data[$key]);\n\t\t\t\t\n\t\t\t\t$permissions_string .= $data[$key].','; //we form the string, putting a comma after each value.\n\n\t\t\t}\n\t\t\t//here is the string, with that last comma removed. Wow, it's three in the morning.\n\t\t\t$permissions_string = substr_replace($permissions_string,\"\",-1);\n\t\t\t\n\t\t\tif ($rank['rank_title'] == NULL || $rank['rank_desc'] == NULL || $continue == FALSE) { //if we're missing any piece, error.\n\t\t\t\t$globalvars['page_name'] = \"new rank\";\n\t\t\t\t$globalvars['page_image'] = 'error';\n\t\t\t\t$error_message = '<div class=\"warning\">You need values for each field, including the rank title and description.</div>';\n\t\t\t\t$content = rank_form($rank);\n\t\t\t} else {\n\t\t\t\tnew_rank($rank,$permissions_string,$_SESSION['username']);\n\t\t\t}\n\t} elseif ($do == \"editrank\") { //if we're editing the rank\n\t\t\t//quick permission check (redir to error)\n\t\t\tif ($globalvars['rank'][2] == 0) {\n\t\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\t\tdie();\t\n\t\t\t}\n\t\t$globalvars['page_name'] = \"edit rank\"; //declare page name\n\t\t$globalvars['page_image'] = \"lock\";\n\t\t$id = $_GET['id'];\n\t\t\n\t\tif ($id) {\n\t\t\t$id = clean_data($id);\n\t\t\t$ru_res = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"ranks WHERE id='$id' LIMIT 1\");\n\t\t\t//while\n\t\t\twhile ($data = mysql_fetch_assoc($ru_res)) {\n\t\t\t\t//we're going to convert the permissions from 1s ande 0s to proper form values.\n\t\t\t\t$data['permissions'] = str_replace('1','allow',$data['permissions']);\n\t\t\t\t$data['permissions'] = str_replace('0','disallow',$data['permissions']);\n\t\t\t\t$data['permissions'] = str_replace('2','allowapp',$data['permissions']);\n\t\t\t\t\n\t\t\t\t\t//now split string into array\n\t\t\t\t\t$data['permissions'] = split(',',$data['permissions']);\n\t\t\t\t\t\n\t\t\t\t\t//the sequence is: 1,1,1,1,1,1,1,1,1,1,1,1\n\t\t\t\t\t//the english sequence...\n\t\t\t\t\t// createranks,manageranks,loginrecords,preferences,loggingin,createarticles,approve,\n\t\t\t\t\t// editarticles,deletearticles,createusers,editusers,deleteusers\n\t\n\t\t\t\t//now we can assign new vars for form\n\t\t\t\t$data['createranks'] = $data['permissions'][0];\n\t\t\t\t$data['manageranks'] = $data['permissions'][1];\n\t\t\t\t$data['loginrecords'] = $data['permissions'][2];\n\t\t\t\t$data['preferences'] = $data['permissions'][3];\n\t\t\t\t$data['loggingin'] = $data['permissions'][4];\n\t\t\t\t$data['createarticles'] = $data['permissions'][5];\n\t\t\t\t\t//quick fix for label on create articles (allow w/ approval solution)\n\t\t\t\t\tif ($data['createarticles'] == 'allowapp') { $data['label'] = 'allow w/ approval'; } elseif ($data['createarticles'] == 'allow') { $data['label'] = 'allow'; } else { $data['label'] = 'disallow'; }\n\t\t\t\t$data['approve'] = $data['permissions'][6];\n\t\t\t\t$data['editarticles'] = $data['permissions'][7];\n\t\t\t\t$data['deletearticles'] = $data['permissions'][8];\n\t\t\t\t$data['createusers'] = $data['permissions'][9];\n\t\t\t\t$data['editusers'] = $data['permissions'][10];\n\t\t\t\t$data['deleteusers'] = $data['permissions'][11];\n\t\t\t\t\t\t\t\n\t\t\t\t$content = rank_form($data);\n\t\t\t}\n\t\t}\n\t} elseif ($do == \"erankp\") { //rank edit process\n\t\t\t//quick permission check (redir to error)\n\t\t\tif ($globalvars['rank'][2] == 0) {\n\t\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\t\tdie();\t\n\t\t\t}\n\t\t$globalvars['page_name'] = \"rank success\";\n\t\t$globalvars['page_image'] = \"success\";\n\t\t//new rank creation process. Gather array\n\t\t\t$data = $_POST;\n\t\t\t\n\t\t\t//ok, so this gets a little complicated. We need to take all the data from the form, and make it into a string of 12 numbers, seperated by commas. The numbers will be 0s and 1s, 0 representing \"disallow\" and 1 \"allow\", 3 meaning a custom value.\n\t\t\t//the sequence is: 1,1,1,1,1,1,1,1,1,1,1,1\n\t\t\t//the english sequence...\n\t\t\t// createranks,manageranks,loginrecords,preferences,loggingin,createarticles,approve,editarticles,deletearticles,createusers,editusers,deleteusers,  \n\t\t\t//in that order. THE ORDER IS IMPORTANT, due to the splitting later. :)\n\t\t\t//now on to the boring part of forming the query for insertion into the db. str_replace should suffice with a foreach() statement.\n\t\t\t$rank = $data; //we'll use this later.\n\t\t\t//first, unset the vars we don't need for this part.\n\t\t\tunset($data['rank_title']);\n\t\t\tunset($data['rank_desc']);\n\t\t\tunset($data['id']);\n\t\t\t$continue = TRUE;\n\t\t\tforeach ($data as $key=>$value) { //foreach string, lets create\n\t\t\t\t\t//check if there is a value. we need every value.\n\t\t\t\t\tif ($data[$key] == \"\") {\n\t\t\t\t\t\t$continue = FALSE;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t//replace 'allow' and 'disallow' with proper values. (0 and 1)\n\t\t\t\t$data[$key] = preg_replace('/^allow$/',1,$data[$key]);\n\t\t\t\t$data[$key] = str_replace('disallow',0,$data[$key]);\n\t\t\t\t\n\t\t\t\t//special\n\t\t\t\t$data[$key] = str_replace('allowapp',2,$data[$key]);\n\t\t\t\t\n\t\t\t\t$permissions_string .= $data[$key].','; //we form the string, putting a comma after each value.\n\n\t\t\t}\n\t\t\t//here is the string, with that last comma removed. Wow, it's three in the morning.\n\t\t\t$permissions_string = substr_replace($permissions_string,\"\",-1);\n\t\t\t\n\t\t\tif ($rank['rank_title'] == NULL || $rank['rank_desc'] == NULL || $continue == FALSE) { //if we're missing any piece, error.\n\t\t\t\t$globalvars['page_name'] = \"edit rank\";\n\t\t\t\t$globalvars['page_image'] = 'error';\n\t\t\t\t$error_message = '<div class=\"warning\">You need values for each field, including the rank title and description.</div>';\n\t\t\t\t$content = rank_form($rank);\n\t\t\t} else {\n\t\t\t\tedit_rank($rank,$permissions_string,$rank['id']);\n\t\t\t}\n\t\n\t\n\t} elseif ($do == \"loginrec\") { //login records\n\t\t\t//quick permission check (redir to error)\n\t\t\tif ($globalvars['rank'][4] == 0) {\n\t\t\t\theader(\"Location: index.php?do=permissiondenied\");\n\t\t\t\tdie();\t\n\t\t\t}\n\t\t$globalvars['page_name'] = \"login records\";\n\t\t$globalvars['page_image'] = \"user management\";\n\t\t\n\t\t$action = $_GET['action'];\n\t\t\n\t\t\t//if delete all\n\t\t\tif ($action == \"delall\") {\n\t\t\t\t$sql = general_query(\"DELETE FROM \".$databaseinfo['prefix'].\"userlogin\");\n\t\t\t\t\n\t\t\t\t$error_message = '<div class=\"warning\">All login records have been deleted.</div>';\n\t\t\t}\n\t\t\t\n\t\t//determine pagination\n\t\t$page = $_GET['page'];\n\t\t\tif (!$page) {\n\t\t\t\t$page = 1;\n\t\t\t}\n\t\t$items_per_page = 20;\n\t\t$page_start = ($page*$items_per_page) - $items_per_page;\n\t\t$next_page = $page + 1;\n\t\t$prev_page = $page - 1;\n\t\t\n\t\t\n\t\t$item_list = load_items('userlogin',$page_start,$items_per_page,$sort,$v);\n\t\t\n\t\tif (mysql_num_rows($item_list) == NULL) {\n\t\t\t$table_rows = '<td class=\"noresults\" colspan=\"6\"><strong>No returned results...</strong></td>';\n\t\t}\n\t\t\n\t\t$row_bg = '#ffffff';\n\t\t\n\t\twhile ($item_row = mysql_fetch_array($item_list)) {\n\t\t\t//convert timestamp to readable/human date\n\t\t\t$item_row['timestamp'] = date($globalvars['time_format'],$item_row['timestamp']);\n\t\t\t$item_row['name'] = gen_rank_name($item_row['rank_id']);\n\t\t\t$row_bg = ($row_bg == '#ffffff') ? '#F5F5F5' : '#ffffff';\n\t\t\t\n\t\t\t//generate rows from login attempts\n\t\t\t$table_rows = $table_rows.'<tr bgcolor=\"'.$row_bg.'\"><td><a href=\"manage.php?v='.$item_row['username'].'\"><strong>'.$item_row['username'].'</strong></a></td><td><a href=\"user.php?do=editrank&id='.$item_row['rank_id'].'\">'.$item_row['name'].'</a></td><td><strong>'.$item_row['timestamp'].'</strong></td><td>'.$item_row['ip'].'</td><td class=\"checkbox\"><input type=\"checkbox\" value=\"'.$item_row['id'].'\" name=\"'.$item_row['id'].'\"></td></tr>\n\t\t\t';\n\t\t}\n\t\t$content = loginrec_form();\n\t\n\t\n\t} //end main conditional\n\ninclude(\"inc/themecontrol.php\");  //include theme script\n?>\n"}]}
{"id": 12, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\auth.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\nif ($_COOKIE['cookie_auth'] && !$_SESSION['auth']) { //if we detect a cookie, we have to verify that it is valid.\n\t$globalvars['cookie_auth'] = clean_data($_COOKIE['cookie_auth']); //clean the data\n\t\n\t//check and see if there is an entry with that cookie auth code\n\t$cookie_check = general_query('SELECT * FROM '.$databaseinfo['prefix'].'cookielog WHERE cookie_id=\"'.$globalvars['cookie_auth'].'\"'); \n\t\n\tif (mysql_num_rows($cookie_check) > 0) {\n\t\n\t\t//we need an mysql_fetch_array too... so we can't use the previous one (without annoying while clauses)\n\t\t$cookie_check = general_query('SELECT * FROM '.$databaseinfo['prefix'].'cookielog WHERE cookie_id=\"'.$globalvars['cookie_auth'].'\"', TRUE);\n\t\t$user_fetch = general_query('SELECT * FROM '.$databaseinfo['prefix'].'users WHERE id=\"'.$cookie_check['user_id'].'\"', TRUE);\n\t\t$user_rank_data = general_query('SELECT * FROM '.$databaseinfo['prefix'].'ranks WHERE id=\"'.$user_fetch['rank_id'].'\"', TRUE);\n\t\t\n\t\t\t$_SESSION['auth'] = 'yes';\n\t\t\t$_SESSION['username'] = $user_fetch['user_name'];\n\t\t\t$_SESSION['userID'] = $user_fetch['id'];\n\t\t\t$_SESSION['permissions'] = $user_rank_data['permissions'];\n\t\t\t$_SESSION['path'] = $globalvars['path_to'];\n\t}\n}\n\nif (@$_SESSION['auth'] != \"yes\") {\n\theader(\"Location: login.php\");\n\tdie();\n}\n\nif (@$_SESSION['path'] != $globalvars['path_to']) {\n\theader(\"Location: login.php\");\n\tdie();\n}\n\t\n$globalvars['rank'] = $_SESSION['permissions']; //set new array\n\n/* Rank authority\n\n\tranks are recordered in a session variable, somewhat like this:\n\t1,1,1,1,1,1,1,1,1,1,1,1\n\t\n\tWHICH TRANLATES TO\n\t\n\tcreateranks,manageranks,loginrecords,preferences,loggingin,\n\tcreatearticles,approve,editarticles,deletearticles,createusers,\n\teditusers,deleteusers\n\t\n\tSo, we can use the following vars to identify each permission #:\n\t\n\tcreate ranks = $data['permissions'][0];\n\tmanage ranks = $data['permissions'][2];\n\tview login records = $data['permissions'][4];\n\tedit preferences = $data['permissions'][6];\n\tlogging in = $data['permissions'][8];\n\t*create articles = $data['permissions'][10];\n\t*approve articles = $data['permissions'][12];\n\tedit articles = $data['permissions'][14];\n\tdelete articles = $data['permissions'][16];\n\tcreate users = $data['permissions'][18];\n\tedit users = $data['permissions'][20];\n\tdelete users = $data['permissions'][22];\n\t\n\t\n\t====================\n\tTEMPLATE FOR DISALLOWING/ALLOWING\n\t====================\n\t\n\t\t//quick permission check (redir to error) reference above this\n\t\tif ($globalvars['rank'][#] == 0) {\n\t\t\theader(\"Location: index.php?do=permissiondenied\");\t\n\t\t\tdie(); //if header doesn't work, kill the script.\n\t\t}\n*/\n?>\n"}]}
{"id": 13, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\captcha.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n\t//captcha array, plus answers... :P\n\t\n\t$captcha = array(\n\t'5 + 2' => '7',\n\t'5 + 1' => '6',\n\t'4 + 2' => '6',\n\t'10 + 2' => '12',\n\t'3 + 2' => '5',\n\t'9 + 2' => '11',\n\t'15 + 2' => '17',\n\t'15 + 3' => '18',\n\t'3 + 9' => '12',\n\t'5 + 9' => '14',\n\t'3 + 3' => '6',\n\t'10 + 7' => '17',\n\t'3.5 + 1' => '4.5',\n\t'2 + 2' => '4',\n\t'85 + 2' => '87',\n\t'65 + 2' => '67',\n\t'5 + 22' => '27',\n\t'6 + 6' => '12',\n\t'9 + 9' => '18',\n\t'.5 + .5' => '1',\n\t'5 + 19' => '24',\n\t'5 plus nine' => '14',\n\t'5 plus five' => '10',\n\t'5 plus one' => '6',\n\t'5 + eighty' => '85',\n\t'5 plus 2' => '7',\n\t'one plus one' => '2',\n\t'10 - eight' => '2',\n\t'5 + 32' => '37',\n\t'112 + 2' => '114',\n\t'5 + 25' => '30',\n\t'5 * 2' => '10',\n\t'0  + 1' => '1',\n\t'zero plus 2' => '2',\n\t'56 plus 2' => '58',\n\t'3 + 20' => '23',\n\t'three plus 2' => '5',\n\t'three plus nine' => '12',\n\t'5 + 55' => '60',\n\t'five plus five' => '10',\n\t'the square root of 4' => '2',\n\t'20 - 1' => '19',\n\t'twenty minus one' => '19',\n\t'eight plus two' => '10',\n\t'two plus two' => '4',\n\t'100 + 9' => '109',\n\t'four plus nine' => '13',\n\t'-1 plus 4' => '3',\n\t'2 minus 1' => '1',\n\t'50 minus 40' => '10',\n\t'100 minus 99' => '1',\n\t'100 minus 2' => '98',\n\t'116 minus 6' => '110',\n\t'15 minus 4' => '9',\n\t'20 minus 15' => '5',\n\t'50 - 4' => '46',\n\t'34 plus 4' => '38',\n\t'43 minus 3' => '40',\n\t'500 minus 400' => '100',\n\t'2 multiplied by 4' => '8',\n\t'4 multiplied by 4' => '16',\n\t'5 multiplied by 4' => '20',\n\t'6 multiplied by four' => '24',\n\t'3 * 20' => '60',\n\t'4 * 20' => '80',\n\t'4 minus 1' => '3',\n\t'43 + 3' => '46',\n\t// 'the square root of: 54 plus fifty two, divided by 5, and multiplied by 2 * 10^23.' => '800000000000000000000000', //enable for fun.\n\t);\n?>\n"}]}
{"id": 14, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\config.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n//This is the file generated by the installation. Copy and paste this into the /inc/config.php file. If neceessary, you should edit anything needed below.\n\n//The Host is where the mySQL database is stored. Usually localhost.\n$databaseinfo['host'] = \"\";\n\n\n//The user your database is assigned to.\n$databaseinfo['user'] = \"\";\n\n\n//The password of your user.\n$databaseinfo['password'] = \"\";\n\n\n//The database name that phpns will use.\n$databaseinfo['dbname'] = \"\";\n\n\n//The table prefix defined on the database.\n$databaseinfo['prefix'] = \"\";\n\n\n//Change the variable below to \"yes\", once you have completed the above.\n$globalvars['installed'] = \"no\";\n\n\n\n?>\n"}]}
{"id": 15, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\errors.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n$live = \"no\";\n\n//Arrays are created below for each custom error message.\n\n$error['connection'] = '<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n\t<title>database error</title>\n</head>\n<body>\n\t<h1>database error</h1>\n\t<hr />\n\t<p>Phpns could not contact the database server. This may happen when you have supplied the wrong information in the /inc/config.php file, or the server has been overloaded, and is denying requests from our system.</p>\n\t<p><a href=\"../\">return to the main directory</a> | <a href=\"http://phpns.com\">phpns.com</a></p>\n\t<div><h5>Copyright 2007-08 Alec Henriksen | GPL License</h5></div>\n</body>\n</html>';\n\n$error['database'] = \"phpns couldn't select the database specified in the config.php file.\";\n\n$error['query'] = \"phpns couldn't execute an important query.\";\n\n\n?>\n"}]}
{"id": 16, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\function.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n\n\n\n/*\nSITE WIDE FUNCTIONS\nThe following functions are used for mice\n##############################################\n##############################################\n*/\n\tfunction general_query($query,$array=FALSE) { //for simple/misc queries\n\t\t\n\t\t\t\tif ($clean == TRUE) {\n\t\t\t\t\t$query = clean_data($query); //clean\n\t\t\t\t}\n\t\t\t\t\n\t\t\t$res = mysql_query($query) or die('<p><textarea style=\"width: 50%; height: 200px;\">FAILED QUERY: '.$query.'\n\t\t\t\n\t\t\t'.mysql_error().'</textarea></p>');\n\t\t\t//return value or not?\n\t\t\t\tif ($array == TRUE) { //if we want a value\n\t\t\t\t\t$value = mysql_fetch_array($res);\n\t\t\t\t\treturn $value;\n\t\t\t\t} else {\n\t\t\t\t\treturn $res;\n\t\t\t\t}\n\t\t}\n\tfunction content_num($table,$type,$ext) {\n\t\tglobal $databaseinfo; //for table prefix\n\t\tif ($type == 1) {\n\t\t\t$stat_sql = 'SELECT * FROM '.$databaseinfo['prefix'].''.$table.'';\n\t\t\t\tif ($ext == 1) { $extra = \"WHERE active=0\"; } //add selector for unactive stories\n\t\t\t\tif ($ext == 2) { $extra = \"WHERE approved=0\"; } //add selector for approved stories\n\t\t\t$stat_res = general_query('SELECT * FROM '.$databaseinfo['prefix'].''.$table.' '.$extra.'');\n\t\t\t$final = mysql_num_rows($stat_res);\n\t\t}\n\t\treturn $final;\n\t}\n\n\tfunction load_items($table,$start,$limit,$sort,$v) {\n\t\tglobal $databaseinfo; //for table prefix\n\t\t//determine viewable items\n\t\tif ($v == \"unactive\") {\n\t\t\t$v = \"WHERE active=0 \";\n\t\t} elseif ($v == \"active\") {\n\t\t\t$v = \"WHERE active=1 \";\n\t\t} elseif (is_numeric($v)  || $v == 'all') {\n\t\t\t$v = 'WHERE article_cat=\"'.$v.'\"';\n\t\t} elseif ($v == \"unapproved\") {\n\t\t\t$v = \"WHERE approved=0 \";\n\t\t} elseif ($v != \"\") {\n\t\t\t$v = \"WHERE article_author='\".$v.\"'\";\n\t\t}\n\t\t//determine sorting ASC and DESC, and column to sort. Syntax: $sort = column|(desc,asc);\n\t\tif ($sort) {\n\t\t\t$sort = split(\"/\",$sort);\n\t\t} else { //else default sorting/column\n\t\t\t$sort[0] = 'timestamp';\n\t\t\t$sort[1] = 'desc';\n\t\t}\n\t\t$load_res = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"$table \n\t\t\".$v.\"\n\t\tORDER BY \".$sort[0].\" \".$sort[1].\" \n\t\tLIMIT $start, $limit\");\n\t\t\n\t\tif (mysql_num_rows($load_res) == 0) {\n\t\t\t$table_rows = '<td colspan=\"6\">No returned results...</td>';\n\t\t}\n\t\t//return\n\t\treturn $load_res;\t\t\n\t}\n\t\n\tfunction search($search) { //search function. $search = array(); ['category'] and ['query']\n\t\tglobal $databaseinfo; //for table prefix\n\t\tglobal $page_start;\n\t\tglobal $items_per_page;\n\t\t//if all categories or just a certain category\n\t\tif ($search['category'] == \"all\") {\n\t\t\t$category_s = \"\";\n\t\t} else {\n\t\t\t$category_s = \"article_cat=\".$search['category'].\" AND (\";\n\t\t\t$category_s_e = ')';\n\t\t}\n\t\t//form the actual query\n\t\t$searchres = general_query(\"\n\t\tSELECT * FROM \".$databaseinfo['prefix'].\"articles\n\t\tWHERE $category_s article_title LIKE '%\".$search['query'].\"%'\n\t\tOR article_text LIKE '%\".$search['query'].\"%'\n\t\tOR article_exptext LIKE '%\".$search['query'].\"%' \".$category_s_e.\"\n\t\tORDER BY id DESC\n\t\tLIMIT $page_start, $items_per_page\");\n\n\t\treturn $searchres;\n\t}\n\t\n\tfunction load_config($name) { //for loading single values from db\n\t\tglobal $databaseinfo; //for table prefix\n\t\t$name = clean_data($name);\n\t\t$data = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"gconfig WHERE name='$name'\", TRUE);\n\t\treturn $data;\n\t}\n\tfunction change_config($name,$value) { //for loading single values from db\n\t\tglobal $databaseinfo; //for table prefix\n\t\t$name = clean_data($name);\n\t\t$value = clean_data($value);\n\t\t\t//if we need to use v3 instead of v1l\n\t\t\tif ($name == \"timestamp_format\" || $name == \"def_comlimit\" || $name == \"def_rsslimit\" || $name == \"def_rsstitle\" || $name == \"def_rssdesc\" || $name == \"global_message\") {\n\t\t\t\t$sql = \"UPDATE \".$databaseinfo['prefix'].\"gconfig SET v3='\".$value.\"' WHERE name='\".$name.\"'\";\n\t\t\t} else {\n\t\t\t\t$sql = \"UPDATE \".$databaseinfo['prefix'].\"gconfig SET v1='\".$value.\"' WHERE name='\".$name.\"'\";\n\t\t\t}\n\t\t$data = general_query($sql);\n\t\treturn $data;\n\t\t\n\t\t//log this action via log_this (will appear in system log)\n\t\tlog_this('change_config','User <i>'.$_SESSION['username'].'</i> has <strong>modified</strong> a configuration value,  \"'.$name.'\" to \"'.$value.'\"');\n\t}\n\t\n\tfunction delete($table,$items) {\n\t\tglobal $databaseinfo; //for table prefix\n\t\t$sql = general_query(\"DELETE FROM \".$databaseinfo['prefix'].\"\".$table.\" WHERE id IN (\".$items.\")\"); //delete all records where the id is in the list\n\t\treturn $res;\n\t\t\n\t\t//log this action via log_this (will appear in system log)\n\t\tlog_this('delete','User <i>'.$_SESSION['username'].'</i> has <strong>deleted</strong> a tables contents. Table: '.$table.'. Items: '.$items);\n\t}\n\n\tfunction decode_data($data) {\n\t\tif (is_array($data)) {\n\t\t\tforeach ($data as $key => $value) {\n\t\t\t\t$data[$key] = htmlspecialchars_decode($value);\n\t\t\t}\n\t\t} else {\n\t\t\t$data = htmlspecialchars_decode($data);\n\t\t}\n\t\treturn $data;\n\t}\n\t\n\tfunction fetch_template() { //figure out default template, or use a user defined one.\n\t\tglobal $databaseinfo; //for table prefix\n\t\tif (!$template) {  //if template is not defined by pre-var include... get default\n\t\t\tglobal $default_template;\n\t\t\t\n\t\t\t$res = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"templates WHERE template_selected='1' LIMIT 1\", TRUE);\n\t\t\t\t//update default_template var\n\t\t\t\t$default_template = $res['id'];\n\t\t\treturn $res; //return default template (changeable in preferences)\n\t\t} else {\n\t\t\t$res = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"templates WHERE id=\".$template.\" LIMIT 1\", TRUE);\n\t\t\treturn $res;\n\t\t}\n\t}\n\t\t\n\tfunction translate_comment($item,$template,$type) {\n\t\t\tglobal $id;\n\t\t\tglobal $timestamp_format;\n\t\t\t$template = decode_data($template);\n\t\t\tif ($type == \"html_comment\") {\n\t\t\t\t$item['timestamp'] = date($timestamp_format['v3'], $item['timestamp']);\n\t\t\t\t$item['comment_text'] = nl2br($item['comment_text']);\n\t\t\t\t$template = str_replace('{author}', $item['comment_author'], $template);\n\t\t\t\t$template = str_replace('{timestamp}', $item['timestamp'], $template);\n\t\t\t\t$template = str_replace('{comment}', $item['comment_text'], $template);\n\t\t\t\t$template = str_replace('{website}', $item['website'], $template);\n\t\t\t\t$template = str_replace('{ip}', $item['ip'], $template);\n\t\t\t\treturn $template;\n\t\t\t}\n\t\t}\n\t\t\n\tfunction log_this($task,$description) {\n\t\tglobal $globalvars;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t//clean data\n\t\t$task = clean_data($task);\n\t\t$description = clean_data($description);\n\t\t$page = clean_data($page);\n\t\t$page = $globalvars['full_page'];\n\t\t\n\t\t//form sql query and execute\n\t\t$log = general_query(\"INSERT INTO \".$databaseinfo['prefix'].\"syslog (task,description,user,page,timestamp) VALUES\n\t\t('\".$task.\"','\".$description.\"','\".$_SESSION[userID].\"','\".$page.\"','\".time().\"')\");\n\t\t\t//done adding log entry\n\t}\n\n\tfunction log_form() {\n\t\t\n\t\t//global all the vars we need.\n\t\tglobal $log_rows;\n\t\tglobal $prev_page;\n\t\tglobal $next_page;\n\t\tglobal $globalvars;\n\t\tglobal $page_start;\n\t\tglobal $items_per_page;\n\t\tglobal $do;\n\t\tglobal $sort;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\tif (!$sort) { //if no sorting option exists.\n\t\t\t$sort = 'timestamp/asc';\n\t\t}\n\t\t\n\t\tif ($sort) {\n\t\t\t//decide what to inverse\n\t\t\t$sort_r = split(\"/\",$sort);\n\t\t\t//$sort_r[0] = ($sort_r[0] == \"id\") ? $sort_r[0] : 'id';\n\t\t\t$sort_r[1] = ($sort_r[1] == \"desc\") ? 'asc' : 'desc';\n\t\t\t$sort_sql = $sort_r;\t\t\t\n\t\t\t$sort_r = $sort_r[1];\n\t\t}\n\n\n\t\t$lres = general_query('SELECT * FROM '.$databaseinfo['prefix'].'syslog ORDER BY '.$sort_sql[0].' '.$sort_sql[1].' LIMIT '.$page_start.','.$items_per_page); //fetch query\n\t\t\twhile ($lrow = mysql_fetch_assoc($lres)) { //get arrays\n\t\t\t\t\t$row_bg = ($row_bg == '#ffffff') ? '#F5F5F5' : '#ffffff'; //switch row colors\n\t\t\t\t\t$usernamerow = mysql_fetch_assoc(general_query('SELECT user_name FROM '.$databaseinfo['prefix'].'users WHERE id='.$lrow[user].'')); //fetch user\n\t\t\t\t\t$lrow['user'] = $usernamerow['user_name'];\t\n\t\t\t\t\tif ($lrow['user'] == NULL) $lrow['user'] = \"<span style=\\\"color:red;font-weight:bold;\\\">N/A</span>\";\t\n\t\t\t\t\t$lrow['page'] = wordwrap($lrow['page'], 30, \"<br />\\n\", TRUE);\n\t\t\t\t\t$lrow['timestamp'] = date($globalvars['time_format'],$lrow['timestamp']);\n\t\t\t\t\t$log_rows .= '\n\t\t\t\t\t<tr bgcolor=\"'.$row_bg.'\">\n\t\t\t\t\t\t<td><strong>'.$lrow['task'].'</strong></td>\n\t\t\t\t\t\t<td>'.decode_data($lrow['description']).'</td>\n\t\t\t\t\t\t<td>'.$lrow['user'].'</td>\n\t\t\t\t\t\t<td>'.$lrow['timestamp'].'</td>\n\t\t\t\t\t\t<td>'.$lrow['page'].'</td>\n\t\t\t\t\t</tr>';\n\t\t\t\t}\n\n\t\t\n\t\t$form = '\n\t\t<h3>Log list</h3>\n\n\n\t\t<table style=\"text-align: left; width: 100%;\" border=\"1\"\n\t\t cellpadding=\"3\" cellspacing=\"2\">\n\t\t  <tbody>\n\t\t    <tr class=\"toprow\">\n\t\t      <td style=\"width: 200px; text-align: left;\"><a href=\"?do=syslog&sort=task/'.$sort_r.'\"><strong>Task</strong></a></td>\n\t\t      <td><a href=\"?do=syslog&sort=description/'.$sort_r.'\"><strong>Description</strong></a></td>\n\t\t      <td><a href=\"?do=syslog&sort=user/'.$sort_r.'\"><strong>User</strong></a></td>\n\t\t      <td><a href=\"?do=syslog&sort=timestamp/'.$sort_r.'\"><strong>Timestamp</strong></a></td>\n\t\t      <td style=\"width: 50px\"><a href=\"?do=syslog&sort=page/'.$sort_r.'\"><strong>Page</strong></a></td>\n\t\t    </tr>\n\t\t    '.$log_rows.'\n\t\t  </tbody>\n\t\t</table>\n\t\t<div style=\"text-align: right; width: 400px; float: right;\"><input type=\"submit\" id=\"submit\" value=\"Delete Selected\" /></div>\n\n\t\t<div><button class=\"previous\" OnClick=\"window.location = \\'?do=syslog&page='.$prev_page.'&sort='.$sort.''.$a_js.'\\';\">Previous ('.$prev_page.')</button> <button class=\"next\" OnClick=\"window.location = \\'?do=syslog&page='.$next_page.'&sort='.$sort.''.$a_js.'\\';\">Next ('.$next_page.')</button>\n\t\t</div>\n\t\t';\n\t\t\n\t\treturn $form;\n\t}\n\n/*\nNEWS MANAGEMENT FUNCTIONS\nThe following functions are used for news management globally for phpns.\n##############################################\n##############################################\n*/\n\n\tfunction gen_categories($format,$display) {\n\t\tglobal $data;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t$row_bg = '#ffffff';\n\t\t$cat_res = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"categories WHERE cat_parent=''\"); //select categories\n\t\twhile ($cat_row = mysql_fetch_assoc($cat_res)) {\n\t\t\tif ($format == \"option\") {\n\t\t\t\t//make the current category selected\n\t\t\t\tif ($data['article_cat'] == $cat_row['id']) {\n\t\t\t\t\t$cat_list = $cat_list.\n\t\t\t\t\t'<option selected=\"selected\" value=\"'.$cat_row['id'].'\">'.$cat_row['cat_name'].'</option>';\n\t\t\t\t} else {\n\t\t\t\t\t$cat_list = $cat_list.\n\t\t\t\t\t'<option value=\"'.$cat_row['id'].'\">'.$cat_row['cat_name'].'</option>';\n\t\t\t\t}\n\t\t\t\t\tif ($display != 'top') {\n\t\t\t\t\t\t//while we get each \"top\" level categories (without a parent, get the subcategories, and list them BELOW each main cat.\n\t\t\t\t\t\t$cat_sqlres = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"categories WHERE cat_parent=\".$cat_row['id'].\"\");\n\t\t\t\t\t\twhile ($catsub_row = mysql_fetch_assoc($cat_sqlres)) {\n\t\t\t\t\t\t\tif ($data['article_cat'] == $catsub_row['id']) { //if subcat selected\n\t\t\t\t\t\t\t$cat_list = $cat_list.'\n\t\t\t\t\t\t\t <option value=\"'.$catsub_row['id'].'\" selected=\"selected\">&nbsp;&nbsp;&nbsp;&nbsp;--'.$catsub_row['cat_name'].'</option>';\n\t\t\t\t\t\t\t } else { //else not selected\n\t\t\t\t\t\t\t \t$cat_list = $cat_list.'\n\t\t\t\t\t\t\t\t<option value=\"'.$catsub_row['id'].'\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'.$catsub_row['cat_name'].'</option>';\n\t\t\t\t\t\t\t }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t} elseif ($format = \"row\") {\n\t\t\t\t$row_bg = ($row_bg == '#ffffff') ? '#F5F5F5' : '#ffffff';\n\t\t\t\t$cat_row['timestamp'] = date(\"D M d, Y\",$cat_row['timestamp']);\n\t\t\t\t$cat_list = $cat_list.\n\t\t\t\t'<tr bgcolor=\"'.$row_bg.'\"><td><a href=\"preferences.php?do=categories&amp;action=edit&amp;id='.$cat_row['id'].'\"><strong>'.$cat_row['cat_name'].'</strong></a></td><td><strong>'.$cat_row['cat_parent'].'</strong></td><td>'.$cat_row['cat_desc'].'</td><td>'.$cat_row['timestamp'].'</td><td><input type=\"checkbox\" value=\"'.$cat_row['id'].'\" name=\"'.$cat_row['id'].'\" /></td></tr>\n\t\t\t\t';\n\t\t\t\t$cat_sqlres = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"categories WHERE cat_parent=\".$cat_row['id'].\"\");\n\t\t\t\t\t\twhile ($catsub_row = mysql_fetch_assoc($cat_sqlres)) {\n\t\t\t\t\t\t\t$catsub_row['timestamp'] = date(\"D M d, Y\",$catsub_row['timestamp']);\n\t\t\t\t\t\t\t$cat_list = $cat_list.\n\t\t\t\t'<tr bgcolor=\"#ccc\" ><td bgcolor=\"#999999\"><em> - '.$catsub_row['cat_name'].'</em></td><td>This is a sub-category.</td> <td> '.$catsub_row['cat_desc'].'</td><td>'.$catsub_row['timestamp'].'</td><td><input type=\"checkbox\" value=\"'.$cat_row['id'].'\" name=\"'.$cat_row['id'].'\" /></td></tr>\n\t\t\t\t';\n\t\t\t\t\t\t}\n\t\t\t}\n\t\t} //end while\n\t\treturn $cat_list;\n\t}\n\t\n\tfunction gen_templates() {\n\t\tglobal $databaseinfo; //for table prefix\n\t\t$t_res = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"templates\"); //select categories\n\t\twhile ($t_row = mysql_fetch_assoc($t_res)) {\n\t\t\t$template_list .= \n\t\t\t'<option value=\"'.$t_row['id'].'\">'.$t_row['template_name'].'</option>';\n\t\t} //end while\n\t\treturn $template_list;\n\t}\n\t\n\tfunction article_form() {\n\t\tglobal $data;\n\t\tglobal $error_message;\n\t\tglobal $globalvars;\n\t\tglobal $do;\n\t\tglobal $news_id;\n\t\t$data['cat_list'] = gen_categories('option','');\n\t\t//define form HTML display for new items.\n\t\t\tif (!$do || $do == \"p\" || $do == \"preview\") {\n\t\t\t\t$action = '?&amp;do=p';\n\t\t\t} else {\n\t\t\t\t$action = '?id='.$data['id'].'&amp;do=editp';\n\t\t\t}\n\t\t\tif ($do == \"edit\") {\n\t\t\t\t$hidden_f = '<input type=\"hidden\" id=\"id\" name=\"id\" value=\"'.$news_id.'\" />';\n\t\t\t\tif ($data['approved'] == 0 && $globalvars['rank'][12] == 1) {\n\t\t\t\t\t$needs_to_be_approved = '<button class=\"activate\" OnClick=\"window.location = \\'?do=activate&amp;id='.$data['id'].'\\';\"><strong>Click here to approve this article</strong></button>';\n\t\t\t\t}\n\t\t\t\t$comment_b = '<div>'.$needs_to_be_approved.' <button class=\"activate\" OnClick=\"window.location = \\'?do=comments&amp;id='.$data['id'].'\\';\"><strong>View commens for this item</strong></button></div>';\n\t\t\t}\n\t\t\t\n\t\t\t//if there is an image in the db, display that above the upload form.\n\t\t\tif ($data['article_imgid']) {\n\t\t\t\t$image_view = '<a href=\"'.$data['article_imgid'].'\"><img class=\"image_uploaded\" src=\"'.$data['article_imgid'].'\" /></a>';\n\t\t\t}\n\t\t\t\t\t\t\n\t\t//define warning if you need approval\n\t\tif ($globalvars['rank'][10] == 2) {\n\t\t\t$rank_message = '<div class=\"warning\">You have permission to create new articles, however, you need approval before it actually becomes publically viewable.</div>';\n\t\t}\n\t\t\n\t\t$form_display = '\t\t\n\t\t\t'.$comment_b.'\n\t\t\t'.$rank_message.'\n\t\t<div class=\"form\">\n\t\t\t\t'.$error_message.'\n\t\t\t\t<form id=\"articleform\" method=\"post\" enctype=\"multipart/form-data\" action=\"'.$action.'\" onsubmit=\"return validate_form(this)\">\n\t\t\t\t\t<label for=\"title\">Article title</label><input type=\"text\" id=\"title\" name=\"article_title\" value=\"'.$data['article_title'].'\" /><br />\n\t\t\t\t\t<label for=\"subtitle\">Sub-title *</label><input type=\"text\" id=\"subtitle\" name=\"article_subtitle\" value=\"'.$data['article_subtitle'].'\"  /><br />\n\t\t\t\t\t<label for=\"category\">Category (<a href=\"preferences.php?do=categories\" onClick=\"return confirm(\\'Are you sure you want to leave this page, to edit categories?\\\\n\\\\nYou will loose all progress on your article.\\');\">edit</a>)</label>\n\t\t\t\t\t<select name=\"article_cat\" id=\"category\">\n\t\t\t\t\t\t<option value=\"all\">All categories</option>\n\t\t\t\t\t\t<optgroup label=\"Categories\">\n\t\t\t\t\t\t'.$data['cat_list'].'\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select><br />\n\t\t\t\t\t<label class=\"for_textarea\" for=\"main\">Main article <a href=\"javascript:togglewysiwyg(\\'main\\');\">wysiwyg on/off</a> <a href=\"javascript:expandwysiwyg(\\'main\\');\">expand editor</a></label><textarea name=\"article_text\" id=\"main\" onkeypress=\"checkTab(event);\">'.$data['article_text'].'</textarea><br />\n\t\t\t\t\t<h4>Extended article (<a href=\"javascript:expand(\\'advanced\\');\">expand/collapse</a>)</h4>\t\n\t\t\t\t\t<div id=\"advanced\" class=\"advanced advanced_extended\" style=\"display: none;\">\n\t\t\t\t\t\t<label class=\"for_textarea\" for=\"full\">Extended* <a href=\"javascript:togglewysiwyg(\\'full\\');\">wysiwyg on/off</a> <a href=\"javascript:expandwysiwyg(\\'full\\');\">expand editor</a></label><textarea name=\"article_exptext\" id=\"full\" onkeypress=\"checkTab(event);\">'.$data['article_exptext'].'</textarea><br />\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<h4>Image options (<a href=\"javascript:expand(\\'image_options\\');\">expand/collapse</a>)</h4>\t\n\t\t\t\t\t<div id=\"image_options\" class=\"advanced\" style=\"display: none;\">\n\t\t\t\t\t\t'.$image_view.'\n\t\t\t\t\t\t<label for=\"image\">Article image</label><input type=\"file\" name=\"image\" id=\"image\" /><br />\n\t\t\t\t\t\t<div class=\"clear\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<h4>Additional Options (<a href=\"javascript:expand(\\'add_options\\');\">expand/collapse</a>)</h4>\n\t\t\t\t\t<div id=\"add_options\" class=\"advanced\" style=\"display: none;\">\n\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"start\">Start date *</label><input type=\"text\" name=\"start_date\" id=\"start\"  value=\"'.$data['start_date'].'\" /> (mm/dd/yyyy) <em>(time on server: '.date('m/d/Y').')</em><br />\n\t\t\t\t\t\t<label for=\"end\">End date *</label><input type=\"text\" name=\"end_date\" id=\"end\" value=\"'.$data['end_date'].'\" /> (mm/dd/yyyy)<br />\n\t\t\t\t\t\t<label for=\"comments\" class=\"nofloat\"><input type=\"checkbox\" value=\"0\" name=\"acchecked\" id=\"comments\"'.$data['acchecked_check'].' /> Disable comments</label><br /><br />\n\t\t\t\t\t\t<label for=\"active\" class=\"nofloat\"><input type=\"checkbox\" value=\"0\" name=\"achecked\" id=\"active\"'.$data['achecked_check'].' /> Save as draft (unactive)</label><br />\n\t\t\t\t\t</div>\n\t\t\t\t\t'.$hidden_f.'\n\t\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t\t<input type=\"submit\" id=\"submit\" name=\"submit\" value=\"Save article\" />\n\t\t\t\t\t\t<input type=\"submit\" id=\"preview\" name=\"preview\" value=\"Preview article\" />\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\n\t\t</div>';\n\t\t\n\t\treturn $form_display;\n\t}\n\t\n\tfunction manage_form() {\n\t\t//global all the vars we need.\n\t\tglobal $table_rows;\n\t\tglobal $prev_page;\n\t\tglobal $next_page;\n\t\tglobal $globalvars;\n\t\tglobal $search;\n\t\tglobal $do;\n\t\tglobal $sort;\n\t\tglobal $search;\n\t\t//generate categories as an option list (<option>...</option)\n\t\t$category_list = gen_categories('option','')\n\t\t;\n\t\tif ($globalvars['page_name'] == \"search\") { //things to do if we're searching \n\t\t\t$s_value = $search['query']; //get the query\n\t\t\t$s_cat = gen_cat_name($search['category']); //turn cat number into human readable label\n\t\t\t$a_js = '&amp;q='.$search['query'].'&amp;c='.$search['category'].'&amp;do=search'; //to put in URL if we're searching\n\t\t\t//determine selected category\n\t\t\t$cat_selected = '<optgroup label=\"Selected:\">\n\t\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$search['category'].'\">'.$s_cat.'</option>\n\t\t\t\t\t\t</optgroup>';\n\t\t\t\n\t\t} else {\n\t\t\t$s_value = \"click here to start the search...\"; //default\n\t\t\t$script = ' onfocus=\"if\n\t(this.value==this.defaultValue) this.value=\\'\\';\"'; //enable click/delete script\n\t\t}\n\t\t\n\t\tif (!$sort) { //if no sorting option exists.\n\t\t\t$sort = 'timestamp/desc';\n\t\t}\n\t\t\n\t\tif ($sort) {\n\t\t\t//decide what to inverse\n\t\t\t$sort_r = split(\"/\",$sort);\n\t\t\t$sort_r[1] = ($sort_r[1] == \"desc\") ? 'asc' : 'desc';\n\t\t\t$sort_r = $sort_r[1];\n\t\t}\n\t\t\n\t\t$form = '\n\t\t\n\t\t<form action=\"manage.php?do=search\" method=\"post\">\n\t\t\t<div class=\"form\">\n\t\t\t\t<h4>Search (<a href=\"javascript:expand(\\'search\\');\">expand/collapse</a>)</h4>\n\t\t\t\t<div class=\"advanced\" id=\"search\" style=\"display: none\">\n\t\t\t\t\t<input type=\"text\" id=\"search\" name=\"query\" value=\"'.$s_value.'\" class=\"searchbox\"'.$script.' />\n\t\t\t\t\t<select name=\"category\" class=\"searchelements\" id=\"category\" name=\"category\">\n\t\t\t\t\t\t<option value=\"all\">All Categories</option>\n\t\t\t\t\t\t\t'.$cat_selected.'\n\t\t\t\t\t\t<optgroup label=\"Categories\">\n\t\t\t\t\t\t\t'.$category_list.'\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>\n\t\t\t\t\t<input type=\"submit\" class=\"searchbutton\" value=\"Search!\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t\t\n\t\t<h3>Article list</h3>\n\t\t<form action=\"manage.php\" method=\"get\" class=\"category_wrap\">\n\t\t\t<select name=\"v\" onchange=\"submit();\" class=\"cat_navigation\">\n\t\t\t\t<option value=\"\" class=\"notice\">Return to full viewing</option>\n\t\t\t\t<option value=\"\" selected=\"selected\">View articles in the category ...</option>\n\t\t\t\t<optgroup label=\"Categories\" selected=\"selected\">\n\t\t\t\t'.$category_list.'\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t</form>\n\t\t<form action=\"manage.php?do=deleteitems\" method=\"post\" onsubmit=\"return confirm(\\'Are you sure you want to delete the selected items?\\');\">\n\t\t\t<table style=\"text-align: left; width: 100%;\" border=\"1\"\n\t\t\t cellpadding=\"3\" cellspacing=\"2\">\n\t\t\t  <tbody>\n\t\t\t    <tr class=\"toprow\">\n\t\t\t      <td style=\"width: 200px; text-align: left;\"><a href=\"?sort=article_title/'.$sort_r.'\"><strong>Title</strong></a></td>\n\t\t\t      <td><a href=\"?sort=article_cat/'.$sort_r.'\"><strong>Category</strong></a></td>\n\t\t\t      <td><a href=\"?sort=timestamp/'.$sort_r.'\"><strong>Date</strong></a></td>\n\t\t\t      <td><a href=\"?sort=article_author/'.$sort_r.'\"><strong>Author</strong></a></td>\n\t\t\t      <td style=\"width: 50px\"><a href=\"?sort=active/'.$sort_r.'\"><strong>Active</strong></a></td>\n\t\t\t      <td style=\"width: 10px; text-align: center;\"><strong><input type=\"checkbox\" onClick=\"Checkall(this.form);\" /></strong></td>\n\t\t\t    </tr>\n\t\t\t    '.$table_rows.'\n\t\t\t  </tbody>\n\t\t\t</table>\n\t\t\t<div style=\"text-align: right; width: 400px; float: right;\"><input type=\"submit\" id=\"submit\" value=\"Delete Selected\" /></div>\n\t\t</form>\n\t\t<div><button class=\"previous\" OnClick=\"window.location = \\'?page='.$prev_page.'&sort='.$sort.''.$a_js.'\\';\">Previous ('.$prev_page.')</button> <button class=\"next\" OnClick=\"window.location = \\'?page='.$next_page.'&sort='.$sort.''.$a_js.'\\';\">Next ('.$next_page.')</button>\n\t\t</div>\n\t\t';\n\t\t\n\t\treturn $form;\n\t}\n\t\n\t\n\tfunction new_item($data,$author) {\n\t\t//globalize timestamps\n\t\tglobal $unixtime;\n\t\tglobal $globalvars;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\t$news_ip = $_SERVER['REMOTE_ADDR'];\n\t\t//form SQL query\n\t\t  $new_res = general_query('INSERT INTO '.$databaseinfo['prefix'].'articles\n                    (article_title,\n                    article_subtitle,\n                    article_author,\n                    article_cat,\n                    article_text,\n                    article_exptext,\n                    article_imgid,\n                    allow_comments,\n                    start_date,\n                    end_date,\n                    active,\n                    approved,\n                    timestamp,\n                    ip)\n              VALUES (\"'.$data['article_title'].'\",\n                      \"'.$data['article_subtitle'].'\",\n                      \"'.$author.'\",\n                      \"'.$data['article_cat'].'\",\n                      \"'.$data['article_text'].'\",\n                      \"'.$data['article_exptext'].'\",\n                      \"http://'.$globalvars['path_to_uri'].'/'.$data['image'].'\",\n                      \"'.$data['acchecked'].'\",\n                      \"'.$unixtime['start']['unix'].'\",\n                      \"'.$unixtime['end']['unix'].'\",\n                      \"'.$data['achecked'].'\",\n                      \"'.$data['approved'].'\",\n                      \"'.$globalvars['time'].'\",\n                      \"'.$news_ip.'\");');\n\t\t\n\t\t\t //log this action via log_this (will appear in system log)\n                    log_this('new_item','User <i>'.$_SESSION['username'].'</i> has <strong>created</strong> a new article titled \"'.$data['article_title'].'\"');\n\t}\n\t\n\tfunction edit_item($data,$username) {\n\t\t//globalize timestamps\n\t\tglobal $unixtime;\n\t\tglobal $globalvars;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t//define some misc vars (timestamp, ip)\n\t\t\n\t\t//decide if we're uploading a new image. If yes, then add to the query.\n\t\tif ($data['image']) {\n\t\t\t$upload_image_sql_add = 'article_imgid=\"http://'.$globalvars['path_to_uri'].'/'.$data['image'].'\",';\n\t\t}\n\t\t\n\t\t$news_ip = $_SERVER['REMOTE_ADDR'];\n\t\t//form SQL query\n\t\t\t\t  $edit_res = general_query('UPDATE '.$databaseinfo['prefix'].'articles SET\n                    article_title=\"'.$data['article_title'].'\",\n                    article_subtitle=\"'.$data['article_subtitle'].'\",\n                    article_author=\"'.$username.'\",\n                    article_cat=\"'.$data['article_cat'].'\",\n                    article_text=\"'.$data['article_text'].'\",\n                    article_exptext=\"'.$data['article_exptext'].'\",\n                    '.$upload_image_sql_add.'\n                    allow_comments=\"'.$data['acchecked'].'\",\n                    start_date=\"'.$unixtime['start']['unix'].'\",\n                    end_date=\"'.$unixtime['end']['unix'].'\",\n                    active=\"'.$data['achecked'].'\",\n                    ip=\"'.$news_ip.'\"\n                    WHERE id=\"'.$data['id'].'\"');\n                    \n                    //log this action via log_this (will appear in system log)\n                    log_this('edit_item','User <i>'.$_SESSION['username'].'</i> has <strong>modified</strong> article titled \"'.$data['article_title'].'\" (ID: '.$data['id'].')');\n\t}\n\t\n\tfunction upload_image($file) {\n\t\t\n\t\t//define the default path to upload\n\t\t$target_path = \"images/uploads/\";\n\t\t\n\t\t//define the random prefix to the name\n\t\t$random = rand(0,99999);\n\t\t\n\t\t//now, this is where we decide what filename, and directory this will be stored at.\n\t\t$target_path = $target_path.$random.basename($file['name']); \n\t\t\n\t\tif ($file['type'] == 'image/gif' || $file['type'] == 'image/jpeg' || $file['type'] == 'image/jpg' || $file['type'] == 'image/png' || $file['type'] == 'image/bmp' || $file['type'] == 'image/tiff' ||  $file['type'] == 'image/tff') {\n\t\t\tif (@move_uploaded_file($file['tmp_name'], $target_path)) { //if we moved the file succesfully to target_path\n\t\t\t\tchmod($target_path, 0644); //chmod it so we can access it later.\n\t\t\t\treturn $target_path; //return the target path to the manage.php\n\t\t\t\techo $target_path;\n\t\t\t} else { //if we didn't move the file / error\n\t\t\t\treturn FALSE; //return false\n\t\t\t}\n\t\t} else {\n\t\t\treturn FALSE;\n\t\t}\n\t}\n\t\n\t\n\tfunction approve($id) {\n\t\t//form SQL query\n\t\t\t$edit_res = general_query('UPDATE '.$databaseinfo['prefix'].'articles SET\n                    approved=\"1\"\n                    WHERE id=\"'.$id.'\"');\n                   return TRUE;\n\t}\n\t\n\t\n\t//generate category name from id\n\tfunction gen_cat_name($catid) {\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\tif ($catid != \"all\") {\n\t\t\t$catname = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"categories WHERE id='$catid' LIMIT 1\", TRUE);\n\t\t\treturn $catname['cat_name'];\n\t\t} else {\n\t\t\treturn \"<strong>All Categories</strong>\";\n\t\t}\n\t}\n\t\n\tfunction clean_data($data) {\n\t\tif (is_array($data)) {\n\t\t\tforeach ($data as $key => $value) {\n\t\t\t\tif(ini_get('magic_quotes_gpc')) { $data[$key] = stripslashes($value); }\n\t\t\t\t$data[$key] = htmlspecialchars($value, ENT_QUOTES);\n\t\t\t\t}\n\t\t} else {\n\t\t\tif(ini_get('magic_quotes_gpc')) { $data = stripslashes($data); }\n\t\t\t$data = htmlspecialchars($data, ENT_QUOTES);\n\t\t}\n\t\t\n\t\treturn $data;\n\t}\n\t\n\tfunction validate_date($data,$rawtype) {\n\t\tglobal $error_message;\n\t\tglobal $proceed;\n\t\t\t//determine type (start or end)\n\t\t\tif ($rawtype == \"start\") {\n\t\t\t\t$type = \"start_date\";\n\t\t\t} elseif ($rawtype == \"end\") {\n\t\t\t\t$type = \"end_date\";\n\t\t\t}\n\t\tif (eregi('^[0-9]{2}/[0-9]{2}/[0-9]{4}$',$data[$type])) { //if start date is formed correctly\n\t\t\t\t\t$unixtime['format'] = TRUE; //so the rest of the program knows it's a valid date\n\t\t\t\t\t$data[$type] = split(\"/\",$data[$type]); //split mm/dd/yyyy\n\t\t\t\t\tif (!checkdate($data[$type][0],$data[$type][1],$data[$type][2])) { //if invalid\n\t\t\t\t\t\t$proceed = \"no\";\n\t\t\t\t\t\t$error_message = $error_message.'<li>The '.$rawtype.' date is not a valid date.</li>\n\t\t\t\t\t\t';\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//check if date is too extreme (too far in future or past)\n\t\t\t\t\t\tif (mktime(0,0,0,$data[$type][0],$data[$type][1],$data[$type][2])) {\n\t\t\t\t\t\t\t$unixtime['valid'] = TRUE;\n\t\t\t\t\t\t\t$unixtime['unix'] = mktime(0,0,0,$data[$type][0],$data[$type][1],$data[$type][2]);\n\t\t\t\t\t\t} else { //if it is too extreme...\n\t\t\t\t\t\t\t$proceed = \"no\";\n\t\t\t\t\t\t\t$unixtime['unix'] = join(\"/\",$data[$type]);\n\t\t\t\t\t\t\t$error_message = $error_message.'<li>The '.$rawtype.' date timestamp could not be created. It may be too far in the future...</li>\n\t\t\t\t\t\t\t';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$proceed = \"no\";\n\t\t\t\t\t$error_message = $error_message.'<li>The '.$rawtype.' date is not in a valid format. The correct format is: MM/DD/YYYY.</li>\n\t\t\t\t\t';\n\t\t\t\t}\n\t\treturn $unixtime;\n\t}\n\n\t\n/*\nUSER PAGE FUNCTIONS\nThe following functions are used for user operations\n##############################################\n##############################################\n*/\n\tfunction fetch_ranks($view='option') {\n\t\tglobal $databaseinfo;\n\t\t$rankres = general_query('SELECT * FROM '.$databaseinfo['prefix'].'ranks');\n\t\t\twhile ($rr = mysql_fetch_assoc($rankres)) {\n\t\t\t\t$options .= '<option value=\"'.$rr['id'].'\">'.$rr['rank_title'].'</option>\n\t\t\t\t';\n\t\t\t}\n\t\treturn $options;\n\t}\n\t\n\tfunction user_form($data=NULL) {\n\t\tglobal $error_message;\n\t\tglobal $do;\n\t\t\tif ($do == \"new\" || $do == \"newp\") { //if this is a new process\n\t\t\t\t$u_action = 'newp';\n\t\t\t} elseif ($do == \"edit\" || $do == \"editp\") {\n\t\t\t\t$u_action = 'editp';\n\t\t\t\t$u_hiddenid = '<input type=\"hidden\" name=\"id\" value=\"'.$data['id'].'\" />\n\t\t\t\t<input type=\"hidden\" name=\"original_username\" value=\"'.$data['user_name'].'\" />';\n\t\t\t}\n\t\t//define form HTML display for new items.\n\t\t$form_display = '\t\t\n\t\t<h3>New user</h3>\n\t\t<div class=\"form\">\n\t\t\t\t'.$error_message.'\n\t\t\t\t<form id=\"userform\" method=\"post\" action=\"user.php?do='.$u_action.'\">\n\t\t\t\t<div id=\"columnright\">\n\t\t\t\t<h3>Rank</h3>\n\t\t\t\t<select name=\"rank\" id=\"rank\" class=\"highlight\">\n\t\t\t\t\t'.fetch_ranks().'\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t\t\t\t<label for=\"username_\">Username</label><input type=\"text\" id=\"username_\" class=\"highlight\" name=\"username_\" value=\"'.$data['user_name'].'\" /><br />\n\t\t\t\t\t<label for=\"fullname\">Full name</label><input type=\"text\" id=\"fullname\" class=\"highlight\" name=\"fullname\" value=\"'.$data['full_name'].'\" /><br />\n\t\t\t\t\t<label for=\"password_\">Password</label><input type=\"password\" id=\"password_\" class=\"highlight\" name=\"password_\" /><br />(Leave blank if you don\\'t want to change the password)<br />\n\t\t\t\t\t<label for=\"cpassword_\">Confirm Pass</label><input type=\"password\" id=\"cpassword_\" class=\"highlight\" name=\"cpassword_\" /><br />(Leave blank if you don\\'t want to change the password)<br />\n\t\t\t\t\t<label for=\"email\">Email*</label><input type=\"text\" id=\"email\" name=\"email\" value=\"'.$data['email'].'\" /><br />\n\t\t\t\t\n\t\t\t\t\t<label for=\"msn\">MSN*</label><input type=\"text\" id=\"msn\" name=\"msn\" value=\"'.$data['msn'].'\" /><br />\n\t\t\t\t\t<label for=\"aim\">AIM*</label><input type=\"text\" id=\"aim\" name=\"aim\" value=\"'.$data['aim'].'\" /><br />\n\t\t\t\t\t<label for=\"yahoo\">Yahoo*</label><input type=\"text\" id=\"yahoo\" name=\"yahoo\" value=\"'.$data['yahoo'].'\" /><br />\n\t\t\t\t\t<label for=\"skype\">Skype*</label><input type=\"text\" id=\"skype\" name=\"skype\" value=\"'.$data['skype'].'\" /><br />\n\t\t\t\t\t'.$u_hiddenid.'\n\t\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Save user\" />\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>';\n\t\t\n\t\treturn $form_display;\n\t}\n\t\n\tfunction new_user($data) {\n\t\tglobal $globalvars;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\t$data['user_ip'] = $_SERVER['REMOTE_ADDR']; //ip\n\t\t//form SQL query\n\t\t  $new_res = general_query('INSERT INTO '.$databaseinfo['prefix'].'users\n                    (user_name,\n                    full_name,\n                    email,\n                    password,\n                    timestamp,\n                    ip,\n                    msn,\n                    aim,\n                    yahoo,\n                    skype,\n                    display_picture,\n                    rank_id)\n              VALUES (\"'.$data['username_'].'\",\n                      \"'.$data['fullname'].'\",\n                      \"'.$data['email'].'\",\n                      \"'.$data['password_'].'\",\n                      \"'.$globalvars['time'].'\",\n                      \"'.$data['user_ip'].'\",\n                      \"'.$data['msn'].'\",\n                      \"'.$data['aim'].'\",\n                      \"'.$data['yahoo'].'\",\n                      \"'.$data['skype'].'\",\n                      \" \",\n                      \"'.$data['rank'].'\");');\n\t\t\n\t\t//log this action via log_this (will appear in system log)\n\t\tlog_this('new_user','User <i>'.$_SESSION['username'].'</i> has <strong>created</strong> a new user account named <i>'.$data['username_'].'</i> ('.$data['fullname'].') with the rank of '.$data['rank']);\n\t}\n\t\n\tfunction edit_user($data) {\n\t\tglobal $globalvars;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\t$data['user_ip'] = $_SERVER['REMOTE_ADDR']; //ip\n\n\t\tif ($data['password_'] != NULL) {\n\t\t\t$data['password_'] = sha1($data['password_']);\n\t\t\t$password_p = 'password=\"'.$data['password_'].'\",';\n\t\t}\n\t\t\n\t\t\n\t\t//form SQL query\n\t\t  $edit_res = general_query('UPDATE '.$databaseinfo['prefix'].'users SET\n                    user_name=\"'.$data['username_'].'\",\n                    full_name=\"'.$data['fullname'].'\",\n                    email=\"'.$data['email'].'\",\n                    '.$password_p.'\n                    ip=\"'.$data['user_ip'].'\",\n                    msn=\"'.$data['msn'].'\",\n                    aim=\"'.$data['aim'].'\",\n                    yahoo=\"'.$data['yahoo'].'\",\n                    skype=\"'.$data['skype'].'\",\n                    display_picture=\"\",\n                    rank_id=\"'.$data['rank'].'\"\n              WHERE id=\"'.$data['id'].'\"\n              ');\n\t\t\n\t\t//log this action via log_this (will appear in system log)\n\t\tlog_this('edit_user','User <i>'.$_SESSION['username'].'</i> has <strong>modified</strong> '.$data['username_']);\n\t}\n\t\n\tfunction gen_rank_name($rankid) {\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\t$rname = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"ranks WHERE id='$rankid' LIMIT 1\", TRUE);\n\t\t\treturn $rname['rank_title'];\n\t}\n\t\n\tfunction rank_form($data=NULL) { //form for new ranks and editing ranks, function so it can be reused with variables inside.\n\t\tglobal $do;\n\t\tglobal $databaseinfo; //for table prefix\n\t\tglobal $error_message;\n\t\tif ($do == 'newrank' || $do == 'nrankp') {\n\t\t\t$action = 'nrankp';\n\t\t} elseif ($do == 'editrank' || $do == 'erankp') {\n\t\t\t$action = 'erankp';\n\t\t\t$hidden = '<input type=\"hidden\" name=\"id\" value=\"'.$data['id'].'\" />';\n\t\t}\n\n\t\t\n\t\t//form\n\t\t$content = '\n\t\t'.$error_message.'\n\t\t<h3>Rank form</h3>\n\t\t<form action=\"user.php?do='.$action.'\" method=\"post\">\n\t\t\t<label for=\"rank_title\">Rank title</label><input type=\"text\" id=\"rank_title\" name=\"rank_title\" value=\"'.$data['rank_title'].'\" /><br />\n\t\t\t<label for=\"rank_desc\">Rank description</label><input type=\"text\" id=\"rank_desc\" name=\"rank_desc\" value=\"'.$data['rank_desc'].'\" /><br /><br />\n\t\t\t\n\t\t\t<div id=\"columnright\">\n\t\t\t\t<br />\n\t\t\t\t<label for=\"createranks\">Create ranks</label>\n\t\t\t\t<select name=\"createranks\">\n\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['createranks'].'\">'.$data['createranks'].'</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t</select>\n\t\t\t\t<br />\n\t\t\t\t\n\t\t\t\t<label for=\"manageranks\">Manage ranks</label>\n\t\t\t\t<select name=\"manageranks\">\n\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t<option selected=\"selected\" value=\"'.$data['manageranks'].'\">'.$data['manageranks'].'</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t</select>\n\t\t\t\t<br />\n\t\t\t\t\n\t\t\t\t<label for=\"loginrecords\">Login records</label>\n\t\t\t\t<select name=\"loginrecords\">\n\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['loginrecords'].'\">'.$data['loginrecords'].'</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t</select>\n\t\t\t\t<br />\n\t\t\t\t\n\t\t\t\t<label for=\"preferences\">Preferences</label>\n\t\t\t\t<select name=\"preferences\">\n\t\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['preferences'].'\">'.$data['preferences'].'</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t</select>\n\t\t\t\t<br />\n\t\t\t</div>\n\t\t\t<label for=\"loggingin\">Logging in</label>\n\t\t\t<select name=\"loggingin\">\n\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['loggingin'].'\">'.$data['loggingin'].'</option>\n\t\t\t\t</optgroup>\n\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"createarticles\">Create articles</label>\n\t\t\t<select name=\"createarticles\">\n\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['createarticles'].'\">'.$data['label'].'</option>\n\t\t\t\t</optgroup>\n\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t<option value=\"allowapp\">allow w/ approval</option>\n\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"approve\">approve articles</label>\n\t\t\t<select name=\"approve\">\n\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['approve'].'\">'.$data['approve'].'</option>\n\t\t\t\t</optgroup>\n\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"editarticles\">Edit articles</label>\n\t\t\t<select name=\"editarticles\">\n\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['editarticles'].'\">'.$data['editarticles'].'</option>\n\t\t\t\t</optgroup>\n\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"deletearticles\">delete articles</label>\n\t\t\t<select name=\"deletearticles\">\n\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['deletearticles'].'\">'.$data['deletearticles'].'</option>\n\t\t\t\t</optgroup>\n\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"createusers\">Create users</label>\n\t\t\t<select name=\"createusers\">\n\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['createusers'].'\">'.$data['createusers'].'</option>\n\t\t\t\t</optgroup>\n\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"editusers\">Edit users*</label>\n\t\t\t<select name=\"editusers\">\n\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['editusers'].'\">'.$data['editusers'].'</option>\n\t\t\t\t</optgroup>\n\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"deleteusers\">Delete users*</label>\n\t\t\t<select name=\"deleteusers\">\n\t\t\t\t<optgroup label=\"Selected:\">\n\t\t\t\t\t<option selected=\"selected\" value=\"'.$data['deleteusers'].'\">'.$data['deleteusers'].'</option>\n\t\t\t\t</optgroup>\n\t\t\t\t<optgroup label=\"Choose an order:\">\n\t\t\t\t<option value=\"allow\">allow</option>\n\t\t\t\t<option value=\"disallow\">disallow</option>\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t\t<br />\n\t\t\t'.$hidden.'\n\t\t\t<div class=\"alignr\">\n\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Save rank\" />\n\t\t\t</div>\n\t\t</form>\n\t\t\t';\n\t\treturn $content;\n\t}\n\t\n\tfunction new_rank($rank,$permissions_string,$author) {\n\t\t//creating a new rank\n\t\tglobal $globalvars;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\t$res = general_query(\"INSERT INTO \".$databaseinfo['prefix'].\"ranks\n\t\t(rank_title,\n\t\trank_desc,\n\t\trank_author,\n\t\tpermissions,\n\t\ttimestamp)\n\t\tVALUES (\n\t\t'\".$rank['rank_title'].\"',\n\t\t'\".$rank['rank_desc'].\"',\n\t\t'\".$author.\"',\n\t\t'\".$permissions_string.\"',\n\t\t'\".time().\"')\");\n\t\t\n\t\t$success = mysql_affected_rows();  //count affected rows\n\t\t\n\t\treturn $success;\n\t\t\n\t\t//log this action via log_this (will appear in system log)\n\t\tlog_this('new_rank','User <i>'.$_SESSION['username'].'</i> has <strong>created</strong> a new rank named '.$rank['rank_title'].'. Rank description \"'.$rank['rank_desc'].'\". Permissions: '.$permissions_string);\n\t}\n\t\n\tfunction edit_rank($rank,$permissions_string,$id) {\n\t\t//edit rank sql\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\t$res = general_query(\"UPDATE \".$databaseinfo['prefix'].\"ranks SET\n\t\trank_title='\".$rank['rank_title'].\"',\n\t\trank_desc='\".$rank['rank_desc'].\"',\n\t\tpermissions='\".$permissions_string.\"'\n\t\tWHERE id='\".$id.\"'\n\t\t\");\n\t\t$success = mysql_affected_rows();  //count affected rows\n\t\t\n\t\treturn $success;\n\t\t\n\t\t//log this action via log_this (will appear in system log)\n\t\tlog_this('edit_rank','User <i>'.$_SESSION['username'].'</i> has <strong>modified</strong> rank named '.$rank['rank_title'].'. Rank description \"'.$rank['rank_desc'].'\". Permissions: '.$permissions_string);\n\t}\n\t\n\tfunction loginrec_form() {\n\t\tglobal $table_rows;\n\t\tglobal $prev_page;\n\t\tglobal $next_page;\n\t\tglobal $globalvars;\n\t\tglobal $search;\n\t\tglobal $do;\n\t\tglobal $error_message;\n\t\tglobal $sort;\n\t\tglobal $search;\n\t\t\n\t\t$form = '\n\t\t'.$error_message.'\n\t\t<h3>Options</h3>\n\t\t<ul>\n\t\t\t<li><a href=\"?do=loginrec&amp;action=delall\" onClick=\"return confirm(\\'Are you sure you want to delete the selected items?\\');\">delete all login records</a></li>\n\t\t</ul>\n\t\t<h3>Login records list</h3>\n\t\t<form action=\"manage.php?do=deleteitems\" method=\"post\" onsubmit=\"return confirm(\\'Are you sure you want to delete the selected items?\\');\">\n\t\t\t<table style=\"text-align: left; width: 100%;\" border=\"1\"\n\t\t\t cellpadding=\"3\" cellspacing=\"2\">\n\t\t\t  <tbody>\n\t\t\t    <tr class=\"toprow\">\n\t\t\t      <td style=\"width: 200px; text-align: left;\"><strong>Username</strong></td>\n\t\t\t      <td><strong>Rank</strong></td>\n\t\t\t      <td><strong>Date</strong></td>\n\t\t\t      <td><strong>IP Address</strong></td>\n\t\t\t      <td style=\"width: 10px; text-align: center;\"><strong><input type=\"checkbox\" onClick=\"Checkall(this.form);\" /></strong></td>\n\t\t\t    </tr>\n\t\t\t    '.$table_rows.'\n\t\t\t  </tbody>\n\t\t\t</table>\n\t\t\t<div style=\"text-align: right; width: 400px; float: right;\"><input type=\"submit\" id=\"submit\" value=\"Delete Selected\" /></div>\n\t\t</form>\n\t\t<div><button class=\"previous\" OnClick=\"window.location = \\'?do=loginrec&amp;page='.$prev_page.''.$s_js.'\\';\">Previous ('.$prev_page.')</button> <button class=\"next\" OnClick=\"window.location = \\'?do=loginrec&amp;page='.$next_page.''.$s_js.'\\';\">Next ('.$next_page.')</button></div>\n\t\t';\n\t\t\n\t\treturn $form;\n\t}\n\t\n\n\n\t\n/*\nPREFERENCES FUNCTIONS\nThe following functions are used on the preferences.php file.\n##############################################\n##############################################\n*/\n\n\tfunction new_category($data,$author) {\n\t\t\t//if all is well...\n\t\t\t\tglobal $globalvars;\n\t\t\t\tglobal $databaseinfo; //for table prefix\n\t\t\t\t\n\t\t\t\t$ip = $_SERVER['REMOTE_ADDR'];\n\t\t\t\t$cat_res = general_query(\"INSERT INTO \".$databaseinfo['prefix'].\"categories (cat_name,cat_parent,cat_author,cat_desc,timestamp,ip) VALUES\n\t\t\t\t('\".$data['name'].\"',\n\t\t\t\t'\".$data['parent'].\"',\n\t\t\t\t'\".$author.\"',\n\t\t\t\t'\".$data['description'].\"',\n\t\t\t\t'\".$globalvars['time'].\"',\n\t\t\t\t'\".$ip.\"')\");\n\t\t\t\t\n\t\t\t\t//log this action via log_this (will appear in system log)\n\t\t\t\tlog_this('new_category','User <i>'.$_SESSION['username'].'</i> has <strong>created</strong> a new category named '.$data['name'].'. Category description \"'.$data['description']);\n\t}\n\t\n\tfunction template_form($data=NULL) {\n\t\tglobal $error_message;\n\t\tglobal $databaseinfo; //for table prefix\n\t\tglobal $action;\n\t\t\n\t\tif ($action == 'edit' || $action == 'editp') {\n\t\t\t$action = 'editp';\n\t\t\t$hiddenid = '<input type=\"hidden\" name=\"id\" value=\"'.$data['id'].'\" />';\n\t\t} else {\n\t\t\t$action = 'newp';\n\t\t}\n\t\t\t//clean data, html entities\n\t\t\t\n\t\n\t\t//form the... well... form. :)\n\t\t$new_form = '\n\t\t\t'.$error_message.'\n\t\t\t<h3>Template form</h3>\n\t\t\t<div class=\"form\">\n\t\t\t\t<form action=\"preferences.php?do=templates&amp;action='.$action.'\" method=\"post\" id=\"template\">\n\t\t\t\t\t<label for=\"template_name\">Template name</label><input type=\"text\" id=\"template_name\" name=\"template_name\" value=\"'.$data['template_name'].'\" /><br />\n\t\t\t\t\t<label for=\"template_desc\">Temp. Description</label><input type=\"text\" id=\"template_desc\" name=\"template_desc\" value=\"'.$data['template_desc'].'\" /><br /><br />\n\t\t\t\t\t<label class=\"for_textarea\" for=\"html_article\">Main article <a href=\"javascript:togglewysiwyg(\\'html_article\\');\">wysiwyg on/off</a> <a href=\"javascript:expandwysiwyg(\\'html_article\\');\">expand editor</a></label><textarea name=\"html_article\" class=\"code\" id=\"html_article\" onkeypress=\"checkTab(event);\">'.$data['html_article'].'</textarea><br />\n\t\t\t\t\t<label class=\"for_textarea_alt\" for=\"html_comment\">Comment(s) <a href=\"javascript:togglewysiwyg(\\'html_comment\\');\">wysiwyg on/off</a> <a href=\"javascript:expandwysiwyg(\\'html_comment\\');\">expand editor</a></label><textarea name=\"html_comment\" class=\"code\" id=\"html_comment\" onkeypress=\"checkTab(event);\">'.$data['html_comment'].'</textarea><br />\n\t\t\t\t\t<label class=\"for_textarea_alt\" for=\"html_form\">Comment Form <a href=\"javascript:togglewysiwyg(\\'html_form\\');\">wysiwyg on/off</a> <a href=\"javascript:expandwysiwyg(\\'html_form\\');\">expand editor</a></label><textarea class=\"code\" name=\"html_form\" id=\"html_form\" onkeypress=\"checkTab(event);\">'.$data['html_form'].'</textarea><br />\n\t\t\t\t\t<label class=\"for_textarea_alt\" for=\"html_pagination\">Article pagination <a href=\"javascript:togglewysiwyg(\\'html_pagination\\');\">wysiwyg on/off</a> <a href=\"javascript:expandwysiwyg(\\'html_pagination\\');\">expand editor</a></label><textarea class=\"code\" name=\"html_pagination\" id=\"html_pagination\" onkeypress=\"checkTab(event);\">'.$data['html_pagination'].'</textarea><br />\n\t\t\t\t\t'.$hiddenid.'\n\t\t\t\t\t* You can leave these fields empty, just for freedom\\'s sake. We don\\'t recommend it though.\n\t\t\t\t\t<div class=\"alignr\"><input type=\"submit\" name=\"submit\" id=\"submit\" value=\"Save template\" /></div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t\t';\n\t\treturn $new_form;\n\t}\n\t\n\tfunction new_template($data,$author) {\n\t\t//creating a new template\n\t\tglobal $globalvars;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\t$data = clean_data($data);\n\t\t\n\t\t$sql = general_query(\"INSERT INTO \".$databaseinfo['prefix'].\"templates \n\t\t(template_name,\n\t\ttemplate_desc,\n\t\ttemplate_author,\n\t\ttimestamp,\n\t\thtml_article,\n\t\thtml_comment,\n\t\thtml_form,\n\t\thtml_pagination)\n\t\tVALUES (\n\t\t'\".$data['template_name'].\"',\n\t\t'\".$data['template_desc'].\"',\n\t\t'\".$author.\"',\n\t\t'\".$globalvars['time'].\"',\n\t\t'\".$data['html_article'].\"',\n\t\t'\".$data['html_comment'].\"',\n\t\t'\".$data['html_form'].\"',\n\t\t'\".$data['html_pagination'].\"')\");\n\t\t\n\t\t$success = mysql_affected_rows();  //count affected rows\n\t\t\n\t\treturn $success;\n\t\t\n\t\t//log this action via log_this (will appear in system log)\n\t\tlog_this('new_template','User <i>'.$_SESSION['username'].'</i> has <strong>created</strong> a new template named '.$data['template_name'].'. Template description \"'.$data['template_desc']);\n\t}\n\t\n\tfunction edit_template($data,$author) {\n\t\t//creating a new template\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\t$data = clean_data($data);\n\t\t\n\t\t$sql = general_query(\"UPDATE \".$databaseinfo['prefix'].\"templates SET\n\t\ttemplate_name='\".$data['template_name'].\"',\n\t\ttemplate_desc='\".$data['template_desc'].\"',\n\t\thtml_article='\".$data['html_article'].\"',\n\t\thtml_comment='\".$data['html_comment'].\"',\n\t\thtml_form='\".$data['html_form'].\"',\n\t\thtml_pagination='\".$data['html_pagination'].\"'\n\t\tWHERE\n\t\tid='\".$data['id'].\"'\");\n\t\t\n\t\t$success = mysql_affected_rows();  //count affected rows\n\t\t\n\t\treturn $success;\n\t\t\n\t\t//log this action via log_this (will appear in system log)\n\t\tlog_this('edit_template','User <i>'.$_SESSION['username'].'</i> has <strong>modified</strong> template named '.$data['template_name'].'. Template description \"'.$data['template_desc']);\n\t}\n\t\n\tfunction switch_template($id) {\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\t$st_res = general_query(\"UPDATE \".$databaseinfo['prefix'].\"templates SET template_selected=''\");\n\t\t\tif ($st_res) {\n\t\t\t\t$st_res = general_query(\"UPDATE \".$databaseinfo['prefix'].\"templates SET template_selected='1' WHERE id=\".$id.\"\");\n\t\t\t\treturn TRUE;\n\t\t\t\tlog_this('template_switch','User <i>'.$_SESSION['username'].'</i> has <strong>switched the default template</strong> to ID: '.$id.'');\n\t\t\t}\n\t}\n\t\n\tfunction ban($data,$by) {\n\t\t//creating a new template\n\t\tglobal $globalvars;\n\t\tglobal $databaseinfo; //for table prefix\n\t\t\n\t\t$data = clean_data($data);\n\t\t\n\t\t$sql = general_query(\"INSERT INTO \".$databaseinfo['prefix'].\"banlist\n\t\t(ip,\n\t\tbanned_by,\n\t\treason,\n\t\ttimestamp)\n\t\tVALUES (\n\t\t'\".$data['ip'].\"',\n\t\t'\".$by.\"',\n\t\t'\".$data['reason'].\"',\n\t\t'\".$globalvars['time'].\"')\");\n\t\t\n\t\t$success = mysql_affected_rows();  //count affected rows\n\t\t\n\t\treturn $success;\n\t\t\n\t\t//log this action via log_this (will appear in system log)\n\t\tlog_this('edit_template','User <i>'.$_SESSION['username'].'</i> has <strong>banned</strong> user at the IP of: '.$data['ip'].'. Reason:  \"'.$data['reason']);\n\t}\n\n\n/*\nABOUT PAGE FUNCTIONS\nThe following functions are used on the about.php file. Version checking, rss...\n##############################################\n##############################################\n*/\n\tfunction version_check($input) {  //version checking off phpns site\n\t\tglobal $globalvars;\n\t\t$version_info = 'Version installed: <strong>'.$globalvars['version'].'</strong><br />Latest version: <script type=\"text/javascript\" src=\"http://phpns.com/version.php?v='.$globalvars['version'].'\"></script><br /><br />';\n\t\treturn $version_info;\n\t}\n\n\tfunction phpns_rss() {  //rss grabbing from phpns.com\n\t\t@set_time_limit(5);\n\t\t//variable for rss url, feel free to change it to any RSS page...\n\t\t$rss_url = \"http://phpns.com/rss.php\";\n\t\tif ($rss_load = $rss_load = @file_get_contents($rss_url)) { //load raw. \t\n\t\t\t@$rss_xml = new SimpleXmlElement($rss_load);\n\t\t\t$start = 0;\n\t\t\t$list = \"<ul>\n\t\t\t\";\n\t\t\t\t\n\t\t\tforeach ($rss_xml->channel->item as $item) {\n\t\t\t\t\t$title = substr($item->title,0,30); \n\t\t\t\t\t\n\t\t\t\t\tif ($start < 5) {\n\t\t\t\t\t\t$list = $list.\n\t\t\t\t\t\t'<li><a href=\"'.$item->link.'\">'.$title.'</a></li>';\n\t\t\t\t\t}\n\t\t\t\t\t++$start;\n\t\t\t}\n\t\t\t\n\t\t\t$list = $list.'\n\t\t\t</ul>';\n\t\t\treturn $list;\n\t\t} else {\n\t\t\treturn \"We can't connect to the phpns server to fetch latest announcements.\";\n\t\t}\n\t}\n\t\n\n/*\nMISC FUNCTIONS\nRandom functions that might aid for development/debugging\n##############################################\n##############################################\n*/\n\tfunction array_dump($array) {\n\t\t$dump = \"<div style=\\\"background: #eee; border: 1px dashed #333\\\">\";\n\t\tforeach ($array as $key=>$value) {\n\t\t\t$dump = $dump.\"$key: $value<br />\";\n\t\t}\n\t\t$dump = $dump.\"</div>\";\n\t\treturn $dump;\n\t}\n\t\t\n?>\n"}]}
{"id": 17, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\global_files.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n\n//for theming issues, we need to declare every page in the phpns system which will actually be viewed, and themed visually by/for the user.\n$rep_patt[0] = \"/index.php/\";\n$rep_patt[1] = \"/login.php/\";\n$rep_patt[2] = \"/themes.php/\";\n$rep_patt[3] = \"/article.php/\";\n$rep_patt[4] = \"/manage.php/\";\n$rep_patt[5] = \"/about.php/\";\n$rep_patt[6] = \"/user.php/\";\n$rep_patt[7] = \"/preferences.php/\";\n$rep_patt[8] = \"/help.php/\";\n\n?>\n"}]}
{"id": 18, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\header.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n//error_reporting( E_ALL | E_STRICT ); //DEBUGGING, uncommment to activate\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n$globalvars['version'] = \"2.1.1alpha2\";  // define phpns version. :)\n\n\t//we're going to set some quick vars, although important.\n\t$globalvars['full_page'] = $_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING']; //define full path + GET\n\t$globalvars['path_to'] = dirname($_SERVER['PHP_SELF']);\n\t$globalvars['path_to_uri'] = $_SERVER['SERVER_NAME'].$globalvars['path_to'];\n\nsession_start(); //start session management\n\ninclude(\"inc/config.php\");   // include database information\n\n\t//redirect to install dir if not installed\n\tif ($globalvars['installed'] == \"no\") {\n\t\theader(\"Location: install/index.php\");\n\t}\n\n\t//connect to mysql database for all files\n\t$mysql['connection'] = @mysql_connect($databaseinfo['host'], $databaseinfo['user'], $databaseinfo['password'])\n\tor die ($error['connection']);\n\n\t//select mysql database\n\t$mysql['db'] = @mysql_select_db($databaseinfo['dbname'],$mysql['connection'])\n\tor die ($error['database']);\n\ninclude(\"inc/errors.php\");   // include error profiles\ninclude(\"inc/function.php\"); // include function header\n\nif (!$globalvars['pagetype']) {\n\t$globalvars['pagetype'] = \"admin\"; //set admin pagetype if no pagetype detected. :)\n}\n\nif ($globalvars['pagetype'] == \"admin\" || $globalvars['pagetype'] == \"about\") {\n\tinclude(\"inc/auth.php\"); //include auth info if pagetype is admin (not login page)\n}\n\nif (!$globalvars['page_name']) { //display error if there is no content.\n\t\t\t$globalvars['page_name'] = 'error';\n\t\t\t$page_desc['error'] = \"You have reached this page in error! Phpns couldn't find any page with the information supplied. If you think this is a bug in the phpns software, we would appreciate you filing the bug at <a href=\\\"http://launchpad.net/phpns\\\">the phpns launchpad website</a>!\n\t\t\t<div class=\\\"warning\\\">\n\t\t\t\t<strong>Before reporting this bug, keep in mind, this is alpha software, and some preference pages may not work yet. If this is the case, we already know, and there is no need to report the bug.</strong>\n\t\t\t</div>\";\n\t\t}\n\n\n\t\t$sys_time_format = load_config('sys_time_format');\n//define ip address and other vars\n$globalvars['ip'] = $_SERVER['REMOTE_ADDR'];\n$globalvars['time'] = time();\n$globalvars['time_format'] = $sys_time_format['v1'];\n\ninclude(\"inc/head_data.php\"); //include head_data\ninclude(\"inc/global_files.php\");  //global files array\n?>\n"}]}
{"id": 19, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\head_data.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n//This is the 'default' javascript that should be included with every theme/page\n\n$head_data['wysiwyg'] = '\n<link rel=\"alternate\" type=\"application/rss+xml\" title=\"phpns rss feed\" href=\"etc.php?do=rss\"/>\n<script language=\"javascript\" type=\"text/javascript\" src=\"inc/wysiwyg/tiny_mce_gzip.js\"></script>\n<script language=\"javascript\" type=\"text/javascript\">\n\ttinyMCE_GZ.init({\n\t\ttheme : \"advanced\",\n\t\tmode : \"exact\",\n\t\telements : \"main, full\",\n\t\tapply_source_formatting : true,\n\t\tcontent_css : \"example_advanced.css\",\n\t\textended_valid_elements : \"a[href|target|name]\",\n\t\tplugins : \"table\",\n\t\ttheme_advanced_toolbar_location : \"top\",\n\t\ttheme_advanced_buttons1 : \"forecolor,backcolor,separator,bold,italic,underline,separator,link,unlink,separator,bullist,numlist,separator,indent,outdent,separator,justifyleft,justifycenter,justifyright,separator,hr,separator,tablecontrols,separator,charmap,formatselect\",\n\t\ttheme_advanced_buttons2 : \"\",\n\t\ttheme_advanced_buttons3 : \"\",\n\t\t//theme_advanced_buttons2_add : \"forecolor,backcolor,seperator\",\n\t\t//theme_advanced_buttons3_add_before : \"tablecontrols,separator\",\n\t\t//invalid_elements : \"a\",\n\t\t theme_advanced_path_location : \"bottom\",\n    theme_advanced_resizing : true,\n    theme_advanced_resize_horizontal : false,\n\t\ttheme_advanced_styles : \"Header 1=header1;Header 2=header2;Header 3=header3;Table Row=tableRow1\", // Theme specific setting CSS classes\n\t\t//execcommand_callback : \"myCustomExecCommandHandler\",\n\t\tfix_list_elements : true,\n\t\tdebug : false\n\t});\n</script>\n<script language=\"javascript\" type=\"text/javascript\">\n\ttinyMCE.init({\n\t\ttheme : \"advanced\",\n\t\tmode : \"exact\",\n\t\telements : \"main\",\n\t\tapply_source_formatting : true,\n\t\tcontent_css : \"example_advanced.css\",\n\t\textended_valid_elements : \"a[href|target|name]\",\n\t\tplugins : \"table\",\n\t\ttheme_advanced_toolbar_location : \"top\",\n\t\ttheme_advanced_buttons1 : \"forecolor,backcolor,separator,bold,italic,underline,separator,link,unlink,separator,bullist,numlist,separator,indent,outdent,separator,justifyleft,justifycenter,justifyright,separator,hr,separator,tablecontrols,separator,charmap,formatselect\",\n\t\ttheme_advanced_buttons2 : \"\",\n\t\ttheme_advanced_buttons3 : \"\",\n\t\t//theme_advanced_buttons1_add_before : \"forecolor,backcolor,separator\",\n\t\t//theme_advanced_buttons3_add_before : \"tablecontrols,separator\",\n\t\t//invalid_elements : \"a\",\n\t\t theme_advanced_path_location : \"bottom\",\n\t\t fix_list_elements : true,\n    theme_advanced_resizing : true,\n    theme_advanced_resize_horizontal : false,\n\t\t//execcommand_callback : \"myCustomExecCommandHandler\",\n\t\tdebug : false\n\t});\n</script>\n';\n\n$head_data['other_js'] = '\n<script language=\"javascript\" type=\"text/javascript\">\n\tfunction togglewysiwyg(id) {\n\t\tvar elm = document.getElementById(id);\n\t\tif (tinyMCE.getInstanceById(id) == null)\n\t\t\ttinyMCE.execCommand(\\'mceAddControl\\', false, id);\n\t\telse\n\t\t\ttinyMCE.execCommand(\\'mceRemoveControl\\', false, id);\n\t}\n\t\t\n\tfunction expandwysiwyg(id) {\n\t\tvar expelm = document.getElementById(id);\n\t\tvar expstyle = expelm.style.height;\n\t\tdocument.getElementById(id).style.height = \"500px\";\n\t\ttogglewysiwyg(id);\n\t\ttogglewysiwyg(id);\n\t}\n\t\t\n\tfunction validate_required(field,alerttxt) {\n\t\twith (field) {\n\t\t\tif (value==null||value==\"\") {\n\t\t\t\talert(alerttxt);\n\t\t\t\treturn false\n\t\t\t} else {\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction validate_form(thisform) {\n\t\twith (thisform) {\n\t\t\tif (validate_required(title,\"You must enter a title to continue.\")==false) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction Checkall(form) { \n\t\tfor (var i = 1; i < form.elements.length; i++) {    \n\t\t\teval(\"form.elements[\" + i + \"].checked = form.elements[0].checked\");  \n\t\t} \n\t}\n\n\tfunction new_window(url) {\n\t\tvar newwindow;\n\t\tnewwindow=window.open(url,\\'name\\',\\'height=500,width=400,left=100,top=100,resizable=yes,scrollbars=yes,status=yes\\');\n\t\tif (window.focus) {\n\t\t\tnewwindow.focus()\n\t\t}\n\t}\n\t\n\tfunction expand() {\n\tfor (var i=0; i<expand.arguments.length; i++) {\n\t\tvar element = document.getElementById(expand.arguments[i]);\n\t\telement.style.display = (element.style.display == \"none\") ? \"block\" : \"none\";\n\n\t}\n}\n\n // Set desired tab- defaults to four space softtab\n        var tab = \"    \";\n        \n        function checkTab(evt) {\n            var t = evt.target;\n            var ss = t.selectionStart;\n            var se = t.selectionEnd;\n\n            // Tab key - insert tab expansion\n            if (evt.keyCode == 9) {\n                evt.preventDefault();\n                \n                // Special case of multi line selection\n                if (ss != se && t.value.slice(ss,se).indexOf(\"\\n\") != -1) {\n                    // In case selection was not of entire lines (e.g. selection begins in the middle of a line)\n                    // we ought to tab at the beginning as well as at the start of every following line.\n                    var pre = t.value.slice(0,ss);\n                    var sel = t.value.slice(ss,se).replace(/\\n/g,\"\\n\"+tab);\n                    var post = t.value.slice(se,t.value.length);\n                    t.value = pre.concat(tab).concat(sel).concat(post);\n                    \n                    t.selectionStart = ss + tab.length;\n                    t.selectionEnd = se + tab.length;\n                }\n                \n                // \"Normal\" case (no selection or selection on one line only)\n                else {\n                    t.value = t.value.slice(0,ss).concat(tab).concat(t.value.slice(ss,t.value.length));\n                    if (ss == se) {\n                        t.selectionStart = t.selectionEnd = ss + tab.length;\n                    }\n                    else {\n                        t.selectionStart = ss + tab.length;\n                        t.selectionEnd = se + tab.length;\n                    }\n                }\n            }\n            \n            // Backspace key - delete preceding tab expansion, if exists\n            else if (evt.keyCode==8 && t.value.slice(ss - 4,ss) == tab) {\n                evt.preventDefault();\n                \n                t.value = t.value.slice(0,ss - 4).concat(t.value.slice(ss,t.value.length));\n                t.selectionStart = t.selectionEnd = ss - tab.length;\n            }\n            \n            // Delete key - delete following tab expansion, if exists\n            else if (evt.keyCode==46 && t.value.slice(se,se + 4) == tab) {\n                evt.preventDefault();\n                \n                t.value = t.value.slice(0,ss).concat(t.value.slice(ss + 4,t.value.length));\n                t.selectionStart = t.selectionEnd = ss;\n            }\n            \n            // Left/right arrow keys - move across the tab in one go\n            else if (evt.keyCode == 37 && t.value.slice(ss - 4,ss) == tab) {\n                evt.preventDefault();\n                t.selectionStart = t.selectionEnd = ss - 4;\n            }\n            else if (evt.keyCode == 39 && t.value.slice(ss,ss + 4) == tab) {\n                evt.preventDefault();\n                t.selectionStart = t.selectionEnd = ss + 4;\n            }\n            \n        }\n</script>\n<script language=\"javascript\" type=\"text/javascript\" src=\"inc/js/highlight.js\"></script>\n';\n\n//end head declarations\n?>\n"}]}
{"id": 20, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\page_desc.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n$page_desc['permission denied'] = \"You do not have access to that feature/page of phpns. The rank you are assigned to specifically states that you don't have permission to continue.\";\n\n$page_desc['index'] = \"Welcome to the phpns admin area, <strong>\".$_SESSION['username'].\"</strong>. To start, you may want to post a <a href=\\\"article.php\\\">new article</a>, or choose a different task on the navigation. Below, you'll find a list of your recent articles, and some statistics.\";\n\n// $page_desc['new article'] = \"Title, Category, and the Main article are the only required fields. If you would like to edit/delete an article, you'll need to head over to the <a href=\\\"manage.php\\\">news management</a> section.\";\n\n// $page_desc['preview article'] = \"Title, Category, and the Main article are the only required fields. If you would like to edit/delete an article, you'll need to head over to the <a href=\\\"manage.php\\\">news management</a> section.\";\n\n$page_desc['article success'] = \"Congratulations, the article has been successfully created. You can <a href=\\\"article.php\\\">create another</a> or edit/delete the article at the <a href=\\\"manage.php\\\">news management</a> page.\";\n\n$page_desc['article management'] = \"Using article management, you can edit/delete/categorize/archive different news articles. If you would like to customize the way your articles are displayed, head over to the <a href=\\\"preferences.php\\\">preferences section</a>, or you can modify <a href=\\\"preferences.php?do=categories\\\">article categories</a>.\";\n\n// $page_desc['edit article'] = \"You are editing an article that has been previously posted by you or another user. You can delete comments by clicking the appropriate button below. Do you want to return to <a href=\\\"manage.php\\\">article management</a>?\";\n\n$page_desc['edit success'] = 'The item has been successfully edited. You can return to the <a href=\"manage.php\">news management</a> page, or go to the <a href=\"index.php\">index</a>.';\n\n$page_desc['user success'] = 'The user has been successfully created. Return to the <a href=\"user.php\">user management</a> page, or go to the <a href=\"index.php\">index</a>.';\n\n$page_desc['edit user'] = 'You are editing a user that has been previously created by you or another user. Depending on your rank permissions, you might need to to wait for approval from an administrator. Return to <a href=\"user.php\">user management</a>?';\n\n$page_desc['login records'] = 'You are viewing login records stored by the phpns system. Only successful logins are recorded, so failed login attempts are not shown. Return to <a href=\"user.php\">user management</a>?';\n\n$page_desc['search'] = 'To search for an article, enter your query below. You can narrow your search based on keyword and category.';\n\n$page_desc['user management'] = \"User management lets you create, delete, and edit current users and their settings. You can also modify the ranking system for the system.\";\n\n$page_desc['new user'] = \"Using this tool, you can create a new user which will have access to the phpns administration panel. Fill out the form below.\";\n\n$page_desc['rank management'] = \"With rank management, you can assign users to specific 'ranks', which limit what the user can do with the system. Simply create your rank, then create/edit a user with the rank reflected at the user options.\";\n\n$page_desc['new rank'] = \"To create a new rank, please customize what the members will be allowed to do below. Both the rank title and description are required to continue. Make sure to go over this after you are done, although you can change it later.\";\n\n$page_desc['edit rank'] = \"You are editing a rank that is active on your system. Changes will take effect only when the user relogs in.\";\n\n$page_desc['rank success'] = \"The rank has been successfully created. You can <a href=\\\"user.php?do=ranks\\\">return to rank management</a>, or <a href=\\\"user.php?do=newrank\\\">create another rank</a>.\";\n\n$page_desc['preferences'] = \"Using this tool, you can modify different aspects of the phpns system. You can edit templates, themes, banning options, RSS, and much more.\";\n\n$page_desc['display options'] = \"Display options lets you define default attributes that your articles will include automatically. Remember, these are just default values. They can be overwritten individually through includes.\";\n\n$page_desc['comment options'] = \"Comment options allow you to change default settings for users' comments on your news system. Unlike <a href=\\\"preferences.php?do=display\\\">display options</a>, these settings are not overrideable.\";\n\n$page_desc['rss options'] = \"Rss options allow you to change default settings for how your rss page looks, and how it operates.\";\n\n$page_desc['templates'] = \"Templates are used to customize <em>how</em> the system displays each news item. You can have multiple templates available, but only one can remain the default. The default template is overrideable before an include.\";\n\n$page_desc['template success'] = \"The template has been successfully created. You can <a href=\\\"preferences.php?do=templates\\\">return to template management</a>, or <a href=\\\"preferences.php?do=templates&action=new\\\">create another</a>.\";\n\n$page_desc['search engine friendly urls'] = \"Phpns supports 'Search Engine Friendly URLs', which can be activated to make your URLs look cleaner to you, your visitors, and search engines that might explore your website. You can activate SEF URLs by putting the variable\".' $mod_rewrite = TRUE'.\".\";\n\n$page_desc['ban options'] = \"You can easily ban (or disallow) a user from viewing the content in your installation. If you ban a user below (using their IP address), they will not be able to see any articles on the system.\";\n\n$page_desc['integration wizard'] = \"The integration wizard is a customization walkthrough that will let generate a configured 'code' that you can use for your website.\";\n\n$page_desc['system log'] = \"The system log records every action taken by any user of the system. You can choose to deactivate the logging feature, but individual logs cannot be deleted.\";\n\n$page_desc['system timestamp format'] = \"The system timestamp option will allow you to display 'how' the timestamp is dispayed in human-readable format.\";\n\n$page_desc['online/offline options'] = \"This feature will let you restrict <strong>all</strong> users from accessing the articles on your website. If you want to prevent a single (or group of) user(s) from accessing your website, head over to the <a href=\\\"preferences.php?do=ban\\\">ban options</a>.\";\n\n$page_desc['wysiwyg editor'] = \"A WYSIWYG (what you see is what you get) editor is the editor used for entering data into <textarea>s throughout the system. You can choose between editors below, or just simply turn the feature off.\";\n\n$page_desc['database backup'] = \"Using database backup, you can easily and safely backup (and restore) your phpns articles. We recommend backing up your database at least once a month, in order to ensure the safety of your data.\";\n\n$page_desc['wysiwyg options'] = \"A WYSIWYG (What-You-See-Is-What-You-Get) editor is a feature which will enhance the textareas throughout the phpns system. Javascript is required for this feature to work.\";\n\n$page_desc['global message'] = \"The global message is a simple notice that will appear on every page of phpns. You can use this to inform users of an important announcement, update, or just to say hello.\";\n\n$page_desc['themes'] = \"Using the theme management tool, you can configure/administer the themes that are located in your /themes/ folder. You can have multiple themes installed, but only one may remain as the 'active' theme.\";\n\n$page_desc['categories'] = \"Categories act like 'folders' for your articles. They are used to organize your articles into groups which can be controlled as a whole. Sub-categories are allowed. \";\n\n$page_desc['about'] = \"Phpns has been in development since the summer of '06, and has become a scalable and powerful system since it's first concept.\";\n\n//end page descriptions. You can null out any description you don't want viewed by simply putting a '//' before the array key.\n?>\n"}]}
{"id": 21, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\themecontrol.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\ninclude(\"inc/page_desc.php\"); //include the page descriptions\n\t\t\n//connect to database.themes, and find selected theme\n\t$themeres = general_query(\"SELECT * FROM \".$databaseinfo['prefix'].\"themes WHERE theme_selected='1' LIMIT 1\");\n\t\n//Set variables for paths\n\t$admin = \"admin.tpl.php\";\n\t$login = \"login.tpl.php\";\n\t//help.php doesn't have a template.\n\t\n\t//read the theme data, and get the contents of the selected theme\n\twhile ($trow = mysql_fetch_assoc($themeres)) {\n\t\t//change file tread upon page type in global vars\n\t\tif ($globalvars['pagetype'] == \"admin\") {\n\t\t\t$file = file_get_contents($trow['theme_dir'].$admin);\n\t\t} elseif ($globalvars['pagetype'] == \"login\") {\n\t\t\t$file = file_get_contents($trow['theme_dir'].$login);\n\t\t}\n\t\t\n\t\t//modification of theme here (var replacement, img fix, ect ect)\n\t\t$uri = $_SERVER['PHP_SELF'];\n\t\t$rep_replace = 'themes/'.$trow['base_dir'].'/';\n\t\t$uri = preg_replace($rep_patt,$rep_replace,$uri);\n\t\t$file = str_replace('{prepath}','http://'.$_SERVER['SERVER_NAME'].$uri,$file);  //fix problem.\n\t\n\t\tif ($globalvars['pagetype'] == \"admin\") {  //if page is \"admin\" replace admin vars\n\t\t\t//admin configuration variables replaced with the system generated content\n\t\t\t$phpns_logo = '<a href=\"index.php\"><img src=\"images/logo.png\" alt=\"phpns logo\" border=\"0\" /></a>';\n\t\t\t$current_page_name = $globalvars['page_name'];\n\t\t\t\t\n\t\t\t//generate wysiwyg setting, and act accordingly (to disable/enable)\n\t\t\t$wysiwyg = load_config('wysiwyg');\n\t\t\t\n\t\t\t//if the wysiwyg editor is enabled...\n\t\t\tif ($wysiwyg['v1'] == 'yes') { $head_include .= $head_data['wysiwyg']; }\n\t\t\t\t//set the rest of the javascript, after wysiwyg\n\t\t\t\t$head_include .= $head_data['other_js'];\n\t\t\t\n\t\t\t//declare the variable for the current page image, 3 variations. automatic, custom, or none.\n\t\t\tif (empty($globalvars['page_image'])) { //automatic\n\t\t\t\t$page_image = '<img src=\"images/'. $globalvars['page_name'] . '.png\" alt=\"'. $globalvars['page_name'] .'\" alt=\"'.$globalvars['page_name'].' icon\" title=\"'.$globalvars['page_name'].' icon\" class=\"icon\" />';\n\t\t\t} elseif ($globalvars['page_image']) { //custom\n\t\t\t\t$page_image = '<img src=\"images/'. $globalvars['page_image'] . '.png\" alt=\"'. $globalvars['page_name'] .'\" title=\"'.$globalvars['page_name'].' icon\" class=\"icon\" />';\n\t\t\t} elseif ($globalvars['page_image'] == \"none\") {\n\t\t\t\t$page_image = '';\n\t\t\t}\n\t\t\t\n\t\t\t//now, we'll actually replace the variables in the theme\n\t\t\t$file = str_replace('{version}',$globalvars['version'],$file);\n\t\t\t$file = str_replace('{username}',$_SESSION['username'],$file);\n\t\t\t$file = str_replace('{head_data}',$head_include,$file);\n\t\t\t$file = str_replace('{page_image}',$page_image,$file);\n\t\t\t$file = str_replace('{content}',$content,$file);\n\t\t\t$file = str_replace('{page_desc}',$page_desc[$globalvars['page_name']],$file);\n\t\t\t$file = str_replace('{current_page_name}',$current_page_name,$file);\n\t\t\t\n\t\t\t//load the global message\n\t\t\t$global_message = load_config('global_message');\n\t\t\t\n\t\t\t//if the global message isn't null, we'll display it.\n\t\t\tif ($global_message['v3'] != NULL) {\n\t\t\t\t$important_notice .= '<div class=\"global_message\"><div class=\"global_message_link\"><a href=\"preferences.php?do=globalmessage\">[Change Message]</a></div>'.decode_data($global_message['v3']).'</div>';\n\t\t\t}\n\t\t\n\t\t\t//we're going to do a quick check to see if the 'install' directory is installed and\n\t\t\t//the SQL file from a previous backup is removed. We don't limit the user, but just nag them. =D\n\t\t\t//ADD TO GLOBAL MESSAGE\n\t\t\tif (file_exists('install')) {\n\t\t\t\t$important_notice .= '<div class=\"warning\"><strong>Important!</strong> The /install/ directory is still present. Please delete this as soon as possible to avoid potiental security issues.</div>';\n\t\t\t}\n\t\t\tif (file_exists($databaseinfo['dbname'].'.sql')) {\n\t\t\t\tif ($globalvars['page_name'] == \"index\") { @unlink($databaseinfo['dbname'].'.sql'); }\n\t\t\t\t$important_notice .= '<div class=\"warning\">Phpns tried to delete the database backup file you created (/'.$databaseinfo['dbname'].'.sql), but could not. Please delete it.</div>';\n\t\t\t}\n\t\t\t\n\t\t\t//finally, insert all our notices into global_message.\n\t\t\t$file = str_replace('{global_message}',$important_notice,$file); //replace login message\n\t\t\n\t\t} elseif ($globalvars['pagetype'] == \"login\") {\n\t\t\t\n\t\t\t//grab the global message\n\t\t\t$global_message = load_config('global_message');\n\t\t\t\n\t\t\t//replace the theme variables\n\t\t\t$file = str_replace('{content}',$error_message.$content,$file);\n\t\t\t$file = str_replace('{logo}',$error_message.'<a href=\"index.php\"><img src=\"images/logo.png\" id=\"logo\" class=\"logo\" /></a>',$file);\n\t\t\t$file = str_replace('{version}',$globalvars['version'],$file);\n\t\t\t$file = str_replace('{current_page_name}',$current_page_name,$file);\n\t\t\n\t\t} //end modification of theme\n\n\techo $file;  //output theme, decoded, and vars replaced. Basically the last step in the whole system.\n\t\n\t} //end while statement. we're done.\n\n?>\n"}]}
{"id": 22, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\inc\\wysiwyg\\tiny_mce_gzip.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n/**\n * $Id: tiny_mce_gzip.php 158 2006-12-21 14:32:19Z spocke $\n *\n * @author Moxiecode\n * @copyright Copyright \ufffd 2005-2006, Moxiecode Systems AB, All rights reserved.\n *\n * This file compresses the TinyMCE JavaScript using GZip and\n * enables the browser to do two requests instead of one for each .js file.\n * Notice: This script defaults the button_tile_map option to true for extra performance.\n */\n\n\t// Set the error reporting to minimal.\n\t@error_reporting(E_ERROR | E_WARNING | E_PARSE);\n\n\t// Get input\n\t$plugins = explode(',', getParam(\"plugins\", \"\"));\n\t$languages = explode(',', getParam(\"languages\", \"\"));\n\t$themes = explode(',', getParam(\"themes\", \"\"));\n\t$diskCache = getParam(\"diskcache\", \"\") == \"true\";\n\t$isJS = getParam(\"js\", \"\") == \"true\";\n\t$compress = getParam(\"compress\", \"true\") == \"true\";\n\t$suffix = getParam(\"suffix\", \"_src\") == \"_src\" ? \"_src\" : \"\";\n\t$cachePath = realpath(\".\"); // Cache path, this is where the .gz files will be stored\n\t$expiresOffset = 3600 * 24 * 10; // Cache for 10 days in browser cache\n\t$content = \"\";\n\t$encodings = array();\n\t$supportsGzip = false;\n\t$enc = \"\";\n\t$cacheKey = \"\";\n\n\t// Custom extra javascripts to pack\n\t$custom = array(/*\n\t\t\"some custom .js file\",\n\t\t\"some custom .js file\"\n\t*/);\n\n\t// Headers\n\theader(\"Content-type: text/javascript\");\n\theader(\"Vary: Accept-Encoding\");  // Handle proxies\n\theader(\"Expires: \" . gmdate(\"D, d M Y H:i:s\", time() + $expiresOffset) . \" GMT\");\n\n\t// Is called directly then auto init with default settings\n\tif (!$isJS) {\n\t\techo getFileContents(\"tiny_mce_gzip.js\");\n\t\techo \"tinyMCE_GZ.init({});\";\n\t\tdie();\n\t}\n\n\t// Setup cache info\n\tif ($diskCache) {\n\t\tif (!$cachePath)\n\t\t\tdie(\"alert('Real path failed.');\");\n\n\t\t$cacheKey = getParam(\"plugins\", \"\") . getParam(\"languages\", \"\") . getParam(\"themes\", \"\");\n\n\t\tforeach ($custom as $file)\n\t\t\t$cacheKey .= $file;\n\n\t\t$cacheKey = md5($cacheKey);\n\n\t\tif ($compress)\n\t\t\t$cacheFile = $cachePath . \"/tiny_mce_\" . $cacheKey . \".gz\";\n\t\telse\n\t\t\t$cacheFile = $cachePath . \"/tiny_mce_\" . $cacheKey . \".js\";\n\t}\n\n\t// Check if it supports gzip\n\tif (isset($_SERVER['HTTP_ACCEPT_ENCODING']))\n\t\t$encodings = explode(',', strtolower(preg_replace(\"/\\s+/\", \"\", $_SERVER['HTTP_ACCEPT_ENCODING'])));\n\n\tif ((in_array('gzip', $encodings) || in_array('x-gzip', $encodings) || isset($_SERVER['---------------'])) && function_exists('ob_gzhandler') && !ini_get('zlib.output_compression')) {\n\t\t$enc = in_array('x-gzip', $encodings) ? \"x-gzip\" : \"gzip\";\n\t\t$supportsGzip = true;\n\t}\n\n\t// Use cached file disk cache\n\tif ($diskCache && $supportsGzip && file_exists($cacheFile)) {\n\t\tif ($compress)\n\t\t\theader(\"Content-Encoding: \" . $enc);\n\n\t\techo getFileContents($cacheFile);\n\t\tdie();\n\t}\n\n\t// Add core\n\t$content .= getFileContents(\"tiny_mce\" . $suffix . \".js\");\n\n\t// Patch loading functions\n\t$content .= \"tinyMCE_GZ.start();\";\n\n\t// Add core languages\n\tforeach ($languages as $lang)\n\t\t$content .= getFileContents(\"langs/\" . $lang . \".js\");\n\n\t// Add themes\n\tforeach ($themes as $theme) {\n\t\t$content .= getFileContents( \"themes/\" . $theme . \"/editor_template\" . $suffix . \".js\");\n\n\t\tforeach ($languages as $lang)\n\t\t\t$content .= getFileContents(\"themes/\" . $theme . \"/langs/\" . $lang . \".js\");\n\t}\n\n\t// Add plugins\n\tforeach ($plugins as $plugin) {\n\t\t$content .= getFileContents(\"plugins/\" . $plugin . \"/editor_plugin\" . $suffix . \".js\");\n\n\t\tforeach ($languages as $lang)\n\t\t\t$content .= getFileContents(\"plugins/\" . $plugin . \"/langs/\" . $lang . \".js\");\n\t}\n\n\t// Add custom files\n\tforeach ($custom as $file)\n\t\t$content .= getFileContents($file);\n\n\t// Restore loading functions\n\t$content .= \"tinyMCE_GZ.end();\";\n\n\t// Generate GZIP'd content\n\tif ($supportsGzip) {\n\t\tif ($compress) {\n\t\t\theader(\"Content-Encoding: \" . $enc);\n\t\t\t$cacheData = gzencode($content, 9, FORCE_GZIP);\n\t\t} else\n\t\t\t$cacheData = $content;\n\n\t\t// Write gz file\n\t\tif ($diskCache && $cacheKey != \"\")\n\t\t\tputFileContents($cacheFile, $cacheData);\n\n\t\t// Stream to client\n\t\techo $cacheData;\n\t} else {\n\t\t// Stream uncompressed content\n\t\techo $content;\n\t}\n\n\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n\tfunction getParam($name, $def = false) {\n\t\tif (!isset($_GET[$name]))\n\t\t\treturn $def;\n\n\t\treturn preg_replace(\"/[^0-9a-z\\-_,]+/i\", \"\", $_GET[$name]); // Remove anything but 0-9,a-z,-_\n\t}\n\n\tfunction getFileContents($path) {\n\t\t$path = realpath($path);\n\n\t\tif (!$path || !@is_file($path))\n\t\t\treturn \"\";\n\n\t\tif (function_exists(\"file_get_contents\"))\n\t\t\treturn @file_get_contents($path);\n\n\t\t$content = \"\";\n\t\t$fp = @fopen($path, \"r\");\n\t\tif (!$fp)\n\t\t\treturn \"\";\n\n\t\twhile (!feof($fp))\n\t\t\t$content .= fgets($fp);\n\n\t\tfclose($fp);\n\n\t\treturn $content;\n\t}\n\n\tfunction putFileContents($path, $content) {\n\t\tif (function_exists(\"file_put_contents\"))\n\t\t\treturn @file_put_contents($path, $content);\n\n\t\t$fp = @fopen($path, \"wb\");\n\t\tif ($fp) {\n\t\t\tfwrite($fp, $content);\n\t\t\tfclose($fp);\n\t\t}\n\t}\n?>"}]}
{"id": 23, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\install\\index.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n//constant proclaiming installation in progress\ndefine(\"INSTALLING\",1);\n\n\n\n\tfunction db_form($data=NULL) {\n\t\tglobal $error_message;\n\t\t\n\t\t\tif (!$data['db_tableprefix']) {\n\t\t\t\t$data['db_tableprefix'] = 'phpns_';\n\t\t\t}\n\t\t\tif (!$data['db_host']) {\n\t\t\t\t$data['db_host'] = 'localhost';\n\t\t\t}\n\t\t\t\n\t\t$content = '\n\t\t'.$error_message.'\n\t\t<form action=\"index.php?step=2\" method=\"post\">\n\t\t<div class=\"form\">\n\t\t\t<h3>Database information</h3>\n\t\t\t\n\t\t\t<label for=\"type\">Database type</label>\n\t\t\t<select id=\"type\" style=\"width: 400px\">\n\t\t\t\t<optgroup label=\"Select a database type...\">\n\t\t\t\t\t<option>mySQL database</option>\n\t\t\t\t</optgroup>\n\t\t\t</select>\n\t\t\t<br />\n\t\t\t<label for=\"db_host\">Database host</label>\n\t\t\t<input type=\"text\" name=\"db_host\" value=\"'.$data['db_host'].'\" /> (Usually \"localhost\")\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"db_user\">Database user</label>\n\t\t\t<input type=\"text\" name=\"db_user\" value=\"'.$data['db_user'].'\" />\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"db_password\">Database password</label>\n\t\t\t<input type=\"password\" name=\"db_password\" value=\"'.$data['db_password'].'\" />\n\t\t\t<br /><br />\n\t\t\t\n\t\t\t<label for=\"db_name\">Database name</label>\n\t\t\t<input type=\"text\" name=\"db_name\" value=\"'.$data['db_name'].'\" />\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"db_tableprefix\">Table prefix</label>\n\t\t\t<input type=\"text\" name=\"db_tableprefix\" value=\"'.$data['db_tableprefix'].'\" />\n\t\t\t<br />\n\t\t\t<h3>Admin information</h3>\n\t\t\t<br />\n\t\t\t<label for=\"username\">Admin username</label>\n\t\t\t<input type=\"text\" name=\"username\" value=\"'.$data['username'].'\" />\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"password\">Admin password</label>\n\t\t\t<input type=\"password\" name=\"password\" value=\"'.$data['password'].'\" />\n\t\t\t<br />\n\t\t\t\n\t\t\t<label for=\"c_password\">Confirm password</label>\n\t\t\t<input type=\"password\" name=\"c_password\" value=\"'.$data['c_password'].'\" />\n\t\t</div>\n\t\t\t<div class=\"alignr\">\t\t\t\n\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Continue\" />\n\t\t\t</div>\n\t\t</form>\n\t\t';\n\t\treturn $content;\n\t}\n\t\n\t\n\t//get step\n\t$step = $_GET['step'];\n\t\n\tif (!$step) {\n\t\t$logo = '';\n\t\t$license_txt = file_get_contents(\"../docs/LICENSE\");\n\t\t$content = '\n\t\t\t<form action=\"index.php?step=1\" method=\"post\">\n\t\t\t<textarea style=\"width: 100%; height: 200px;\" readonly=\"readonly\">\n\t\t\t'.$license_txt.'\n\t\t\t</textarea>\n\t\t\t<br />\n\t\t\t<div class=\"alignr\">\n\t\t\t\t<label><input type=\"checkbox\" id=\"upgrade\" name=\"upgrade\" value=\"TRUE\" />Upgrade from V1.x</label>\n\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Continue\" />\n\t\t\t</div>\n\t\t</form>\n\t\t';\n\t} elseif ($step == 1) { //step 1\n\t\t//If upgrade is selected, then go directly to upgrade\n\t\tif($_POST[upgrade] == TRUE){\n\t\t\theader(\"location: upgrade.php\");\n\t\t}\n\t\t\n\t\t$content = db_form();\n\t\t\n\t} elseif ($step == 2) { //step 2 : check data.\n\t\t//get data from post, now we'll verify...\n\t\t$data = $_POST;\n\t\t\t//set continue to TRUE, then we'll make sure everything is ok\n\t\t\t$continue = TRUE;\n\t\t\tforeach ($data as $key=>$value) {\n\t\t\t\tif ($value == NULL && $key != 'db_tableprefix') {\n\t\t\t\t\t$continue = FALSE;\n\t\t\t\t\techo \"\";\n\t\t\t\t\t$error_message = '<div class=\"warning\">You need to fill out all the fields (excluding the table prefix)</div>';\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif ($data['password'] && ($data['password'] != $data['c_password'])) {\n\t\t\t\t$error_message .= '<div class=\"warning\">Your passwords do not match.</div>';\n\t\t\t\t$continue = FALSE;\n\t\t\t} elseif ($data['password']) {\n\t\t\t\t$data['password'] = sha1($data['password']);\n\t\t\t}\n\t\t\t\n\t\t\tif ($continue == TRUE) { //if all fields are full, we move on to verification. First, we'll do the db stuff.\n\t\t\t\tif (!$connection = @mysql_connect($data['db_host'], $data['db_user'], $data['db_password'])) {\n\t\t\t\t\t$error_message .= '<div class=\"warning\">We could not connect to the database ('.$data['db_host'].') with the information you provided. This is most likely due to a misspelled username or password. If you are sure you provided correct information, the user you are using probably doesn\\'t exist on the server you specified.</div>';\n\t\t\t\t\t$continue = FALSE;\n\t\t\t\t}\n\t\t\t\t\tif (!@mysql_select_db($data['db_name'], $connection)) {\n\t\t\t\t\t$error_message .= '<div class=\"warning\">We could not find the database ('.$data['db_name'].') you specified. You might have spelled the database wrong, or, you are not connected to a database (you would recieve a previous error if this was the case).</div>';\n\t\t\t\t\t$continue = FALSE;\n\t\t\t\t}\n\n\t\t\t\t\t//if connection is active, insert data\n\t\t\t\tif ($continue == TRUE) {\n\t\t\t\t\tinclude_once(\"install.inc.php\");\n\t\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t}\n\t\t\t\n\t\tif ($continue == FALSE) {\n\t\t\t//if there were errors, we're going to redisplay the form with errors (inside the function)\n\t\t\t$content = db_form($data);\n\t\t\t\n\t\t} elseif ($continue == TRUE) { \n\t\t\t//else if we have no errors, we serialize the $data, and head over to ?step=3\n\t\t\t$data = serialize($data);\n\t\t\t$data = str_replace('\"',\"'\", $data); //replace all \"s with 's as to be xhtml compliant in hidden form\n\t\t\t\t$url = str_replace('install/index.php','',$_SERVER['PHP_SELF']);\n\t\t\t$content = '\n\t\t\t<h3>Configuration finished</h3>\n\t\t\t<p>You have filled in all the fields in the previous step successfully. Now, we need to write the configuration to the phpns config.php file, so it can be used globally across the whole system. But, before we can do this, we need you to give this script proper permissions. Please do the following:\n\t\t\t<ol>\n\t\t\t\t<li>Using your favorite FTP application, login to your website directory, and navigate to where you uploaded the phpns system ('.$url.').</li>\n\t\t\t\t<li>Now, you need to navigate to: /inc</li>\n\t\t\t\t<li>Select the config.php file</li>\n\t\t\t\t<li>Change the permissions of the file to 0777, or 777.</li>\n\t\t\t\t<li>Return to this installation guide, and press continue.</li>\n\t\t\t<form action=\"index.php?step=3\" method=\"post\">\n\t\t\t\t<input type=\"hidden\" name=\"config\" value=\"'.$data.'\" />\n\t\t\t\t<div class=\"alignr\">\n\t\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Continue\" />\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t\t';\n\t\t}\n\t\t\n\t} elseif ($step == 3) { //else if step 3\n\n\t\t//unserialize string passed through form, get back array\n\t\t$data = unserialize(str_replace(\"'\",'\"',stripslashes($_POST['config'])));\n\t\t\n\t\t\t//form file contents\n\t\t\t$fcontent = '<?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n//This is the file generated by the installation. Copy and paste this into the /inc/config.php file. If neceessary, you should edit anything needed below.\n\n//The Host is where the mySQL database is stored. Usually localhost.\n$databaseinfo[\\'host\\'] = \"'.$data['db_host'].'\";\n\n\n//The user your database is assigned to.\n$databaseinfo[\\'user\\'] = \"'.$data['db_user'].'\";\n\n\n//The password of your user.\n$databaseinfo[\\'password\\'] = \"'.$data['db_password'].'\";\n\n\n//The database name that phpns will use.\n$databaseinfo[\\'dbname\\'] = \"'.$data['db_name'].'\";\n\n\n//The table prefix defined on the database.\n$databaseinfo[\\'prefix\\'] = \"'.$data['db_tableprefix'].'\";\n\n\n//Change the variable below to \"yes\", once you have completed the above.\n$globalvars[\\'installed\\'] = \"yes\";\n\n\n\n?>';\n\t\t$continue = TRUE;\n\t\tif ($filec = @fopen(\"../inc/config.php\",'w')) { //if we can open\n\t\t\t//if we can open the file for reading...\n\t\t\tif (!@fwrite($filec, $fcontent)) {\n\t\t\t\t$error_message .= '<div class=\"warning\">We opened the config.php file, but we could not write to it. This is probably because you didn not set the file permissions correctly.</div>';\n\t\t\t\t$continue = FALSE;\n\t\t\t}\n\t\t} else {\n\t\t\t$error_message .= '<div class=\"warning\">We could not open the config.php file to edit with your configuration options. The file permissions probably are not set correctly.</div>';\n\t\t\t$continue = FALSE;\n\t\t}\n\t\t\n\t\t//if problems with writing to file, give them the code to edit the file themselves.\n\t\tif ($continue == FALSE) {\n\t\t\t$content = '\n\t\t\t<h3>Error writing to config.php</h3>\n\t\t\t<p>We could not edit the file with your configuration. This is probably due to wrong file permissions. You can try to set the permissions again, and refresh this page. However, if you really do not know what you are doing, you can open the file on the server, and replace everything in the file with the following:</p>\n\t\t\t<textarea style=\"width: 600px; height: 300px;\" readonly=\"readonly\">'.$fcontent.'</textarea>\n\t\t\t';\n\t\t\t\n\t\t} else {\n\t\t\t$content = '\n\t\t\t<h3>Success</h3>\n\t\t\t<p>We have successully edited the config.php file with your configuration, and created the database structure. Installation is complete, here is what you do:</p>\n\t\t\t<ol>\n\t\t\t\t<li>Open your FTP or File browser on the server</li>\n\t\t\t\t<li>Navigate to the phpns directory, and DELETE the /install directory</li>\n\t\t\t\t<li>Navigate to the <a href=\"../\">login page</a>, and login with your recently created admin account</li>\n\t\t\t</ol>\n\t\t\t<p>A copy of the config.php file is attached below for your reference.</p>\n\t\t\t<textarea style=\"width: 600px; height: 300px;\" readonly=\"readonly\">'.$fcontent.'</textarea>\n\t\t\t';\n\t\t}\n\t}\n\ninclude(\"install.tmp.php\");\n?>\n\n"}]}
{"id": 24, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\install\\install.inc.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Kyle Osborn, Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\nif (INSTALLING == TRUE) {\n\n\t$databaseinfo['host'] = $data['db_host'];\n\t$databaseinfo['user'] = $data['db_user'];\n\t$databaseinfo['password'] = $data['db_password'];\n\t$databaseinfo['dbname'] = $data['db_name'];\n\n\n\tinclude(\"../inc/errors.php\");   // include error profiles\n\n\n\n\t//connect to mysql database for all files\n\t$mysql['connection'] = mysql_connect($databaseinfo['host'], $databaseinfo['user'], $databaseinfo['password'])\n\tor die ($error['connection']);\n\n\t//select mysql database\n\t$mysql['db'] = mysql_select_db($databaseinfo['dbname'],$mysql['connection'])\n\tor die ($error['database']);\n\n\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'articles` (\n\t  `id` int(25) NOT NULL auto_increment,\n\t  `article_title` varchar(100) NOT NULL,\n\t  `article_subtitle` varchar(100) NOT NULL,\n\t  `article_author` varchar(100) NOT NULL,\n\t  `article_cat` varchar(15) NOT NULL,\n\t  `article_text` varchar(20000) NOT NULL,\n\t  `article_exptext` varchar(20000) NOT NULL,\n\t  `article_imgid` varchar(100) NOT NULL,\n\t  `allow_comments` varchar(1) NOT NULL,\n\t  `start_date` varchar(15) NOT NULL,\n\t  `end_date` varchar(15) NOT NULL,\n\t  `active` varchar(1) NOT NULL,\n\t  `approved` varchar(1) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  `ip` varchar(15) NOT NULL,\n\t  PRIMARY KEY  (`id`),\n\t  KEY `article_title` (`article_title`,`timestamp`)\n\t) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;';\n\t$res = mysql_query($sql);\n\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'banlist` (\n\t  `id` int(10) NOT NULL auto_increment,\n\t  `ip` varchar(15) NOT NULL,\n\t  `banned_by` varchar(20) NOT NULL,\n\t  `reason` varchar(5000) NOT NULL,\n\t  `timestamp` varchar(12) NOT NULL,\n\t  PRIMARY KEY  (`id`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;';\n\t$res = mysql_query($sql);\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'categories` (\n\t  `id` int(15) NOT NULL auto_increment,\n\t  `cat_name` varchar(100) NOT NULL,\n\t  `cat_parent` varchar(10000) NOT NULL,\n\t  `cat_author` varchar(100) NOT NULL,\n\t  `cat_desc` varchar(1000) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  `ip` varchar(15) NOT NULL,\n\t  PRIMARY KEY  (`id`)\n\t) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=32 ;';\n\t$res = mysql_query($sql);\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'comments` (\n\t  `id` int(25) NOT NULL auto_increment,\n\t  `article_id` varchar(25) NOT NULL,\n\t  `comment_text` varchar(1000) NOT NULL,\n\t  `website` varchar(100) NOT NULL,\n\t  `comment_author` varchar(20) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  `approved` varchar(1) NOT NULL,\n\t  `ip` varchar(15) NOT NULL,\n\t  PRIMARY KEY  (`id`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;';\n\t$res = mysql_query($sql);\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'cookielog` (\n\t  `id` int(20) NOT NULL auto_increment,\n\t  `user_id` varchar(15) NOT NULL,\n\t  `rank_id` varchar(15) NOT NULL,\n\t  `cookie_id` varchar(32) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  `ip` varchar(15) NOT NULL,\n\t  PRIMARY KEY  (`id`),\n\t  KEY `user_id` (`user_id`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n\t';\n\t$res = mysql_query($sql);\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'gconfig` (\n\t  `id` int(5) NOT NULL auto_increment,\n\t  `name` varchar(100) NOT NULL,\n\t  `v1` varchar(17) NOT NULL,\n\t  `v2` varchar(10) NOT NULL,\n\t  `v3` varchar(1000) NOT NULL,\n\t  PRIMARY KEY  (`id`)\n\t) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=15 ;';\n\t$res = mysql_query($sql);\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'images` (\n\t  `id` int(15) NOT NULL auto_increment,\n\t  `user_id` varchar(15) NOT NULL,\n\t  `image_filepath` varchar(500) NOT NULL,\n\t  `alt_description` varchar(100) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  `ip` varchar(15) NOT NULL,\n\t  PRIMARY KEY  (`id`),\n\t  KEY `user_id` (`user_id`)\n\t) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;';\n\t$res = mysql_query($sql);\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'ranks` (\n\t  `id` int(15) NOT NULL auto_increment,\n\t  `rank_title` varchar(100) NOT NULL,\n\t  `rank_desc` varchar(1000) NOT NULL,\n\t  `rank_author` varchar(100) NOT NULL,\n\t  `permissions` varchar(100) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  PRIMARY KEY  (`id`)\n\t) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=15 ;';\n\t$res = mysql_query($sql);\n\n        $sql = 'CREATE TABLE `'.$data['db_tableprefix'].'syslog` (\n\t  `id` int(24) NOT NULL auto_increment,\n\t  `task` varchar(20) NOT NULL,\n\t  `description` varchar(200) NOT NULL,\n\t  `user` int(5) NOT NULL,\n\t  `page` varchar(120) NOT NULL,\n\t  `timestamp` varchar(12) NOT NULL,\n\t  PRIMARY KEY  (`id`)\n\t) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=12 ;';\n        $res = mysql_query($sql);\n\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'templates` (\n\t  `id` int(15) NOT NULL auto_increment,\n\t  `template_name` varchar(100) NOT NULL,\n\t  `template_desc` varchar(1000) NOT NULL,\n\t  `template_author` varchar(100) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  `html_article` varchar(5000) NOT NULL,\n\t  `html_comment` varchar(5000) NOT NULL,\n\t  `html_form` varchar(5000) NOT NULL,\n\t  `html_pagination` varchar(5000) NOT NULL,\n\t  `template_selected` varchar(1) NOT NULL,\n\t  PRIMARY KEY  (`id`)\n\t) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=9 ;';\n\t$res = mysql_query($sql);\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'themes` (\n\t  `id` int(10) NOT NULL auto_increment,\n\t  `theme_name` varchar(100) NOT NULL,\n\t  `theme_author` varchar(100) NOT NULL,\n\t  `theme_dir` varchar(200) NOT NULL,\n\t  `base_dir` varchar(50) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  `theme_selected` varchar(1) NOT NULL,\n\t  `permissions` varchar(10000) NOT NULL,\n\t  PRIMARY KEY  (`id`)\n\t) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=9 ;';\n\t$res = mysql_query($sql);\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'userlogin` (\n\t  `id` int(20) NOT NULL auto_increment,\n\t  `username` varchar(15) NOT NULL,\n\t  `rank_id` varchar(15) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  `ip` varchar(15) NOT NULL,\n\t  PRIMARY KEY  (`id`),\n\t  KEY `user_id` (`username`)\n\t) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=82 ;\n\t';\n\t$res = mysql_query($sql);\n\n\t$sql = 'CREATE TABLE IF NOT EXISTS `'.$data['db_tableprefix'].'users` (\n\t  `id` int(15) NOT NULL auto_increment,\n\t  `user_name` varchar(100) NOT NULL,\n\t  `full_name` varchar(150) NOT NULL,\n\t  `email` varchar(100) NOT NULL,\n\t  `password` varchar(40) NOT NULL,\n\t  `timestamp` varchar(15) NOT NULL,\n\t  `ip` varchar(15) NOT NULL,\n\t  `msn` varchar(100) NOT NULL,\n\t  `aim` varchar(100) NOT NULL,\n\t  `yahoo` varchar(100) NOT NULL,\n\t  `skype` varchar(100) NOT NULL,\n\t  `display_picture` varchar(150) NOT NULL,\n\t  `rank_id` varchar(15) NOT NULL,\n\t  PRIMARY KEY  (`id`)\n\t) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=8 ;';\n\t$res = mysql_query($sql);\n\n\t$sql = \"INSERT INTO `\".$data['db_tableprefix'].\"articles` (`id`, `article_title`, `article_subtitle`, `article_author`, `article_cat`, `article_text`, `article_exptext`, `article_imgid`, `allow_comments`, `start_date`, `end_date`, `active`, `approved`, `timestamp`, `ip`) VALUES (NULL, 'Welcome to phpns!','','\".$data['username'].\"','all','&lt;p&gt;If you see are viewing this message, the phpns installation was a success! This article is filed under &amp;quot;Site Wide News&amp;quot;, which is the default category that is created during installation.&lt;/p&gt;&lt;p&gt;&lt;font color=&quot;#993300&quot;&gt;You are free to modify this message, or delete it all together&lt;/font&gt;. Why should you use phpns?&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;It&#039;s free&lt;/strong&gt;. Phpns is released under the GPL license, which gives you the ability to change it, redistribute it, and use it personally or professionally.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;It&#039;s clean&lt;/strong&gt;. It&#039;s a breath or fresh air, following web standards and semantics. The (open-source) code is neatly organized, logically indented, and well-commented to make changes easier.&lt;/li&gt;&lt;li&gt;I&lt;strong&gt;t&#039;s easy to integrate&lt;/strong&gt;. Only one line of code is necessary on your website, and you have a dynamic, fully functional news system. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;It&#039;s easy to install&lt;/strong&gt;. The guided installation will have you up and running in minutes, asking you just a few questions about your database setup.&lt;/li&gt;&lt;/ul&gt;Some more information is available in the &amp;quot;Full Article&amp;quot; section...','What does &amp;quot;free&amp;quot; mean? &lt;blockquote&gt;To the phpns developers, the word &amp;quot;free&amp;quot; means more than just the cost of the product. The word free means that &lt;strong&gt;you are free&lt;/strong&gt; to modify anything you want about phpns, without any license restrictions.&lt;/blockquote&gt;&lt;p&gt;Why is phpns free in both price and modification?&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Because we believe in the open-source message. Closed source applications restrict the user from customizing the way the system works, and prevents the communitiy from contributing to the package. Plus, we love seeing our software being put to good use, and we love modifications.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Why don&#039;t you require a &amp;quot;Powered by phpns&amp;quot; message at the bottom of each page, like other news systems?&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Because we hated that when using other products... and the fact that you had to pay to have it removed. However, if you don&#039;t mind a message like that, it can be enabled in the preferences system. It&#039;s disabled by default.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;What can I do to help the project?&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;If you would like to be a part of the project, we always appreciate help. What you can do:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Spread the word. Recommend our system to your friends and co-workers!&lt;/li&gt;&lt;li&gt;Report bugs you&#039;ve encountered at the &lt;a href=&quot;http://launchpad.net/phpns&quot;&gt;phpns launchpad website&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;Submit reviews to software review websites around the internet. As long as they are honest, this is a great way to help us.&lt;/li&gt;&lt;li&gt;Donate. This helps with hosting/domain costs, and you&#039;ll get your name on the website along with a message and URL of your blog/website.&lt;/li&gt;&lt;li&gt;Become a sponsor. If you&#039;re a hosting service, business, or organization, we&#039;re always looking for funding and bandwith.&lt;/li&gt;&lt;li&gt;Develop. Contact us on the website if you think we could use your services.&lt;/li&gt;&lt;/ul&gt;That&#039;s it. Enjoy phpns!&lt;br /&gt;&lt;/blockquote&gt;','imgid','0','','','1','1','\".time().\"','\".$_SERVER['REMOTE_ADDR'].\"')\";\n\t$res = mysql_query($sql);\n\n\t$sql = \"INSERT INTO `\".$data['db_tableprefix'].\"gconfig` (`id`, `name`, `v1`, `v2`, `v3`) VALUES \n\t(NULL, 'siteonline', '0', '0', '0'),\n\t(NULL, 'def_rsslimit', '', '', '3'),\n\t(NULL, 'def_rssorder', 'desc', '', ''),\n\t(NULL, 'def_items_per_page', '10', '', ''),\n\t(NULL, 'def_rsstitle', '', '', 'phpns rss feed'),\n\t(NULL, 'def_rssdesc', '', '', 'An RSS feed from phpns articles.'),\n\t(NULL, 'def_rssenabled', '1', '', ''),\n\t(NULL, 'def_limit', '10', '', ''),\n\t(NULL, 'def_order', 'desc', '', ''),\n\t(NULL, 'def_offset', '0', '', ''),\n\t(NULL, 'timestamp_format', '', '', 'l F d, Y  g:i a'),\n\t(NULL, 'def_comlimit', '', '', '100000'),\n\t(NULL, 'def_comenabled', '1', '', ''),\n\t(NULL, 'def_comorder', 'asc', '', ''),\n\t(NULL, 'global_message', '', '', 'Welcome to the phpns admin panel! Click \\'change message\\' to modify/delete this message.'),\n\t(NULL, 'siteonline', '0', '0', '0'),\n\t(NULL, 'wysiwyg', 'yes', '', ''),\n\t(NULL, 'sys_time_format', 'l F d, Y  g:i a', '', ''),\n\t(NULL, 'line', 'yes', '', '');\";\n\t$res = mysql_query($sql);\n\n\t$sql = \"INSERT INTO `\".$data['db_tableprefix'].\"ranks` (`id`, `rank_title`, `rank_desc`, `rank_author`, `permissions`, `timestamp`) VALUES \n\t(1, 'Administrators', 'Any user assigned to this rank will have full access.', '\".$data['username'].\"', '1,1,1,1,1,1,1,1,1,1,1,1', '\".time() .\"');\";\n\t$res = mysql_query($sql);\n\n\t$sql = \"INSERT INTO `\".$data['db_tableprefix'].\"themes` (`id`, `theme_name`, `theme_author`, `theme_dir`, `base_dir`, `timestamp`, `theme_selected`, `permissions`) VALUES \n\t(NULL, 'default', 'phpns team', 'themes/default/', 'default', '\".time() .\"', '1', '');\";\n\t$res = mysql_query($sql);\n\n\t$sql = \"INSERT INTO `\".$data['db_tableprefix'].\"users` (`id`, `user_name`, `full_name`, `email`, `password`, `timestamp`, `ip`, `msn`, `aim`, `yahoo`, `skype`, `display_picture`, `rank_id`) VALUES \n\t(NULL, '\".$data['username'].\"', '\".$data['username'].\"', '', '\".$data['password'] .\"', '\".time() .\"', '127.0.0.1', '', '', '', '', '', '1');\";\n\t$res = mysql_query($sql);\n\n\t$sql = \"INSERT INTO `\".$data['db_tableprefix'].\"categories` (`id`, `cat_name`, `cat_parent`, `cat_author`, `cat_desc`, `timestamp`, `ip`) VALUES (NULL, 'Site news', '', '\".$data['username'].\"', 'This is for general news on your website.', '\".time().\"','\".$_SERVER['REMOTE_ADDR'].\"');\";\n\t$res = mysql_query($sql);\n\n\t$sql = 'INSERT INTO `'.$data['db_tableprefix'].'templates` (`id`, `template_name`, `template_desc`, `template_author`, `timestamp`, `html_article`, `html_comment`, `html_form`, `html_pagination`, `template_selected`) VALUES \n(NULL, \"Default\", \"This is the default phpns template.\", \"Phpns-team\", \"1194252704\", \"&lt;div style=&quot;margin-bottom: 30px; min-height: 130px;&quot;&gt;\\r\\n &lt;h2 style=&quot;margin-bottom: 0pt&quot;&gt;&lt;a href=&quot;{article_href}&quot; style=&quot;text-decoration: none;&quot;&gt;{title}&lt;/a&gt;&lt;/h2&gt;\\r\\n  &lt;h4 style=&quot;margin: 0 0 0 3em; font-weight: normal;&quot;&gt;&lt;em&gt;Posted by &lt;a href=&quot;#&quot;&gt;{author}&lt;/a&gt;&lt;/em&gt;&lt;/h4&gt;\\r\\n &lt;div style=&quot;float:right; padding: 0 0 10px 10px&quot;&gt;{reddit} {digg}&lt;/div&gt;\\r\\n {main_article}\\r\\n &lt;div&gt;\\r\\n  {full_story}\\r\\n\\r\\n  &lt;div id=&quot;comments&quot; style=&quot;text-align: right;&quot;&gt;\\r\\n  &lt;strong&gt;&lt;a href=&quot;{article_href}#comments&quot;&gt;{comment_count} comments&lt;/a&gt;&lt;/strong&gt;\\r\\n  &lt;/div&gt;\\r\\n &lt;/div&gt;\\r\\n&lt;/div&gt;\", \"&lt;div style=&quot;background: #eee; font: caption; margin: 20px 0 0 5%; padding: 5px;&quot;&gt;\\r\\n &lt;div style=&quot;border: 1px solid #ccc; padding: 3px; background: #ccc; margin-bottom: 5px;&quot;&gt; \\r\\n  &lt;div style=&quot;text-align: right; float: right&quot;&gt; {timestamp}&lt;/div&gt;  \\r\\n &lt;strong&gt;Posted by  &lt;a href=&quot;{website}&quot;&gt;{author}&lt;/a&gt;&lt;/strong&gt; as {ip}\\r\\n &lt;/div&gt;\\r\\n {comment}\\r\\n&lt;/div&gt;\", \"&lt;div style=&quot;font: caption; margin-left: 5%;&quot;&gt;\\r\\n&lt;form style=&quot;margin-top: 50px;&quot; action=&quot;{action}&quot; method=&quot;post&quot;&gt;\\r\\n&lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; /&gt; &lt;label for=&quot;name&quot;&gt;Name (required)&lt;/label&gt;&lt;br /&gt;\\r\\n&lt;input type=&quot;text&quot; name=&quot;email&quot; id=&quot;email&quot; /&gt; &lt;label for=&quot;email&quot;&gt;Email (not published) (required)&lt;/label&gt;&lt;br /&gt;\\r\\n&lt;input type=&quot;text&quot; name=&quot;website&quot; id=&quot;website&quot; /&gt; &lt;label for=&quot;website&quot;&gt;Website&lt;/label&gt;&lt;br /&gt;\\r\\n&lt;textarea name=&quot;comment&quot; style=&quot;width:100%; height: 150px&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;\\r\\n&lt;input type=&quot;text&quot; name=&quot;captcha&quot; style=&quot;width: 100px&quot; /&gt; &lt;label for=&quot;captcha&quot;&gt;&lt;strong&gt;What is {captcha_question}?&lt;/strong&gt;&lt;/label&gt;&lt;br /&gt;\\r\\n{hidden_data}\\r\\n{captcha_answer}\\r\\n&lt;input type=&quot;submit&quot; value=&quot;Submit comment&quot; id=&quot;submit&quot; /&gt;\\r\\n&lt;/form&gt;\\r\\n&lt;/div&gt;\",\"&lt;a style=&quot;padding: 3px; margin: 10px; border: 1px solid #888;&quot; href=&quot;{previous_page}&quot;&gt;Previous Page&lt;/a&gt; {middle_pages} &lt;a  style=&quot;padding: 3px; margin: 10px; border: 1px solid #888;&quot; href=&quot;{next_page}&quot;&gt;Next Page&lt;/a&gt;\", \"1\");';\n\t$res = mysql_query($sql) or die(mysql_error());\n\n\t$sql = \"INSERT INTO `\".$data['db_tableprefix'].\"syslog` (`id`, `task`, `description`, `user`, `page`, `timestamp`) VALUES\n(NULL, 'INSTALL', 'User &lt;i&gt;\".$data['username'].\"&lt;/i&gt; has installed phpns!', 0, '/phpns/install/', \".time().\")\";\n\t$res = mysql_query($sql);\n\n} //end main (installing) if\n\n?>\n"}]}
{"id": 25, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\install\\install.tmp.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Kyle Osborn, Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n?>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n\t<title>phpns &raquo; install</title>\n\t<link rel=\"shortcut icon\" href=\"images/favicon.ico\" type=\"image/x-icon\" />\n\t<link rel=\"stylesheet\" href=\"../themes/default/styles/main.css\" type=\"text/css\" media=\"screen\" />\n</head>\n<body id=\"install\">\n\t<noscript>\n\t\t<div id=\"messages\">\n\t\t\tJavascript is not enabled on this browser. This will result in decreased accessability, and possibly limited features.\n\t\t</div>\n\t</noscript>\n\t<div id=\"head_container\">\n\t\t<h1><a href=\"../index.php\">phpns</a></h1>\n\t\t<div id=\"tabs\"> <!-- navigation start -->\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li><a href=\"index.php\" title=\"phpns install index\"><span>install index</span></a></li>\n\t\t\t\t\t\t<li><a href=\"../\" title=\"phpns admin panel\"><span>phpns admin panel</span></a></li>\n\n\t\t\t\t\t</ul>\n\t\t\t\t</div> <!-- navigation end -->\n\t\t</div>\n\t\t<div id=\"main_container\">\n\t\t\t<div id=\"main_content\">\n\t\t\t<?php echo \"$logo\"; ?>\n\t\t\t<h2>phpns installation</h2>\n\t\t\t<p>Welcome to the automatic phpns installation. Throughout this installation, we will ask you a few basic questions to get this up and running.</p>\n\t\t\t<?php echo \"$content\"; ?>\n\t\t</div>\n\t\t<div class=\"clear\"></div>\n\t</div>\n\n\t<div id=\"copyright\"> <!-- bottom notice/copyright -->\n\tphpns 2.1.1 is released under the GPL license, by <a href=\"http://phpns.com\">phpns.com</a> | Valid CSS/XHTML (semantic) | <a href=\"javascript:new_window('help.php#');\">Help</a>\n\t</div>\n</body>\n</html>\n\n<!--\nTemplate created by Alec Henriksen\nDate: Wednesday July 18, 2007\nhttp://phpns.com\nstandard compliant, semantic\n-->\n"}]}
{"id": 26, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\install\\upgrade.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Kyle Osborn, Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n\n\t//phpns version 1 => version 2 upgrade script, courtasy of our good friend \"Kyle Osborn\", a\n\t//contributing developer of phpns. Thanks a lot! :D\n\t\n\t\n\tif(!$_GET[step]){ header(\"location: ?step=1\");}\n\n\tdefine(\"DEBUG\",$_GET[debug]);\n\n\t$step = $_GET['step'];\n\n\n\t//   V1 CONNECTION\n\tif(DEBUG){ echo $host .\"<br />\\n\". $user .\"<br />\\n\". $password .\"<br />\\n\". $database .\"<br /><br />\";}\n\n\t\tfunction v1connect()\n\t\t{\n\t\t\t$user = $_POST['db_user'];\n\t\t\t$password = $_POST['db_password'];\n\t\t\t$host = $_POST['db_host'];\n\t\t\t$database = $_POST['db_name'];\n\t\t\t$connection = mysql_connect($host, $user, $password) or die (\"Connection to the phpns version 1 mysql server failed.\");\n\t\t\t$db = mysql_select_db($database,$connection) or die (mysql_error());\n\t\t}\n\t\n\n\n\n\n\n\t//   V2 CONNECTION\n\tif(DEBUG){ echo $databaseinfo['host'] .\"<br />\\n\". $databaseinfo['user'] .\"<br />\\n\". $databaseinfo['password'] .\"<br />\\n\". $databaseinfo['dbname'] .\"<br /><br />\";}\n\n\t\tfunction v2connect()\n\t\t{\n\t\t\tinclude(\"../inc/config.php\");\n\t\t\t$mysql['connection'] = mysql_connect($databaseinfo['host'], $databaseinfo['user'], $databaseinfo['password']) or die ($error['connection']);\n\t\t\t$mysql['db'] = mysql_select_db($databaseinfo['dbname'],$mysql['connection']) or die ($error['database']);\n\t\t}\n\n\n\n\n\n\tif($_POST){\n\n\n\t\t//From v1 userinfo\n\t\tv1connect();\n\t\t$user = \"SELECT * FROM userinfo\";\n\t\t$userresult = mysql_query($user);\n\t\t$num = mysql_numrows($userresult);\n\t\t$i = 0;\n\t\twhile ($i < $num) {\n\n\t\t\t$id = mysql_result($userresult,$i,\"id\");\n\t\t\t$username = mysql_result($userresult,$i,\"username\");\n\t\t\t$email = mysql_result($userresult,$i,\"email\");\n\t\t\t$timestamp = mysql_result($userresult,$i,\"date\");\n\t\t\t$rank = mysql_result($userresult,$i,\"rank\");\n\t\t\tif(DEBUG) echo $id .\"<br />\\n\". $username .\"<br />\\n\". $email .\"<br />\\n\". $timestamp .\"<br />\\n\". $rank;\n\n\t\t\t//to v2 users\n\t\t\tv2connect();\n\t\t\t$insert = \"INSERT INTO `users` (`user_name`, `email`, `password`, `timestamp`, `rank_id`) VALUES ('$username', 'CHANGEME', '$email', '$timestamp', '$rank');\";\n\t\t\t@mysql_query($insert) or die (mysql_error());\n\n\t\t\t$i++;\n\t\t}\n\n\n\t\t//From v1 news\n\t\tv1connect();\n\t\t$news = \"SELECT * FROM news\";\n\t\t$newsresult = mysql_query($news);\n\t\t$num = mysql_numrows($newsresult);\n\t\t$i = 0;\n\t\twhile ($i < $num) {\n\n\t\t\t$title = mysql_result($newsresult,$i,\"title\");\n\t\t\t$subtitle = mysql_result($newsresult,$i,\"subtitle\");\n\t\t\t$content = mysql_result($newsresult,$i,\"content\");\n\t\t\t$extcontent = mysql_result($newsresult,$i,\"extcontent\");\n\t\t\t$author = mysql_result($newsresult,$i,\"author\");\n\t\t\t$date = mysql_result($newsresult,$i,\"date\");\n\t\t\t$cat = mysql_result($newsresult,$i,\"cat\");\n\t\t\tif(DEBUG) echo $id .\"<br />\\n\". $title .\"<br />\\n\". $subtitle .\"<br />\\n\". $content .\"<br />\\n\". $extcontent .\"<br />\\n\". $author .\"<br />\\n\". $date .\"<br />\\n\". $cat;\n\n\t\t\t//to v2 articles\n\t\t\tv2connect();\n\t\t\t$insert = \"INSERT INTO `articles` (`article_title`, `article_subtitle`, `article_author`, `article_cat`, `article_text`, `article_exptext`, `article_imgid`, `allow_comments`, `start_date`, `end_date`, `active`, `approved`, `timestamp`, `ip`) VALUES ('$title', '$subtitle', '$author', '$cat', '$content', '$extcontent', '', '0', '', '', '0', '0', '$date', '127.0.0.1');\";\n\t\t\t@mysql_query($insert) or die (mysql_error());\n\n\t\t\t$i++;\n\t\t}\n\t}\n\n\n\n\tif($step == 1){\n\t\t$content = '\n\t\t\t<div class=\"warning\"><strong>YOU NEED TO HAVE PHPNS 2 ALREADY INSTALLED</strong> for this to work.</div>\n\t\t<h3>Step 1</h3>\n\t\t'.$error_message.'\n\t\t<p>To upgrade, you will need the original mysql.php from V1.x of phpNS</p>\n\t\t<form action=\"?step=2\" method=\"post\">\n\t\t\t\t<br />\n\t\t\t\t<br />\n\t\t\t\t<br />\n\t\t\t\t<label for=\"db_host\">Database host</label>\n\t\t\t\t<input type=\"text\" name=\"db_host\" value=\"\" /> (Usually \"localhost\")\n\t\t\t\t</label>\n\t\t\t\t<br />\n\n\t\t\t\t\n\t\t\t\t<label for=\"db_user\">Database user</label>\n\t\t\t\t<input type=\"text\" name=\"db_user\" value=\"\" />\n\t\t\t\t</label>\n\t\t\t\t<br />\n\t\t\t\t\n\t\t\t\t<label for=\"db_password\">Database password</label>\n\t\t\t\t<input type=\"password\" name=\"db_password\" value=\"\" />\n\t\t\t\t</label>\n\t\t\t\t<br />\n\n\t\t\t\t\n\t\t\t\t<label for=\"db_name\">Database name</label>\n\t\t\t\t<input type=\"text\" name=\"db_name\" value=\"\" />\n\t\t\t\t<br />\n\n\t\t\t<br />\n\n\t\t\t\n\t\t\t<div class=\"alignr\">\n\t\t\t\t<input type=\"submit\" id=\"submit\" value=\"Continue\" />\n\t\t\t</div>\n\t\t\t<br />\n\n\t\t</form>\n\t\t';\n\t} else if($step == 2){\n\t\t$content = '\n\t\n\t\t<h3>Upgrade has been completed!</h3>\n\t\t\t<br />\n\t\t<h2>It is now <strong>STRONGLY</strong> suggest you remove the /install directory!</h2>';\n\t}\n\n\ninclude(\"install.tmp.php\");\n?>\n"}]}
{"id": 27, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\themes\\cleanlite\\admin.tpl.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n\t<title>phpns &raquo; {current_page_name}</title>\n\t<link rel=\"stylesheet\" href=\"{prepath}styles/main.css\" type=\"text/css\" media=\"screen\" />\n\t<link rel=\"shortcut icon\" href=\"images/favicon.ico\" type=\"image/x-icon\" />\n\t{head_data}\n</head>\n<body>\n\t<noscript>\n\t\t<div id=\"messages\">\n\t\t\tJavascript is not enabled on this browser. This will result in decreased accessability, and possibly limited features.\n\t\t</div>\n\t</noscript>\n\t<div id=\"container\">\n\t\t<div id=\"navigation\"> <!-- navigation start -->\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"index.php\" title=\"phpns index\">index</a></li>\n\t\t\t\t<li><a href=\"article.php\" title=\"post a new article\">new article</a></li>\n\t\t\t\t<li><a href=\"manage.php\" title=\"manage current articles\">article management</a></li>\n\t\t\t\t<li><a href=\"user.php\" title=\"manage user profiles\">user management</a></li>\n\t\t\t\t<li><a href=\"preferences.php\" title=\"modify phpns preferences\">preferences</a></li>\n\t\t\t\t<li class=\"slast\"><a href=\"about.php\" title=\"about the phpns project\">about</a></a></li>\n\t\t\t\t<li class=\"last\"><a href=\"javascript:if(confirm('Are you sure you want to logout?')) top.location='login.php?do=logout'\" title=\"logout as {username}\">logout ({username})</a></li>\n\n\t\t\t</ul>\n\t\t</div> <!-- navigation end -->\n\t\t<div id=\"content\">\n\t\t\t{global_message}\n\t\t\t{page_image}\n\t\t\t<h2>{current_page_name}</h2>\n\t\t\t<p>{page_desc}</p>\n\t\t\t{content}<br />\n\t\t</div>\n\t\t<div class=\"clear\"></div>\n\t</div>\n\t<div id=\"copyright\"> <!-- bottom notice/copyright -->\n\tphpns {version} is released under the GPL license, by <a href=\"http://phpns.com\">phpns.com</a> | Valid CSS/XHTML (semantic) | <a href=\"javascript:new_window('help.php#{current_page_name}');\">Help</a>\n\t</div>\n</body>\n</html>\n\t<!-- Template is copyrighted under the GPL. =) -->\n\t<!-- Alec Henriksen Date: Wednesday July 18, 2007 http://phpns.com -->\n"}]}
{"id": 28, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\themes\\cleanlite\\login.tpl.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n?>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n\t<title>phpns &bull; login</title>\n\t<link rel=\"stylesheet\" href=\"{prepath}styles/login.css\" type=\"text/css\" media=\"screen\" />\n\t<script type=\"text/javascript\" src=\"{prepath}expand.js\"></script>\n</head>\n<body>\n\t<div id=\"container\">\n\t\t<div id=\"dropbox\">\n\t\t\t{logo}\n\t\t</div>\n\t\t{content}\n\t</div>\n\t<div id=\"copyright\"> <!-- bottom notice/copyright -->\n\tphpns {version} is released under the GPL license, by <a href=\"http://phpns.com\">phpns.com</a> | Valid CSS/XHTML (semantic) | <a href=\"javascript:new_window('help.php#{current_page_name}');\">Help</a>\n\t</div>\n</body>\n</html>\n\n<!--\nTemplate created by Alec Henriksen\nDate: Wednesday July 18, 2007\nhttp://phpns.com\nstandard compliant, semantic\n-->\n"}]}
{"id": 29, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\themes\\default\\admin.tpl.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n\t<head>\n\t\t<title>phpns &raquo; {current_page_name}</title>\n\t<link rel=\"stylesheet\" href=\"{prepath}styles/main.css\" type=\"text/css\" media=\"screen\" />\n\t<link rel=\"shortcut icon\" href=\"images/favicon.ico\" type=\"image/x-icon\" />\n\t{head_data}\n\t</head>\n\t\n\t<body class=\"admin\">\n\t\t<noscript>\n\t\t\t<div id=\"messages\">\n\t\t\t\tJavascript is disabled on your browser, which will result in reduced features and limited accessability.\n\t\t\t</div>\n\t\t</noscript>\n\t\t<div id=\"head_container\">\n\t\t\t<h1><a href=\"index.php\">php<span>ns</span></a></h1>\n\t\t\t<div id=\"tabs\"> <!-- navigation start -->\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li><a href=\"index.php\" title=\"phpns index\"><span>index</span></a></li>\n\t\t\t\t\t\t<li><a href=\"article.php\" title=\"post a new article\"><span>new article</span></a></li>\n\t\t\t\t\t\t<li><a href=\"manage.php\" title=\"manage current articles\"><span>article management</span></a></li>\n\t\t\t\t\t\t<li><a href=\"user.php\" title=\"manage user profiles\"><span>user management</span></a></li>\n\t\t\t\t\t\t<li><a href=\"preferences.php\" title=\"modify phpns preferences\"><span>preferences</span></a></li>\n\t\t\t\t\t\t<li><a href=\"about.php\" title=\"about the phpns project\"><span>about</span></a></li>\n\t\t\t\t\t\t<li class=\"slast\"><a href=\"login.php?do=logout\" title=\"logout {username}\"><span><strong>logout</strong></span></a></li>\n\t\t\t\t\t\t<!-- <li class=\"last\"><a href=\"javascript:if(confirm='Are you sure you want to logout?') top.location='login.php?do=logout'\" title=\"logout as {username}\">logout ({username})</a></li> -->\n\n\t\t\t\t\t</ul>\n\t\t\t\t\t<script language=\"javascript\" type=\"text/javascript\">setPage()</script>\n\t\t\t\t</div> <!-- navigation end -->\n\t\t</div>\n\t\t<div id=\"main_container\">\n\t\t\t<div id=\"main_content\">\n\t\t\t\t{global_message}\n\t\t\t\t{page_image}\n\t\t\t\t\n\t\t\t\t<h2>{current_page_name}</h2>\n\t\t\t\t<p class=\"caps\">{page_desc}</p>\n\t\t\t\t\n\t\t\t\t{content}\n\t\t\t</div>\n\t\t</div>\n\t\t<div id=\"copyright\"> <!-- bottom notice/copyright -->\n\tphpns {version} is released under the GPL license, by <a href=\"http://phpns.com\">phpns.com</a> | Valid CSS/XHTML (semantic) | <a href=\"javascript:new_window('help.php#{current_page_name}');\">Help</a>\n\t</div>\n\t</body>\n\t<!-- Template is copyrighted under the GPL. =) -->\n\t<!-- Done. :) If you need something, contact me at alecwh{at}gmail.com -->\n</html>\n"}]}
{"id": 30, "prompt_type": "basic", "file": "C:\\Users\\sigur\\Downloads\\master-applications\\phpns211\\themes\\default\\login.tpl.php", "prompt": [{"role": "system", "content": "I want you to act as a vulnerability detection system looking for broken access vulnerabilities."}, {"role": "user", "content": "Does the following code contain one of these bug types: CWE-22 Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') CWE-23 Relative Path Traversal CWE-35 Path Traversal: '.../...//' CWE-59 Improper Link Resolution Before File Access ('Link Following') CWE-200 Exposure of Sensitive Information to an Unauthorized Actor CWE-201 Exposure of Sensitive Information Through Sent Data CWE-219 Storage of File with Sensitive Data Under Web Root CWE-275 Permission Issues CWE-276 Incorrect Default Permissions CWE-284 Improper Access Control CWE-285 Improper Authorization CWE-352 Cross-Site Request Forgery (CSRF) CWE-359 Exposure of Private Personal Information to an Unauthorized Actor CWE-377 Insecure Temporary File CWE-402 Transmission of Private Resources into a New Sphere ('Resource Leak') CWE-425 Direct Request ('Forced Browsing') CWE-441 Unintended Proxy or Intermediary ('Confused Deputy') CWE-497 Exposure of Sensitive System Information to an Unauthorized Control Sphere CWE-538 Insertion of Sensitive Information into Externally-Accessible File or Directory CWE-540 Inclusion of Sensitive Information in Source Code CWE-548 Exposure of Information Through Directory Listing CWE-552 Files or Directories Accessible to External Parties CWE-566 Authorization Bypass Through User-Controlled SQL Primary Key CWE-601 URL Redirection to Untrusted Site ('Open Redirect') CWE-639 Authorization Bypass Through User-Controlled Key CWE-651 Exposure of WSDL File Containing Sensitive Information CWE-668 Exposure of Resource to Wrong Sphere CWE-706 Use of Incorrectly-Resolved Name or Reference CWE-862 Missing Authorization CWE-863 Incorrect Authorization CWE-913 Improper Control of Dynamically-Managed Code Resources CWE-922 Insecure Storage of Sensitive Information CWE-1275 Sensitive Cookie with Improper SameSite Attribute? Please answer Yes or No. <?php\n\n/* Copyright (c) 2007 Alec Henriksen\n * phpns is free software; you can redistribute it and/or modify it under the\n * terms of the GNU General Public Licence (GPL) as published by the Free\n * Software Foundation; either version 2 of the Licence, or (at your option) any\n * later version.\n * Please see the GPL at http://www.gnu.org/copyleft/gpl.html for a complete\n * understanding of what this license means and how to abide by it.\n*/\n?>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n\t<title>phpns &raquo; login</title>\n\t<link rel=\"alternate\" type=\"application/rss+xml\" title=\"phpns rss feed\" href=\"etc.php?do=rss\"/>\n\t<link rel=\"stylesheet\" href=\"{prepath}styles/main.css\" type=\"text/css\" media=\"screen\" />\n\t<script type=\"text/javascript\" src=\"{prepath}expand.js\"></script>\n</head>\n\t<body class=\"login\">\n\t\t<noscript>Javascript is disabled on your browser, which will result in reduced features and limited accessability.</noscript>\n\t\t<div id=\"head_container\">\n\t\t\t<h1><a href=\"index.php\">phpns</a></h1>\n\t\t\t<div id=\"tabs\"> <!-- navigation start -->\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li><a href=\"login.php\" title=\"phpns login page\"><span>login</span></a></li>\n\t\t\t\t\t\t<li><a href=\"help.php\" title=\"phpns documentation/help\"><span>phpns documentation</span></a></li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<script language=\"javascript\" type=\"text/javascript\">setPage()</script>\n\t\t\t\t</div> <!-- navigation end -->\n\t\t</div>\n\t\t<div id=\"main_container\">\n\t\t\t<div id=\"main_content\">\n\t\t\t\t<h3>{current_page_name}</h3>\t\t\t\t\n\t\t\t\t{content}\n\t\t\t</div>\n\t\t</div>\n\t\t<div id=\"copyright\"> <!-- bottom notice/copyright -->\n\tphpns {version} is released under the GPL license, by <a href=\"http://phpns.com\">phpns.com</a> | Valid CSS/XHTML (semantic) | <a href=\"javascript:new_window('help.php#{current_page_name}');\">Help</a>\n\t</div>\n\t</body>\n\t<!-- Done. :) If you need something, contact me at alecwh{at}gmail.com -->\n</html>\n\n<!--\nTemplate created by Alec Henriksen\nDate: Wednesday July 18, 2007\nhttp://phpns.com\nstandard compliant, semantic\n-->\n"}]}
